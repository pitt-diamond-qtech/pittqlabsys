<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0080)file:///D:/PyCharmProjects/pittqlabsys-dylan-working-repo/diff_cover_report.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <title>Diff Coverage</title>
        <style>
            .src-snippet { margin-top: 2em; }
            .src-name { font-weight: bold; }
            .snippets {
                border-top: 1px solid #bdbdbd;
                border-bottom: 1px solid #bdbdbd;
            }
            pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffcccc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
        </style>
    </head>
    <body>
        <h1>Diff Coverage</h1>
        <p>Diff: upstream/dylan-features...HEAD, staged and unstaged changes</p>
        <ul>
            <li><b>Total</b>: 1296 lines</li>
            <li><b>Missing</b>: 766 lines</li>
            <li><b>Coverage</b>: 40%</li>
        </ul>
        <table border="1">
            <tbody><tr>
                <th>Source File</th>
                <th>Diff Coverage (%)</th>
                <th>Missing Lines</th>
            </tr>
            <tr>
                <td>src/Controller/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/Controller/adwin.py</td>
                <td>9.1%</td>
                <td>185-186,188-195</td>
            </tr>
            <tr>
                <td>src/Controller/nanodrive.py</td>
                <td>50.0%</td>
                <td>110</td>
            </tr>
            <tr>
                <td>src/core/experiment.py</td>
                <td>87.8%</td>
                <td>445,748-749,789-790,815</td>
            </tr>
            <tr>
                <td>src/core/experiment_iterator.py</td>
                <td>29.8%</td>
                <td>120,154,157,161,192-196,201,203,206-208,211,214,227,240-244,254,422,424,426,428-433,436-438,440-442,444-447,449,451-452,454,456-457,459,461,463,466-468,470-472,476,478,480-481,483-484,486-487,490</td>
            </tr>
            <tr>
                <td>src/core/helper_functions.py</td>
                <td>37.0%</td>
                <td>220,224-233,235,237-244,246,248-252,254-256,259-267,269-272,274-277,283,324,329-330,332-337,339,350-357,359,362-366,376-377,379,396,398,405-409,411,415,431-439,455-457,482-483,485-498,500,512,514,516,518,522-523,534-535,555,573-574,576-577,579,581,583,589,591-592,603-604,607-609,612-613,620-621,623-624,626,628-629,631-635,637-638,640,644-645</td>
            </tr>
            <tr>
                <td>src/Model/experiments/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/Model/experiments/confocal.py</td>
                <td>25.5%</td>
                <td>73-76,78,80,82,84-88,91,98-104,111-114,117-120,123-127,130,134-137,139-142,147,150,154,156,159-162,173-174,176-177,180,186-191,193-194,203-204,207-208,211-212,214-215,218,220-222,225-227,230-232,235-236,238-239,242,244,246-250,252-253,255,259-262,265,270,272,274-276,281,316-318,322,337-342,344,346,349-351,358-371,373,427-432,434,436-441,444,451-457,464-467,469-473,475-477,479-482,485-489,491-494,496-498,500-501,506,509,512-513,515-521,523-528,530-535,537-538,540-544,547-551,553-558,560-561,563-568,570-571,573-575,578,580-584,589-590,628,644-649,651,653,656-658,709-712,714-715,721-723,730,733,735-736,740,742-743,747,751-752,754-755,757-759,761-762,764-768,772,774-776,778-779,782-787,790,793-794,806-807,848</td>
            </tr>
            <tr>
                <td>src/Model/experiments/example_experiment.py</td>
                <td>47.5%</td>
                <td>68-74,77-79,81,84-87,127-128,139,143,146-147,149,168-169,206-207,210,224-227</td>
            </tr>
            <tr>
                <td>src/Model/experiments/nv_loc_experiment.py</td>
                <td>85.7%</td>
                <td>40-41</td>
            </tr>
            <tr>
                <td>src/Model/experiments/select_points.py</td>
                <td>59.6%</td>
                <td>55-58,88-90,153,155,179-180,249-251,261,267-271,274-275,277-278,282-285,288-289,291-292,296-298,300,303,305-308,311-314,316-319,323-327,330-331,333-334,336,338-339,341,343,345,348,351-354,357-360,362-366</td>
            </tr>
            <tr>
                <td>src/tools/hdf5 saving.py</td>
                <td>0.0%</td>
                <td>1-3,6-19,21,24-31,33,35-36,38-45,47-48,50-51,53-54,56-57,77-78,80,82-83</td>
            </tr>
            <tr>
                <td>src/tools/matlab save test again.py</td>
                <td>0.0%</td>
                <td>1-3,6-7,10,12,14,20,29,31,40,42-43,58-59,68-69,72-75,77-80,83,88-89,127,278-279,282-283,285,294-295,300</td>
            </tr>
            <tr>
                <td>src/View/windows_and_widgets/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/View/windows_and_widgets/main_window.py</td>
                <td>73.9%</td>
                <td>423,425-426,429,431-432,440-441,443-444,470,475,658,660-662,685,699</td>
            </tr>
            <tr>
                <td>src/View/windows_and_widgets/widgets.py</td>
                <td>98.0%</td>
                <td>487</td>
            </tr>
        </tbody></table>
        <div class="src-snippet">
            <div class="src-name">src/Controller/adwin.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Controller/adwin.py-181" name="src/Controller/adwin.py-181"></a>            <span class="k">raise</span> <span class="ne">KeyError</span>
<a id="src/Controller/adwin.py-182" name="src/Controller/adwin.py-182"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">Set_FPar</span><span class="p">(</span><span class="n">FPar_id</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="src/Controller/adwin.py-183" name="src/Controller/adwin.py-183"></a>
<a id="src/Controller/adwin.py-184" name="src/Controller/adwin.py-184"></a>    <span class="k">def</span> <span class="nf">reboot_adwin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num_devices</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="src/Controller/adwin.py-185" name="src/Controller/adwin.py-185"></a><span class="hll">        <span class="n">new_adw_handle</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Controller/adwin.py-186" name="src/Controller/adwin.py-186"></a><span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><a id="src/Controller/adwin.py-187" name="src/Controller/adwin.py-187"></a>            <span class="c1"># boots with T11 processor. 3.333.. ns minimum time resolution for low and high priority processes</span>
<a id="src/Controller/adwin.py-188" name="src/Controller/adwin.py-188"></a><span class="hll">            <span class="n">new_adw_handle</span> <span class="o">=</span> <span class="n">ADwin</span><span class="o">.</span><span class="n">ADwin</span><span class="p">(</span><span class="n">DeviceNo</span><span class="o">=</span><span class="n">num_devices</span><span class="p">,</span> <span class="n">raiseExceptions</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><a id="src/Controller/adwin.py-189" name="src/Controller/adwin.py-189"></a><span class="hll">            <span class="n">btl</span> <span class="o">=</span> <span class="n">new_adw_handle</span><span class="o">.</span><span class="n">ADwindir</span> <span class="o">+</span> <span class="s1">'ADwin11.btl'</span>
</span><a id="src/Controller/adwin.py-190" name="src/Controller/adwin.py-190"></a><span class="hll">            <span class="n">new_adw_handle</span><span class="o">.</span><span class="n">Boot</span><span class="p">(</span><span class="n">btl</span><span class="p">)</span>
</span><a id="src/Controller/adwin.py-191" name="src/Controller/adwin.py-191"></a><span class="hll">        <span class="k">except</span> <span class="n">ADwinError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/Controller/adwin.py-192" name="src/Controller/adwin.py-192"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s1">'Issue rebooting ADwin: '</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><a id="src/Controller/adwin.py-193" name="src/Controller/adwin.py-193"></a><span class="hll">            <span class="k">raise</span>
</span><a id="src/Controller/adwin.py-194" name="src/Controller/adwin.py-194"></a><span class="hll">        <span class="k">if</span> <span class="n">new_adw_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/Controller/adwin.py-195" name="src/Controller/adwin.py-195"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">adw</span> <span class="o">=</span> <span class="n">new_adw_handle</span>
</span><a id="src/Controller/adwin.py-196" name="src/Controller/adwin.py-196"></a>
<a id="src/Controller/adwin.py-197" name="src/Controller/adwin.py-197"></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1">#should stop all processes when ADwin is closed or a crash occures</span>
<a id="src/Controller/adwin.py-198" name="src/Controller/adwin.py-198"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/Controller/nanodrive.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Controller/nanodrive.py-106" name="src/Controller/nanodrive.py-106"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_initialized</span><span class="p">:</span>
<a id="src/Controller/nanodrive.py-107" name="src/Controller/nanodrive.py-107"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>     <span class="c1">#goes through inputed settings to see what commands to send ot update parameters</span>
<a id="src/Controller/nanodrive.py-108" name="src/Controller/nanodrive.py-108"></a>                <span class="c1">#print('nd updating: ',key,'to: ',value)</span>
<a id="src/Controller/nanodrive.py-109" name="src/Controller/nanodrive.py-109"></a>                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'serial'</span><span class="p">:</span>
<a id="src/Controller/nanodrive.py-110" name="src/Controller/nanodrive.py-110"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><a id="src/Controller/nanodrive.py-111" name="src/Controller/nanodrive.py-111"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_initilize_handle</span><span class="p">()</span>    <span class="c1">#changes handle under control</span>
<a id="src/Controller/nanodrive.py-112" name="src/Controller/nanodrive.py-112"></a>
<a id="src/Controller/nanodrive.py-113" name="src/Controller/nanodrive.py-113"></a>                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'x_pos'</span><span class="p">,</span><span class="s1">'y_pos'</span><span class="p">,</span><span class="s1">'z_pos'</span><span class="p">]:</span>      <span class="c1">#updates axis position</span>
<a id="src/Controller/nanodrive.py-114" name="src/Controller/nanodrive.py-114"></a>                    <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_to_internal</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/core/experiment.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment.py-441" name="src/core/experiment.py-441"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'save'</span><span class="p">]:</span>
<a id="src/core/experiment.py-442" name="src/core/experiment.py-442"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">()</span>
<a id="src/core/experiment.py-443" name="src/core/experiment.py-443"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">()</span>
<a id="src/core/experiment.py-444" name="src/core/experiment.py-444"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">save_image_to_disk</span><span class="p">()</span>
<a id="src/core/experiment.py-445" name="src/core/experiment.py-445"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">save_data_to_matlab</span><span class="p">()</span>
</span><a id="src/core/experiment.py-446" name="src/core/experiment.py-446"></a>
<a id="src/core/experiment.py-447" name="src/core/experiment.py-447"></a>        <span class="n">success</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abort</span>
<a id="src/core/experiment.py-448" name="src/core/experiment.py-448"></a>
<a id="src/core/experiment.py-449" name="src/core/experiment.py-449"></a>        <span class="c1"># disconnect subexperiments</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment.py-744" name="src/core/experiment.py-744"></a>                        <span class="c1">#item is any plot, image, label, etc item added to GraphicsLayoutWidget</span>
<a id="src/core/experiment.py-745" name="src/core/experiment.py-745"></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">pg</span><span class="o">.</span><span class="n">PlotItem</span><span class="p">):</span>
<a id="src/core/experiment.py-746" name="src/core/experiment.py-746"></a>                            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">listDataItems</span><span class="p">():</span>
<a id="src/core/experiment.py-747" name="src/core/experiment.py-747"></a>                                <span class="c1">#curve is any data that has been plotted on a PlotItem</span>
<a id="src/core/experiment.py-748" name="src/core/experiment.py-748"></a><span class="hll">                                <span class="k">if</span> <span class="n">curve</span><span class="o">.</span><span class="n">xData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">xData</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/core/experiment.py-749" name="src/core/experiment.py-749"></a><span class="hll">                                    <span class="k">return</span> <span class="kc">False</span>
</span><a id="src/core/experiment.py-750" name="src/core/experiment.py-750"></a>                            <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
<a id="src/core/experiment.py-751" name="src/core/experiment.py-751"></a>                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subitem</span><span class="p">,</span> <span class="n">pg</span><span class="o">.</span><span class="n">ImageItem</span><span class="p">)</span> <span class="ow">and</span> <span class="n">subitem</span><span class="o">.</span><span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/core/experiment.py-752" name="src/core/experiment.py-752"></a>                                    <span class="k">return</span> <span class="kc">False</span>
<a id="src/core/experiment.py-753" name="src/core/experiment.py-753"></a>            <span class="k">return</span> <span class="kc">True</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment.py-785" name="src/core/experiment.py-785"></a>        <span class="k">if</span> <span class="n">filename_1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nonempty</span><span class="p">(</span><span class="n">graph_1</span><span class="p">):</span>
<a id="src/core/experiment.py-786" name="src/core/experiment.py-786"></a>            <span class="n">exporter</span> <span class="o">=</span> <span class="n">ImageExporter</span><span class="p">(</span><span class="n">scene_1</span><span class="p">)</span>
<a id="src/core/experiment.py-787" name="src/core/experiment.py-787"></a>            <span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">filename_1</span><span class="p">)</span>
<a id="src/core/experiment.py-788" name="src/core/experiment.py-788"></a>        <span class="k">if</span> <span class="n">filename_2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_nonempty</span><span class="p">(</span><span class="n">graph_2</span><span class="p">):</span>
<a id="src/core/experiment.py-789" name="src/core/experiment.py-789"></a><span class="hll">            <span class="n">exporter</span> <span class="o">=</span> <span class="n">ImageExporter</span><span class="p">(</span><span class="n">scene_2</span><span class="p">)</span>
</span><a id="src/core/experiment.py-790" name="src/core/experiment.py-790"></a><span class="hll">            <span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">filename_2</span><span class="p">)</span>
</span><a id="src/core/experiment.py-791" name="src/core/experiment.py-791"></a>
<a id="src/core/experiment.py-792" name="src/core/experiment.py-792"></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<a id="src/core/experiment.py-793" name="src/core/experiment.py-793"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/core/experiment.py-794" name="src/core/experiment.py-794"></a><span class="sd">        saves the instance of the experiment to a file using pickle</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment.py-811" name="src/core/experiment.py-811"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="src/core/experiment.py-812" name="src/core/experiment.py-812"></a>
<a id="src/core/experiment.py-813" name="src/core/experiment.py-813"></a>        <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'tag'</span><span class="p">]</span>
<a id="src/core/experiment.py-814" name="src/core/experiment.py-814"></a>        <span class="k">if</span> <span class="s1">' '</span> <span class="ow">in</span> <span class="n">tag</span> <span class="ow">or</span> <span class="s1">'.'</span> <span class="ow">in</span> <span class="n">tag</span> <span class="ow">or</span> <span class="s1">'+'</span> <span class="ow">in</span> <span class="n">tag</span> <span class="ow">or</span> <span class="s1">'-'</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">:</span>
<a id="src/core/experiment.py-815" name="src/core/experiment.py-815"></a><span class="hll">            <span class="n">good_tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'+'</span><span class="p">,</span> <span class="s1">'P'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="s1">'M'</span><span class="p">)</span>
</span><a id="src/core/experiment.py-816" name="src/core/experiment.py-816"></a>            <span class="c1">#matlab structs cant include spaces, dots, or plus/minus so replace with other characters</span>
<a id="src/core/experiment.py-817" name="src/core/experiment.py-817"></a>            <span class="c1">#other disallowed characters but not used in our naming schemes so checks as of now</span>
<a id="src/core/experiment.py-818" name="src/core/experiment.py-818"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/experiment.py-819" name="src/core/experiment.py-819"></a>            <span class="n">good_tag</span> <span class="o">=</span> <span class="n">tag</span>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/core/experiment_iterator.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment_iterator.py-116" name="src/core/experiment_iterator.py-116"></a><span class="sd">            """</span>
<a id="src/core/experiment_iterator.py-117" name="src/core/experiment_iterator.py-117"></a>            <span class="c1"># in both cases, param values have tolist to make sure that they are python types (ex float) rather than numpy</span>
<a id="src/core/experiment_iterator.py-118" name="src/core/experiment_iterator.py-118"></a>            <span class="c1"># types (ex np.float64), the latter of which can cause typing issues</span>
<a id="src/core/experiment_iterator.py-119" name="src/core/experiment_iterator.py-119"></a>            <span class="n">sweep_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'sweep_range'</span><span class="p">]</span>
<a id="src/core/experiment_iterator.py-120" name="src/core/experiment_iterator.py-120"></a><span class="hll">            <span class="n">param_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sweep_range</span><span class="p">[</span><span class="s1">'N/value_step'</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><a id="src/core/experiment_iterator.py-121" name="src/core/experiment_iterator.py-121"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'stepping_mode'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'N'</span><span class="p">:</span>
<a id="src/core/experiment_iterator.py-122" name="src/core/experiment_iterator.py-122"></a>                <span class="n">param_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">sweep_range</span><span class="p">[</span><span class="s1">'min_value'</span><span class="p">],</span> <span class="n">sweep_range</span><span class="p">[</span><span class="s1">'max_value'</span><span class="p">],</span>
<a id="src/core/experiment_iterator.py-123" name="src/core/experiment_iterator.py-123"></a>                                           <span class="nb">int</span><span class="p">(</span><span class="n">sweep_range</span><span class="p">[</span><span class="s1">'N/value_step'</span><span class="p">]),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="src/core/experiment_iterator.py-124" name="src/core/experiment_iterator.py-124"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'stepping_mode'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'value_step'</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment_iterator.py-150" name="src/core/experiment_iterator.py-150"></a>                <span class="k">return</span> <span class="n">experiment_list</span><span class="p">,</span> <span class="n">parameter_list</span>
<a id="src/core/experiment_iterator.py-151" name="src/core/experiment_iterator.py-151"></a>
<a id="src/core/experiment_iterator.py-152" name="src/core/experiment_iterator.py-152"></a>            <span class="n">param_values</span> <span class="o">=</span> <span class="n">get_sweep_parameters</span><span class="p">()</span>
<a id="src/core/experiment_iterator.py-153" name="src/core/experiment_iterator.py-153"></a>
<a id="src/core/experiment_iterator.py-154" name="src/core/experiment_iterator.py-154"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s1">'GD parameters before'</span><span class="p">,</span> <span class="n">param_values</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-155" name="src/core/experiment_iterator.py-155"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'sweep_range'</span><span class="p">][</span><span class="s1">'randomize'</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<a id="src/core/experiment_iterator.py-156" name="src/core/experiment_iterator.py-156"></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">param_values</span><span class="p">)</span>
<a id="src/core/experiment_iterator.py-157" name="src/core/experiment_iterator.py-157"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s1">'GD parameters after'</span><span class="p">,</span> <span class="n">param_values</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-158" name="src/core/experiment_iterator.py-158"></a>
<a id="src/core/experiment_iterator.py-159" name="src/core/experiment_iterator.py-159"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_values</span><span class="p">):</span>
<a id="src/core/experiment_iterator.py-160" name="src/core/experiment_iterator.py-160"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">iterator_progress</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_values</span><span class="p">)</span>
<a id="src/core/experiment_iterator.py-161" name="src/core/experiment_iterator.py-161"></a><span class="hll">                <span class="n">previous_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/core/experiment_iterator.py-162" name="src/core/experiment_iterator.py-162"></a>
<a id="src/core/experiment_iterator.py-163" name="src/core/experiment_iterator.py-163"></a>                <span class="n">experiment_list</span><span class="p">,</span> <span class="n">parameter_list</span> <span class="o">=</span> <span class="n">get_experiment_and_settings_from_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'sweep_param'</span><span class="p">])</span>
<a id="src/core/experiment_iterator.py-164" name="src/core/experiment_iterator.py-164"></a>                <span class="n">experiment</span> <span class="o">=</span> <span class="bp">self</span>
<a id="src/core/experiment_iterator.py-165" name="src/core/experiment_iterator.py-165"></a>                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment_iterator.py-188" name="src/core/experiment_iterator.py-188"></a>                    <span class="k">if</span> <span class="n">curr_experiment_exec_freq</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">%</span> <span class="n">curr_experiment_exec_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="src/core/experiment_iterator.py-189" name="src/core/experiment_iterator.py-189"></a>
<a id="src/core/experiment_iterator.py-190" name="src/core/experiment_iterator.py-190"></a>                        <span class="c1">#for some experiments we want to inherit data from the previous experiment (for example NV locations from SelectPoints to use in say ODMR</span>
<a id="src/core/experiment_iterator.py-191" name="src/core/experiment_iterator.py-191"></a>                        <span class="c1">#to use you want an inherit data parameter in the experiment settings. Could be expanded depending on use cases</span>
<a id="src/core/experiment_iterator.py-192" name="src/core/experiment_iterator.py-192"></a><span class="hll">                        <span class="k">if</span> <span class="n">previous_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-193" name="src/core/experiment_iterator.py-193"></a><span class="hll">                            <span class="k">if</span> <span class="s1">'inherit_data'</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'inherit_data'</span><span class="p">]:</span>
</span><a id="src/core/experiment_iterator.py-194" name="src/core/experiment_iterator.py-194"></a><span class="hll">                                <span class="n">common_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">previous_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><a id="src/core/experiment_iterator.py-195" name="src/core/experiment_iterator.py-195"></a><span class="hll">                                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">common_keys</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-196" name="src/core/experiment_iterator.py-196"></a><span class="hll">                                    <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><a id="src/core/experiment_iterator.py-197" name="src/core/experiment_iterator.py-197"></a>
<a id="src/core/experiment_iterator.py-198" name="src/core/experiment_iterator.py-198"></a>                        <span class="c1"># i+1 so first execution is mth loop, not first</span>
<a id="src/core/experiment_iterator.py-199" name="src/core/experiment_iterator.py-199"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'starting </span><span class="si">{:s}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">))</span>
<a id="src/core/experiment_iterator.py-200" name="src/core/experiment_iterator.py-200"></a>                        <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'tag'</span><span class="p">]</span>
<a id="src/core/experiment_iterator.py-201" name="src/core/experiment_iterator.py-201"></a><span class="hll">                        <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'tag'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{:s}</span><span class="s1">_</span><span class="si">{:s}</span><span class="s1">_</span><span class="si">{:0.3e}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-202" name="src/core/experiment_iterator.py-202"></a>                        <span class="c1">#ensure settings and data are deepcopys so multiple iterations dont change old values</span>
<a id="src/core/experiment_iterator.py-203" name="src/core/experiment_iterator.py-203"></a><span class="hll">                        <span class="n">settings</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-204" name="src/core/experiment_iterator.py-204"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<a id="src/core/experiment_iterator.py-205" name="src/core/experiment_iterator.py-205"></a>
<a id="src/core/experiment_iterator.py-206" name="src/core/experiment_iterator.py-206"></a><span class="hll">                        <span class="n">it_level_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'_iterator_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iterator_level</span><span class="si">}</span><span class="s1">'</span>
</span><a id="src/core/experiment_iterator.py-207" name="src/core/experiment_iterator.py-207"></a><span class="hll">                        <span class="n">python_scan_info_dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'scan_parameter'</span><span class="o">+</span><span class="n">it_level_str</span><span class="p">:</span><span class="n">parameter_name</span><span class="p">,</span><span class="s1">'scan_current_value'</span><span class="o">+</span><span class="n">it_level_str</span><span class="p">:</span><span class="n">value</span><span class="p">,</span> <span class="s1">'scan_all_values'</span><span class="o">+</span><span class="n">it_level_str</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">param_values</span><span class="p">)}</span>
</span><a id="src/core/experiment_iterator.py-208" name="src/core/experiment_iterator.py-208"></a><span class="hll">                        <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-209" name="src/core/experiment_iterator.py-209"></a>
<a id="src/core/experiment_iterator.py-210" name="src/core/experiment_iterator.py-210"></a>                        <span class="c1">#adds to self.data a key of the current experiment tage with a value that is a lsit of [data, settings, scan_infor] for current experiment</span>
<a id="src/core/experiment_iterator.py-211" name="src/core/experiment_iterator.py-211"></a><span class="hll">                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'tag'</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">python_scan_info_dic</span><span class="p">]</span>
</span><a id="src/core/experiment_iterator.py-212" name="src/core/experiment_iterator.py-212"></a>
<a id="src/core/experiment_iterator.py-213" name="src/core/experiment_iterator.py-213"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'tag'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span>
<a id="src/core/experiment_iterator.py-214" name="src/core/experiment_iterator.py-214"></a><span class="hll">                        <span class="n">previous_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</span><a id="src/core/experiment_iterator.py-215" name="src/core/experiment_iterator.py-215"></a>
<a id="src/core/experiment_iterator.py-216" name="src/core/experiment_iterator.py-216"></a>
<a id="src/core/experiment_iterator.py-217" name="src/core/experiment_iterator.py-217"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterator_type</span> <span class="o">==</span> <span class="s1">'loop'</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment_iterator.py-223" name="src/core/experiment_iterator.py-223"></a>
<a id="src/core/experiment_iterator.py-224" name="src/core/experiment_iterator.py-224"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<a id="src/core/experiment_iterator.py-225" name="src/core/experiment_iterator.py-225"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_loops</span><span class="p">):</span>
<a id="src/core/experiment_iterator.py-226" name="src/core/experiment_iterator.py-226"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">iterator_progress</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_loops</span>
<a id="src/core/experiment_iterator.py-227" name="src/core/experiment_iterator.py-227"></a><span class="hll">                <span class="n">previous_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/core/experiment_iterator.py-228" name="src/core/experiment_iterator.py-228"></a>
<a id="src/core/experiment_iterator.py-229" name="src/core/experiment_iterator.py-229"></a>                <span class="k">for</span> <span class="n">experiment_name</span> <span class="ow">in</span> <span class="n">sorted_experiment_names</span><span class="p">:</span>
<a id="src/core/experiment_iterator.py-230" name="src/core/experiment_iterator.py-230"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abort</span><span class="p">:</span>
<a id="src/core/experiment_iterator.py-231" name="src/core/experiment_iterator.py-231"></a>                        <span class="k">break</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment_iterator.py-236" name="src/core/experiment_iterator.py-236"></a>                    <span class="k">if</span> <span class="n">curr_experiment_execution_freq</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">j</span> <span class="o">%</span> <span class="n">curr_experiment_execution_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="src/core/experiment_iterator.py-237" name="src/core/experiment_iterator.py-237"></a>
<a id="src/core/experiment_iterator.py-238" name="src/core/experiment_iterator.py-238"></a>                        <span class="c1">#for some experiments we want to inherit data from the previous experiment (for example NV locations from SelectPoints to use in say ODMR</span>
<a id="src/core/experiment_iterator.py-239" name="src/core/experiment_iterator.py-239"></a>                        <span class="c1">#to use you want an inherit data parameter in the experiment settings. Could be expanded depending on use cases</span>
<a id="src/core/experiment_iterator.py-240" name="src/core/experiment_iterator.py-240"></a><span class="hll">                        <span class="k">if</span> <span class="n">previous_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-241" name="src/core/experiment_iterator.py-241"></a><span class="hll">                            <span class="k">if</span> <span class="s1">'inherit_data'</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'inherit_data'</span><span class="p">]:</span>
</span><a id="src/core/experiment_iterator.py-242" name="src/core/experiment_iterator.py-242"></a><span class="hll">                                <span class="n">common_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">previous_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><a id="src/core/experiment_iterator.py-243" name="src/core/experiment_iterator.py-243"></a><span class="hll">                                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">common_keys</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-244" name="src/core/experiment_iterator.py-244"></a><span class="hll">                                    <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><a id="src/core/experiment_iterator.py-245" name="src/core/experiment_iterator.py-245"></a>
<a id="src/core/experiment_iterator.py-246" name="src/core/experiment_iterator.py-246"></a>                        <span class="c1"># i+1 so first execution is mth loop, not first</span>
<a id="src/core/experiment_iterator.py-247" name="src/core/experiment_iterator.py-247"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'starting </span><span class="si">{:s}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"> iteration </span><span class="si">{:d}</span><span class="s1"> of </span><span class="si">{:d}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_loops</span><span class="p">))</span>
<a id="src/core/experiment_iterator.py-248" name="src/core/experiment_iterator.py-248"></a>                        <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'tag'</span><span class="p">]</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment_iterator.py-250" name="src/core/experiment_iterator.py-250"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'tag'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="src/core/experiment_iterator.py-251" name="src/core/experiment_iterator.py-251"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<a id="src/core/experiment_iterator.py-252" name="src/core/experiment_iterator.py-252"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'tag'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span>
<a id="src/core/experiment_iterator.py-253" name="src/core/experiment_iterator.py-253"></a>
<a id="src/core/experiment_iterator.py-254" name="src/core/experiment_iterator.py-254"></a><span class="hll">                        <span class="n">previous_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</span><a id="src/core/experiment_iterator.py-255" name="src/core/experiment_iterator.py-255"></a>
<a id="src/core/experiment_iterator.py-256" name="src/core/experiment_iterator.py-256"></a>                <span class="c1"># from the last experiment we take the average of the data as the data of the iterator experiment</span>
<a id="src/core/experiment_iterator.py-257" name="src/core/experiment_iterator.py-257"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="src/core/experiment_iterator.py-258" name="src/core/experiment_iterator.py-258"></a>                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiments</span><span class="p">[</span><span class="n">experiment_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/experiment_iterator.py-418" name="src/core/experiment_iterator.py-418"></a>        <span class="n">loop_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_subexperiment_stage</span><span class="p">[</span><span class="s1">'subexperiment_exec_count'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="src/core/experiment_iterator.py-419" name="src/core/experiment_iterator.py-419"></a>        <span class="k">return</span> <span class="n">loop_index</span>
<a id="src/core/experiment_iterator.py-420" name="src/core/experiment_iterator.py-420"></a>
<a id="src/core/experiment_iterator.py-421" name="src/core/experiment_iterator.py-421"></a>    <span class="k">def</span> <span class="nf">save_data_to_matlab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="src/core/experiment_iterator.py-422" name="src/core/experiment_iterator.py-422"></a><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterator_type</span> <span class="o">==</span> <span class="s1">'loop'</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-423" name="src/core/experiment_iterator.py-423"></a>            <span class="c1">#for loop the experiment data is averaged so its structure is similar to a single experiment; default to normal behavior</span>
<a id="src/core/experiment_iterator.py-424" name="src/core/experiment_iterator.py-424"></a><span class="hll">            <span class="n">Experiment</span><span class="o">.</span><span class="n">save_data_to_matlab</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-425" name="src/core/experiment_iterator.py-425"></a>
<a id="src/core/experiment_iterator.py-426" name="src/core/experiment_iterator.py-426"></a><span class="hll">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterator_type</span> <span class="o">==</span> <span class="s1">'sweep'</span><span class="p">:</span> <span class="c1">#for sweeps need more complex structure</span>
</span><a id="src/core/experiment_iterator.py-427" name="src/core/experiment_iterator.py-427"></a>            <span class="c1">#does not include the settings of each iterator level as the important info is in the inherited scan info</span>
<a id="src/core/experiment_iterator.py-428" name="src/core/experiment_iterator.py-428"></a><span class="hll">            <span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">current_level</span><span class="p">,</span> <span class="n">target_level</span><span class="p">,</span> <span class="n">inherited_scan_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><a id="src/core/experiment_iterator.py-429" name="src/core/experiment_iterator.py-429"></a><span class="hll">                <span class="n">it_level_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'_iterator_</span><span class="si">{</span><span class="n">target_level</span><span class="o">-</span><span class="n">current_level</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">'</span>
</span><a id="src/core/experiment_iterator.py-430" name="src/core/experiment_iterator.py-430"></a><span class="hll">                <span class="k">if</span> <span class="n">inherited_scan_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-431" name="src/core/experiment_iterator.py-431"></a><span class="hll">                    <span class="n">inherited_scan_info</span> <span class="o">=</span> <span class="p">{}</span>
</span><a id="src/core/experiment_iterator.py-432" name="src/core/experiment_iterator.py-432"></a><span class="hll">                <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/core/experiment_iterator.py-433" name="src/core/experiment_iterator.py-433"></a><span class="hll">                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><a id="src/core/experiment_iterator.py-434" name="src/core/experiment_iterator.py-434"></a>                    <span class="c1">#sweep_1_y_1.000e+00:[{exp_1:[dic(data),dic(settings),dic(scan_params),'exp_2:[dic(data),dic(settings),dic(scan_params),'exp_3:[dic(data),dic(settings),dic(scan_params)]},</span>
<a id="src/core/experiment_iterator.py-435" name="src/core/experiment_iterator.py-435"></a>                                         <span class="c1">#dic(settings),dic(scan_params)</span>
<a id="src/core/experiment_iterator.py-436" name="src/core/experiment_iterator.py-436"></a><span class="hll">                    <span class="n">next_dic_level</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/core/experiment_iterator.py-437" name="src/core/experiment_iterator.py-437"></a><span class="hll">                    <span class="n">current_level_settings</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><a id="src/core/experiment_iterator.py-438" name="src/core/experiment_iterator.py-438"></a><span class="hll">                    <span class="n">current_level_scan_info_raw</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><a id="src/core/experiment_iterator.py-439" name="src/core/experiment_iterator.py-439"></a>
<a id="src/core/experiment_iterator.py-440" name="src/core/experiment_iterator.py-440"></a><span class="hll">                    <span class="n">scan_variable</span> <span class="o">=</span> <span class="n">current_level_scan_info_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'scan_parameter'</span> <span class="o">+</span> <span class="n">it_level_str</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-441" name="src/core/experiment_iterator.py-441"></a><span class="hll">                    <span class="n">scan_var_current_value</span> <span class="o">=</span> <span class="n">current_level_scan_info_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'scan_current_value'</span> <span class="o">+</span> <span class="n">it_level_str</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-442" name="src/core/experiment_iterator.py-442"></a><span class="hll">                    <span class="n">scan_var_all_values</span> <span class="o">=</span> <span class="n">current_level_scan_info_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'scan_all_values'</span> <span class="o">+</span> <span class="n">it_level_str</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-443" name="src/core/experiment_iterator.py-443"></a>
<a id="src/core/experiment_iterator.py-444" name="src/core/experiment_iterator.py-444"></a><span class="hll">                    <span class="n">updated_scan_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inherited_scan_info</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-445" name="src/core/experiment_iterator.py-445"></a><span class="hll">                    <span class="n">updated_scan_info</span><span class="p">[</span><span class="s1">'scan_parameter'</span> <span class="o">+</span> <span class="n">it_level_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_variable</span>
</span><a id="src/core/experiment_iterator.py-446" name="src/core/experiment_iterator.py-446"></a><span class="hll">                    <span class="n">updated_scan_info</span><span class="p">[</span><span class="s1">'scan_current_value'</span> <span class="o">+</span> <span class="n">it_level_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_var_current_value</span>
</span><a id="src/core/experiment_iterator.py-447" name="src/core/experiment_iterator.py-447"></a><span class="hll">                    <span class="n">updated_scan_info</span><span class="p">[</span><span class="s1">'scan_all_values'</span> <span class="o">+</span> <span class="n">it_level_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_var_all_values</span>
</span><a id="src/core/experiment_iterator.py-448" name="src/core/experiment_iterator.py-448"></a>
<a id="src/core/experiment_iterator.py-449" name="src/core/experiment_iterator.py-449"></a><span class="hll">                    <span class="k">if</span> <span class="n">current_level</span> <span class="o">&lt;</span> <span class="n">target_level</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-450" name="src/core/experiment_iterator.py-450"></a>
<a id="src/core/experiment_iterator.py-451" name="src/core/experiment_iterator.py-451"></a><span class="hll">                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><a id="src/core/experiment_iterator.py-452" name="src/core/experiment_iterator.py-452"></a><span class="hll">                            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extract_data</span><span class="p">(</span><span class="n">next_dic_level</span><span class="p">,</span> <span class="n">current_level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">target_level</span><span class="p">,</span> <span class="n">updated_scan_info</span><span class="p">))</span>
</span><a id="src/core/experiment_iterator.py-453" name="src/core/experiment_iterator.py-453"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="src/core/experiment_iterator.py-454" name="src/core/experiment_iterator.py-454"></a><span class="hll">                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"In matlab saving: Unexpected structure at level </span><span class="si">{</span><span class="n">current_level</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-455" name="src/core/experiment_iterator.py-455"></a>
<a id="src/core/experiment_iterator.py-456" name="src/core/experiment_iterator.py-456"></a><span class="hll">                    <span class="k">elif</span> <span class="n">current_level</span> <span class="o">==</span> <span class="n">target_level</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-457" name="src/core/experiment_iterator.py-457"></a><span class="hll">                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-458" name="src/core/experiment_iterator.py-458"></a>
<a id="src/core/experiment_iterator.py-459" name="src/core/experiment_iterator.py-459"></a><span class="hll">                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">next_dic_level</span><span class="p">,</span> <span class="n">current_level_settings</span><span class="p">,</span> <span class="n">updated_scan_info</span><span class="p">))</span>
</span><a id="src/core/experiment_iterator.py-460" name="src/core/experiment_iterator.py-460"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="src/core/experiment_iterator.py-461" name="src/core/experiment_iterator.py-461"></a><span class="hll">                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"In matlab saving: Invalid leaf data at level </span><span class="si">{</span><span class="n">current_level</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-462" name="src/core/experiment_iterator.py-462"></a>
<a id="src/core/experiment_iterator.py-463" name="src/core/experiment_iterator.py-463"></a><span class="hll">                <span class="k">return</span> <span class="n">result</span>
</span><a id="src/core/experiment_iterator.py-464" name="src/core/experiment_iterator.py-464"></a>
<a id="src/core/experiment_iterator.py-465" name="src/core/experiment_iterator.py-465"></a>
<a id="src/core/experiment_iterator.py-466" name="src/core/experiment_iterator.py-466"></a><span class="hll">            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-467" name="src/core/experiment_iterator.py-467"></a><span class="hll">                <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="s1">'.mat'</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-468" name="src/core/experiment_iterator.py-468"></a><span class="hll">            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-469" name="src/core/experiment_iterator.py-469"></a>
<a id="src/core/experiment_iterator.py-470" name="src/core/experiment_iterator.py-470"></a><span class="hll">            <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'tag'</span><span class="p">]</span>
</span><a id="src/core/experiment_iterator.py-471" name="src/core/experiment_iterator.py-471"></a><span class="hll">            <span class="k">if</span> <span class="s1">' '</span> <span class="ow">in</span> <span class="n">tag</span> <span class="ow">or</span> <span class="s1">'.'</span> <span class="ow">in</span> <span class="n">tag</span> <span class="ow">or</span> <span class="s1">'+'</span> <span class="ow">in</span> <span class="n">tag</span> <span class="ow">or</span> <span class="s1">'-'</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-472" name="src/core/experiment_iterator.py-472"></a><span class="hll">                <span class="n">good_tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'+'</span><span class="p">,</span> <span class="s1">'P'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="s1">'M'</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-473" name="src/core/experiment_iterator.py-473"></a>                <span class="c1"># matlab structs cant include spaces, dots, or plus/minus so replace with other characters</span>
<a id="src/core/experiment_iterator.py-474" name="src/core/experiment_iterator.py-474"></a>                <span class="c1"># other disallowed characters but not used in our naming schemes so checks as of now</span>
<a id="src/core/experiment_iterator.py-475" name="src/core/experiment_iterator.py-475"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/core/experiment_iterator.py-476" name="src/core/experiment_iterator.py-476"></a><span class="hll">                <span class="n">good_tag</span> <span class="o">=</span> <span class="n">tag</span>
</span><a id="src/core/experiment_iterator.py-477" name="src/core/experiment_iterator.py-477"></a>            <span class="c1">#add 'data_' to ensure field name does not start with a number</span>
<a id="src/core/experiment_iterator.py-478" name="src/core/experiment_iterator.py-478"></a><span class="hll">            <span class="n">good_tag</span> <span class="o">=</span> <span class="s1">'data_'</span> <span class="o">+</span> <span class="n">good_tag</span>
</span><a id="src/core/experiment_iterator.py-479" name="src/core/experiment_iterator.py-479"></a>
<a id="src/core/experiment_iterator.py-480" name="src/core/experiment_iterator.py-480"></a><span class="hll">            <span class="n">mat_saver</span> <span class="o">=</span> <span class="n">MatlabSaver</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">good_tag</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-481" name="src/core/experiment_iterator.py-481"></a><span class="hll">            <span class="n">data_tuples</span> <span class="o">=</span> <span class="n">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">current_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">target_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterator_level</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-482" name="src/core/experiment_iterator.py-482"></a>            <span class="c1">#print('data_tuples',data_tuples)</span>
<a id="src/core/experiment_iterator.py-483" name="src/core/experiment_iterator.py-483"></a><span class="hll">            <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">combined_scan_info</span> <span class="ow">in</span> <span class="n">data_tuples</span><span class="p">:</span>
</span><a id="src/core/experiment_iterator.py-484" name="src/core/experiment_iterator.py-484"></a><span class="hll">                <span class="n">mat_saver</span><span class="o">.</span><span class="n">add_experiment_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">iterator_info_dic</span><span class="o">=</span><span class="n">combined_scan_info</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-485" name="src/core/experiment_iterator.py-485"></a>
<a id="src/core/experiment_iterator.py-486" name="src/core/experiment_iterator.py-486"></a><span class="hll">            <span class="n">structured_data</span> <span class="o">=</span> <span class="n">mat_saver</span><span class="o">.</span><span class="n">get_structured_data</span><span class="p">()</span>
</span><a id="src/core/experiment_iterator.py-487" name="src/core/experiment_iterator.py-487"></a><span class="hll">            <span class="n">savemat</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">structured_data</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-488" name="src/core/experiment_iterator.py-488"></a>
<a id="src/core/experiment_iterator.py-489" name="src/core/experiment_iterator.py-489"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/experiment_iterator.py-490" name="src/core/experiment_iterator.py-490"></a><span class="hll">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'wrong iterator type'</span><span class="p">)</span>
</span><a id="src/core/experiment_iterator.py-491" name="src/core/experiment_iterator.py-491"></a>
<a id="src/core/experiment_iterator.py-492" name="src/core/experiment_iterator.py-492"></a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_list</span><span class="p">):</span>
<a id="src/core/experiment_iterator.py-493" name="src/core/experiment_iterator.py-493"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/core/experiment_iterator.py-494" name="src/core/experiment_iterator.py-494"></a><span class="sd">        When each subexperiment is called, uses its standard plotting</span>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/core/helper_functions.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-216" name="src/core/helper_functions.py-216"></a><span class="sd">        data_2_layer = [[ex_data_1, ex_data_2],[ex_data_3, ex_data_4]]</span>
<a id="src/core/helper_functions.py-217" name="src/core/helper_functions.py-217"></a><span class="sd">        settings_2_layer = [[ex_settings_1, ex_settings_2],[ex_settings_3, ex_settings_4]]</span>
<a id="src/core/helper_functions.py-218" name="src/core/helper_functions.py-218"></a><span class="sd">        structure_data_for_hdf5(filename=filename+'.hdf5',data=data_2_layer, settings=settings_2_layer)</span>
<a id="src/core/helper_functions.py-219" name="src/core/helper_functions.py-219"></a><span class="sd">    '''</span>
<a id="src/core/helper_functions.py-220" name="src/core/helper_functions.py-220"></a><span class="hll">    <span class="k">def</span> <span class="nf">guess_numpy_dtype</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-221" name="src/core/helper_functions.py-221"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/core/helper_functions.py-222" name="src/core/helper_functions.py-222"></a><span class="sd">        Gets type of inputed value; skips dictionaries as they are recursivly unpacked</span>
<a id="src/core/helper_functions.py-223" name="src/core/helper_functions.py-223"></a><span class="sd">        '''</span>
<a id="src/core/helper_functions.py-224" name="src/core/helper_functions.py-224"></a><span class="hll">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-225" name="src/core/helper_functions.py-225"></a><span class="hll">            <span class="k">return</span> <span class="s1">'f8'</span>
</span><a id="src/core/helper_functions.py-226" name="src/core/helper_functions.py-226"></a><span class="hll">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>  <span class="c1"># need to put bool before int as True/False are technically 1/0</span>
</span><a id="src/core/helper_functions.py-227" name="src/core/helper_functions.py-227"></a><span class="hll">            <span class="k">return</span> <span class="s1">'bool'</span>
</span><a id="src/core/helper_functions.py-228" name="src/core/helper_functions.py-228"></a><span class="hll">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-229" name="src/core/helper_functions.py-229"></a><span class="hll">            <span class="k">return</span> <span class="s1">'i4'</span>
</span><a id="src/core/helper_functions.py-230" name="src/core/helper_functions.py-230"></a><span class="hll">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-231" name="src/core/helper_functions.py-231"></a><span class="hll">            <span class="k">return</span> <span class="s1">'S</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># +1 so empty string (S0) dont casue an error</span>
</span><a id="src/core/helper_functions.py-232" name="src/core/helper_functions.py-232"></a><span class="hll">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-233" name="src/core/helper_functions.py-233"></a><span class="hll">            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span>
</span><a id="src/core/helper_functions.py-234" name="src/core/helper_functions.py-234"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-235" name="src/core/helper_functions.py-235"></a><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'hdf5 unsupported data type'</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-236" name="src/core/helper_functions.py-236"></a>
<a id="src/core/helper_functions.py-237" name="src/core/helper_functions.py-237"></a><span class="hll">    <span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-238" name="src/core/helper_functions.py-238"></a><span class="hll">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-239" name="src/core/helper_functions.py-239"></a><span class="hll">            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span>
</span><a id="src/core/helper_functions.py-240" name="src/core/helper_functions.py-240"></a><span class="hll">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><a id="src/core/helper_functions.py-241" name="src/core/helper_functions.py-241"></a><span class="hll">            <span class="k">try</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-242" name="src/core/helper_functions.py-242"></a><span class="hll">                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</span><a id="src/core/helper_functions.py-243" name="src/core/helper_functions.py-243"></a><span class="hll">            <span class="k">except</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-244" name="src/core/helper_functions.py-244"></a><span class="hll">                <span class="k">return</span> <span class="p">()</span>  <span class="c1"># fallback if conversion fails</span>
</span><a id="src/core/helper_functions.py-245" name="src/core/helper_functions.py-245"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-246" name="src/core/helper_functions.py-246"></a><span class="hll">            <span class="k">return</span> <span class="p">()</span>  <span class="c1"># scalar or unknown type</span>
</span><a id="src/core/helper_functions.py-247" name="src/core/helper_functions.py-247"></a>
<a id="src/core/helper_functions.py-248" name="src/core/helper_functions.py-248"></a><span class="hll">    <span class="k">def</span> <span class="nf">write_dict_to_hdf5</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="n">dic</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-249" name="src/core/helper_functions.py-249"></a><span class="hll">        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><a id="src/core/helper_functions.py-250" name="src/core/helper_functions.py-250"></a><span class="hll">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-251" name="src/core/helper_functions.py-251"></a><span class="hll">                <span class="n">sub_group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-252" name="src/core/helper_functions.py-252"></a><span class="hll">                <span class="n">write_dict_to_hdf5</span><span class="p">(</span><span class="n">sub_group</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-253" name="src/core/helper_functions.py-253"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-254" name="src/core/helper_functions.py-254"></a><span class="hll">                <span class="n">value_type</span> <span class="o">=</span> <span class="n">guess_numpy_dtype</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-255" name="src/core/helper_functions.py-255"></a><span class="hll">                <span class="n">value_shape</span> <span class="o">=</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-256" name="src/core/helper_functions.py-256"></a><span class="hll">                <span class="n">dset</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">value_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">value_type</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-257" name="src/core/helper_functions.py-257"></a>
<a id="src/core/helper_functions.py-258" name="src/core/helper_functions.py-258"></a>    <span class="c1">#data and settings should be in lists</span>
<a id="src/core/helper_functions.py-259" name="src/core/helper_functions.py-259"></a><span class="hll">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-260" name="src/core/helper_functions.py-260"></a><span class="hll">        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
</span><a id="src/core/helper_functions.py-261" name="src/core/helper_functions.py-261"></a><span class="hll">    <span class="k">if</span> <span class="n">settings</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-262" name="src/core/helper_functions.py-262"></a><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span> <span class="c1">#should have a settings for each data dictionary</span>
</span><a id="src/core/helper_functions.py-263" name="src/core/helper_functions.py-263"></a><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"settings and data must be lists of equal length"</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-264" name="src/core/helper_functions.py-264"></a><span class="hll">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-265" name="src/core/helper_functions.py-265"></a><span class="hll">            <span class="n">settings</span> <span class="o">=</span> <span class="p">[</span><span class="n">settings</span><span class="p">]</span>
</span><a id="src/core/helper_functions.py-266" name="src/core/helper_functions.py-266"></a><span class="hll">    <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-267" name="src/core/helper_functions.py-267"></a><span class="hll">        <span class="n">tag</span> <span class="o">=</span> <span class="s1">'unnamed_experiment'</span>
</span><a id="src/core/helper_functions.py-268" name="src/core/helper_functions.py-268"></a>
<a id="src/core/helper_functions.py-269" name="src/core/helper_functions.py-269"></a><span class="hll">    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-270" name="src/core/helper_functions.py-270"></a><span class="hll">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-271" name="src/core/helper_functions.py-271"></a><span class="hll">            <span class="n">group</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">tag</span><span class="o">+</span><span class="sa">f</span><span class="s1">'_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-272" name="src/core/helper_functions.py-272"></a><span class="hll">            <span class="n">write_dict_to_hdf5</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">dic</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-273" name="src/core/helper_functions.py-273"></a>
<a id="src/core/helper_functions.py-274" name="src/core/helper_functions.py-274"></a><span class="hll">            <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-275" name="src/core/helper_functions.py-275"></a><span class="hll">                <span class="n">specific_settings</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><a id="src/core/helper_functions.py-276" name="src/core/helper_functions.py-276"></a><span class="hll">                <span class="n">settings_group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">'settings'</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-277" name="src/core/helper_functions.py-277"></a><span class="hll">                <span class="n">write_dict_to_hdf5</span><span class="p">(</span><span class="n">settings_group</span><span class="p">,</span> <span class="n">specific_settings</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-278" name="src/core/helper_functions.py-278"></a>
<a id="src/core/helper_functions.py-279" name="src/core/helper_functions.py-279"></a><span class="k">class</span> <span class="nc">MatlabSaver</span><span class="p">:</span>
<a id="src/core/helper_functions.py-280" name="src/core/helper_functions.py-280"></a>
<a id="src/core/helper_functions.py-281" name="src/core/helper_functions.py-281"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-279" name="src/core/helper_functions.py-279"></a><span class="k">class</span> <span class="nc">MatlabSaver</span><span class="p">:</span>
<a id="src/core/helper_functions.py-280" name="src/core/helper_functions.py-280"></a>
<a id="src/core/helper_functions.py-281" name="src/core/helper_functions.py-281"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="src/core/helper_functions.py-282" name="src/core/helper_functions.py-282"></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/core/helper_functions.py-283" name="src/core/helper_functions.py-283"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s1">'unnamed_experiment'</span>
</span><a id="src/core/helper_functions.py-284" name="src/core/helper_functions.py-284"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-285" name="src/core/helper_functions.py-285"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
<a id="src/core/helper_functions.py-286" name="src/core/helper_functions.py-286"></a>
<a id="src/core/helper_functions.py-287" name="src/core/helper_functions.py-287"></a>        <span class="c1">#list to be populated by add_experiment_data method to check shape and alter data if needed</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-320" name="src/core/helper_functions.py-320"></a>            <span class="n">field_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value_shape</span><span class="p">)</span>
<a id="src/core/helper_functions.py-321" name="src/core/helper_functions.py-321"></a>            <span class="n">new_data_types_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span> <span class="n">value_shape</span><span class="p">))</span>
<a id="src/core/helper_functions.py-322" name="src/core/helper_functions.py-322"></a>
<a id="src/core/helper_functions.py-323" name="src/core/helper_functions.py-323"></a>            <span class="k">if</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s1">'f4'</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/core/helper_functions.py-324" name="src/core/helper_functions.py-324"></a><span class="hll">                <span class="n">values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-325" name="src/core/helper_functions.py-325"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-326" name="src/core/helper_functions.py-326"></a>                <span class="n">values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="src/core/helper_functions.py-327" name="src/core/helper_functions.py-327"></a>
<a id="src/core/helper_functions.py-328" name="src/core/helper_functions.py-328"></a>        <span class="k">if</span> <span class="n">flatten_settings</span><span class="p">:</span>
<a id="src/core/helper_functions.py-329" name="src/core/helper_functions.py-329"></a><span class="hll">            <span class="n">flat_settings_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_dic</span><span class="p">(</span><span class="n">settings_dic</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-330" name="src/core/helper_functions.py-330"></a><span class="hll">            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">flat_settings_dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><a id="src/core/helper_functions.py-331" name="src/core/helper_functions.py-331"></a>                <span class="c1"># goes through each key and value in flattend settings dictionary and gets datatype of each</span>
<a id="src/core/helper_functions.py-332" name="src/core/helper_functions.py-332"></a><span class="hll">                <span class="n">value_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dtype</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-333" name="src/core/helper_functions.py-333"></a><span class="hll">                <span class="n">value_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_shape</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-334" name="src/core/helper_functions.py-334"></a><span class="hll">                <span class="n">field_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value_shape</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-335" name="src/core/helper_functions.py-335"></a><span class="hll">                <span class="n">new_data_types_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span> <span class="n">value_shape</span><span class="p">))</span>
</span><a id="src/core/helper_functions.py-336" name="src/core/helper_functions.py-336"></a><span class="hll">                <span class="k">if</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s1">'f4'</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-337" name="src/core/helper_functions.py-337"></a><span class="hll">                    <span class="n">values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-338" name="src/core/helper_functions.py-338"></a>                <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-339" name="src/core/helper_functions.py-339"></a><span class="hll">                    <span class="n">values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-340" name="src/core/helper_functions.py-340"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-341" name="src/core/helper_functions.py-341"></a>            <span class="c1">#if not flattening settings will be contained in a 1x1 struct and we just need to append 1 data type</span>
<a id="src/core/helper_functions.py-342" name="src/core/helper_functions.py-342"></a>            <span class="n">value_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dtype</span><span class="p">(</span><span class="n">settings_dic</span><span class="p">)</span>
<a id="src/core/helper_functions.py-343" name="src/core/helper_functions.py-343"></a>            <span class="n">value_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_shape</span><span class="p">(</span><span class="n">settings_dic</span><span class="p">)</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-346" name="src/core/helper_functions.py-346"></a>            <span class="n">values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">settings_dic</span><span class="p">)</span>
<a id="src/core/helper_functions.py-347" name="src/core/helper_functions.py-347"></a>
<a id="src/core/helper_functions.py-348" name="src/core/helper_functions.py-348"></a>        <span class="c1">#for experiment iterators we want to know the sweep parameters; the iterator_info_dic is inputted similar to settings with optional flattening</span>
<a id="src/core/helper_functions.py-349" name="src/core/helper_functions.py-349"></a>        <span class="k">if</span> <span class="n">iterator_info_dic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">flatten_iterator_info</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<a id="src/core/helper_functions.py-350" name="src/core/helper_functions.py-350"></a><span class="hll">            <span class="n">flat_iterator_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_dic</span><span class="p">(</span><span class="n">iterator_info_dic</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-351" name="src/core/helper_functions.py-351"></a><span class="hll">            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">flat_iterator_dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><a id="src/core/helper_functions.py-352" name="src/core/helper_functions.py-352"></a><span class="hll">                <span class="n">value_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dtype</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-353" name="src/core/helper_functions.py-353"></a><span class="hll">                <span class="n">value_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_shape</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-354" name="src/core/helper_functions.py-354"></a><span class="hll">                <span class="n">field_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value_shape</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-355" name="src/core/helper_functions.py-355"></a><span class="hll">                <span class="n">new_data_types_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span> <span class="n">value_shape</span><span class="p">))</span>
</span><a id="src/core/helper_functions.py-356" name="src/core/helper_functions.py-356"></a><span class="hll">                <span class="k">if</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s1">'f4'</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-357" name="src/core/helper_functions.py-357"></a><span class="hll">                    <span class="n">values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-358" name="src/core/helper_functions.py-358"></a>                <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-359" name="src/core/helper_functions.py-359"></a><span class="hll">                    <span class="n">values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-360" name="src/core/helper_functions.py-360"></a>        <span class="k">elif</span> <span class="n">iterator_info_dic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/core/helper_functions.py-361" name="src/core/helper_functions.py-361"></a>            <span class="c1">#iterator_info_dic has the form {'scan_param_it_#':'name','scan_current_val_it_#':value,'scan_all_vals_it_#:[...]}</span>
<a id="src/core/helper_functions.py-362" name="src/core/helper_functions.py-362"></a><span class="hll">            <span class="n">value_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dtype</span><span class="p">(</span><span class="n">iterator_info_dic</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-363" name="src/core/helper_functions.py-363"></a><span class="hll">            <span class="n">value_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_shape</span><span class="p">(</span><span class="n">iterator_info_dic</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-364" name="src/core/helper_functions.py-364"></a><span class="hll">            <span class="n">field_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value_shape</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-365" name="src/core/helper_functions.py-365"></a><span class="hll">            <span class="n">new_data_types_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">'python_scan_info'</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span> <span class="n">value_shape</span><span class="p">))</span>
</span><a id="src/core/helper_functions.py-366" name="src/core/helper_functions.py-366"></a><span class="hll">            <span class="n">values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iterator_info_dic</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-367" name="src/core/helper_functions.py-367"></a>
<a id="src/core/helper_functions.py-368" name="src/core/helper_functions.py-368"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_largest_dtype_shapes</span><span class="p">(</span><span class="n">field_shapes</span><span class="p">)</span> <span class="c1">#update before checking data size so largest shapes are already calculated</span>
<a id="src/core/helper_functions.py-369" name="src/core/helper_functions.py-369"></a>
<a id="src/core/helper_functions.py-370" name="src/core/helper_functions.py-370"></a>        <span class="c1"># all_dtype_list elements are lists ie the origonal data_types_list from each experiment</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-372" name="src/core/helper_functions.py-372"></a>        <span class="c1"># all_values_list elements are lists ie the values_list from each experiment</span>
<a id="src/core/helper_functions.py-373" name="src/core/helper_functions.py-373"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values_list</span><span class="p">)</span>
<a id="src/core/helper_functions.py-374" name="src/core/helper_functions.py-374"></a>
<a id="src/core/helper_functions.py-375" name="src/core/helper_functions.py-375"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_dtype_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">new_data_types_list</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_dtype_list</span><span class="p">:</span>
<a id="src/core/helper_functions.py-376" name="src/core/helper_functions.py-376"></a><span class="hll">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_data_types_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_dtype_list</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-377" name="src/core/helper_functions.py-377"></a><span class="hll">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Mismatch in data field count between experiments."</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-378" name="src/core/helper_functions.py-378"></a>            <span class="c1">#print('Variable data sizes..Changing shape of previous data')</span>
<a id="src/core/helper_functions.py-379" name="src/core/helper_functions.py-379"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_previous_data_shape</span><span class="p">(</span><span class="n">new_data_types_list</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-380" name="src/core/helper_functions.py-380"></a>
<a id="src/core/helper_functions.py-381" name="src/core/helper_functions.py-381"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_final_dtype_list</span><span class="p">(</span><span class="n">new_data_types_list</span><span class="p">)</span>  <span class="c1"># updates the final dtype list pasted to save function to have largest shapes</span>
<a id="src/core/helper_functions.py-382" name="src/core/helper_functions.py-382"></a>
<a id="src/core/helper_functions.py-383" name="src/core/helper_functions.py-383"></a>        <span class="k">return</span> <span class="n">values_list</span><span class="p">,</span> <span class="n">new_data_types_list</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-392" name="src/core/helper_functions.py-392"></a><span class="sd">        Returns:</span>
<a id="src/core/helper_functions.py-393" name="src/core/helper_functions.py-393"></a><span class="sd">            structured_data suitable for saving to matlab with scipy.io's savemat function</span>
<a id="src/core/helper_functions.py-394" name="src/core/helper_functions.py-394"></a><span class="sd">        '''</span>
<a id="src/core/helper_functions.py-395" name="src/core/helper_functions.py-395"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_dtype_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/core/helper_functions.py-396" name="src/core/helper_functions.py-396"></a><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Data type list has not been created'</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-397" name="src/core/helper_functions.py-397"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_values_list</span> <span class="o">==</span> <span class="p">[]:</span>
<a id="src/core/helper_functions.py-398" name="src/core/helper_functions.py-398"></a><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Values list is empty!'</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-399" name="src/core/helper_functions.py-399"></a>
<a id="src/core/helper_functions.py-400" name="src/core/helper_functions.py-400"></a>        <span class="n">list_of_value_list_tuples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/core/helper_functions.py-401" name="src/core/helper_functions.py-401"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_values_list</span><span class="p">)):</span>
<a id="src/core/helper_functions.py-402" name="src/core/helper_functions.py-402"></a>            <span class="n">list_of_value_list_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_values_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-401" name="src/core/helper_functions.py-401"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_values_list</span><span class="p">)):</span>
<a id="src/core/helper_functions.py-402" name="src/core/helper_functions.py-402"></a>            <span class="n">list_of_value_list_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_values_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<a id="src/core/helper_functions.py-403" name="src/core/helper_functions.py-403"></a>
<a id="src/core/helper_functions.py-404" name="src/core/helper_functions.py-404"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="c1">#print which rows of data do not match the dtype</span>
<a id="src/core/helper_functions.py-405" name="src/core/helper_functions.py-405"></a><span class="hll">            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_value_list_tuples</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-406" name="src/core/helper_functions.py-406"></a><span class="hll">                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_dtype_list</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-407" name="src/core/helper_functions.py-407"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Row </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> length mismatch: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="si">}</span><span class="s2"> vs expected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_dtype_list</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-408" name="src/core/helper_functions.py-408"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Row data:"</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-409" name="src/core/helper_functions.py-409"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Expected dtype keys:"</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_dtype_list</span><span class="p">])</span>
</span><a id="src/core/helper_functions.py-410" name="src/core/helper_functions.py-410"></a>                <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-411" name="src/core/helper_functions.py-411"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Row </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> OK (length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-412" name="src/core/helper_functions.py-412"></a>
<a id="src/core/helper_functions.py-413" name="src/core/helper_functions.py-413"></a>        <span class="n">final_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_of_value_list_tuples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">final_dtype_list</span><span class="p">)</span>
<a id="src/core/helper_functions.py-414" name="src/core/helper_functions.py-414"></a>        <span class="k">if</span> <span class="n">return_array</span><span class="p">:</span>  <span class="c1"># for more complex shapes may want to get array to use in another function</span>
<a id="src/core/helper_functions.py-415" name="src/core/helper_functions.py-415"></a><span class="hll">            <span class="k">return</span> <span class="n">final_array</span>
</span><a id="src/core/helper_functions.py-416" name="src/core/helper_functions.py-416"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-417" name="src/core/helper_functions.py-417"></a>            <span class="n">structured_data</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span> <span class="n">final_array</span><span class="p">}</span>
<a id="src/core/helper_functions.py-418" name="src/core/helper_functions.py-418"></a>            <span class="k">return</span> <span class="n">structured_data</span>
<a id="src/core/helper_functions.py-419" name="src/core/helper_functions.py-419"></a>        <span class="c1">#unsure if savemat function has a size limit but I have tested up to 2MB and it works fine</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-427" name="src/core/helper_functions.py-427"></a><span class="sd">            new_data_types_list: data type list of newly added data</span>
<a id="src/core/helper_functions.py-428" name="src/core/helper_functions.py-428"></a><span class="sd">        '''</span>
<a id="src/core/helper_functions.py-429" name="src/core/helper_functions.py-429"></a>        <span class="c1">#print('Current dtype:', new_data_types_list, ' Previous dtype:', self.all_dtype_list[-1])</span>
<a id="src/core/helper_functions.py-430" name="src/core/helper_functions.py-430"></a>
<a id="src/core/helper_functions.py-431" name="src/core/helper_functions.py-431"></a><span class="hll">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_data_types_list</span><span class="p">)):</span>
</span><a id="src/core/helper_functions.py-432" name="src/core/helper_functions.py-432"></a><span class="hll">            <span class="n">target_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_dtype_shapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><a id="src/core/helper_functions.py-433" name="src/core/helper_functions.py-433"></a><span class="hll">            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">exp_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_values_list</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-434" name="src/core/helper_functions.py-434"></a><span class="hll">                <span class="n">current_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_shape</span><span class="p">(</span><span class="n">exp_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><a id="src/core/helper_functions.py-435" name="src/core/helper_functions.py-435"></a><span class="hll">                <span class="k">if</span> <span class="n">current_shape</span> <span class="o">!=</span> <span class="n">target_shape</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-436" name="src/core/helper_functions.py-436"></a><span class="hll">                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-437" name="src/core/helper_functions.py-437"></a><span class="hll">                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reshaping row </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, field </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, from </span><span class="si">{</span><span class="n">current_shape</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">target_shape</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-438" name="src/core/helper_functions.py-438"></a><span class="hll">                    <span class="n">new_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_embed_array</span><span class="p">(</span><span class="n">exp_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">target_shape</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-439" name="src/core/helper_functions.py-439"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">all_values_list</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span>
</span><a id="src/core/helper_functions.py-440" name="src/core/helper_functions.py-440"></a>
<a id="src/core/helper_functions.py-441" name="src/core/helper_functions.py-441"></a>    <span class="k">def</span> <span class="nf">_update_largest_dtype_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_shapes</span><span class="p">):</span>
<a id="src/core/helper_functions.py-442" name="src/core/helper_functions.py-442"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/core/helper_functions.py-443" name="src/core/helper_functions.py-443"></a><span class="sd">        Update the stored largest shape for each field based on a new list of shapes.</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-451" name="src/core/helper_functions.py-451"></a>                <span class="c1"># First time seeing this field, just append</span>
<a id="src/core/helper_functions.py-452" name="src/core/helper_functions.py-452"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">largest_dtype_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<a id="src/core/helper_functions.py-453" name="src/core/helper_functions.py-453"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-454" name="src/core/helper_functions.py-454"></a>                <span class="c1"># Update to largest shape seen so far</span>
<a id="src/core/helper_functions.py-455" name="src/core/helper_functions.py-455"></a><span class="hll">                <span class="n">current_largest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">largest_dtype_shapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><a id="src/core/helper_functions.py-456" name="src/core/helper_functions.py-456"></a><span class="hll">                <span class="n">new_largest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highest_common_shape</span><span class="p">(</span><span class="n">current_largest</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-457" name="src/core/helper_functions.py-457"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">largest_dtype_shapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_largest</span>
</span><a id="src/core/helper_functions.py-458" name="src/core/helper_functions.py-458"></a>
<a id="src/core/helper_functions.py-459" name="src/core/helper_functions.py-459"></a>    <span class="k">def</span> <span class="nf">_update_final_dtype_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype_list</span><span class="p">):</span>
<a id="src/core/helper_functions.py-460" name="src/core/helper_functions.py-460"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/core/helper_functions.py-461" name="src/core/helper_functions.py-461"></a><span class="sd">        Rebuild the final dtype list using the largest shapes seen and the most recent types.</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-478" name="src/core/helper_functions.py-478"></a><span class="sd">            differences: list of tuples [(index of differnece, 1st tup value, 2nd tup value),...]</span>
<a id="src/core/helper_functions.py-479" name="src/core/helper_functions.py-479"></a>
<a id="src/core/helper_functions.py-480" name="src/core/helper_functions.py-480"></a><span class="sd">        With current logic not used</span>
<a id="src/core/helper_functions.py-481" name="src/core/helper_functions.py-481"></a><span class="sd">        '''</span>
<a id="src/core/helper_functions.py-482" name="src/core/helper_functions.py-482"></a><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-483" name="src/core/helper_functions.py-483"></a><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Tuples must have the same length"</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-484" name="src/core/helper_functions.py-484"></a>
<a id="src/core/helper_functions.py-485" name="src/core/helper_functions.py-485"></a><span class="hll">        <span class="n">differences</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/core/helper_functions.py-486" name="src/core/helper_functions.py-486"></a><span class="hll">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)):</span>
</span><a id="src/core/helper_functions.py-487" name="src/core/helper_functions.py-487"></a><span class="hll">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-488" name="src/core/helper_functions.py-488"></a><span class="hll">                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-489" name="src/core/helper_functions.py-489"></a><span class="hll">                    <span class="k">continue</span>  <span class="c1"># treat NaNs as equal</span>
</span><a id="src/core/helper_functions.py-490" name="src/core/helper_functions.py-490"></a><span class="hll">                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isposinf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isposinf</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-491" name="src/core/helper_functions.py-491"></a><span class="hll">                    <span class="k">continue</span>
</span><a id="src/core/helper_functions.py-492" name="src/core/helper_functions.py-492"></a><span class="hll">                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isneginf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isneginf</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
</span><a id="src/core/helper_functions.py-493" name="src/core/helper_functions.py-493"></a><span class="hll">                    <span class="k">continue</span>
</span><a id="src/core/helper_functions.py-494" name="src/core/helper_functions.py-494"></a><span class="hll">            <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-495" name="src/core/helper_functions.py-495"></a><span class="hll">                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
</span><a id="src/core/helper_functions.py-496" name="src/core/helper_functions.py-496"></a><span class="hll">                <span class="n">first_tup_val</span> <span class="o">=</span> <span class="n">x</span>
</span><a id="src/core/helper_functions.py-497" name="src/core/helper_functions.py-497"></a><span class="hll">                <span class="n">second_tup_val</span> <span class="o">=</span> <span class="n">y</span>
</span><a id="src/core/helper_functions.py-498" name="src/core/helper_functions.py-498"></a><span class="hll">                <span class="n">differences</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">first_tup_val</span><span class="p">,</span> <span class="n">second_tup_val</span><span class="p">))</span>
</span><a id="src/core/helper_functions.py-499" name="src/core/helper_functions.py-499"></a>        <span class="c1">#print('tuple differences:',differences)</span>
<a id="src/core/helper_functions.py-500" name="src/core/helper_functions.py-500"></a><span class="hll">        <span class="k">return</span> <span class="n">differences</span>
</span><a id="src/core/helper_functions.py-501" name="src/core/helper_functions.py-501"></a>
<a id="src/core/helper_functions.py-502" name="src/core/helper_functions.py-502"></a>    <span class="k">def</span> <span class="nf">_get_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="src/core/helper_functions.py-503" name="src/core/helper_functions.py-503"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/core/helper_functions.py-504" name="src/core/helper_functions.py-504"></a><span class="sd">        Checks the variable type and returns the corresponding dtype string suitable for matlab</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-508" name="src/core/helper_functions.py-508"></a>            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span>
<a id="src/core/helper_functions.py-509" name="src/core/helper_functions.py-509"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="src/core/helper_functions.py-510" name="src/core/helper_functions.py-510"></a>            <span class="k">return</span> <span class="s1">'f8'</span>
<a id="src/core/helper_functions.py-511" name="src/core/helper_functions.py-511"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="src/core/helper_functions.py-512" name="src/core/helper_functions.py-512"></a><span class="hll">            <span class="k">return</span> <span class="s1">'i4'</span>
</span><a id="src/core/helper_functions.py-513" name="src/core/helper_functions.py-513"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="src/core/helper_functions.py-514" name="src/core/helper_functions.py-514"></a><span class="hll">            <span class="k">return</span> <span class="s1">'U</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#+1 so empty string (U0) dont casue an error</span>
</span><a id="src/core/helper_functions.py-515" name="src/core/helper_functions.py-515"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
<a id="src/core/helper_functions.py-516" name="src/core/helper_functions.py-516"></a><span class="hll">            <span class="k">return</span> <span class="s1">'O'</span> <span class="c1">#matlab reconizes a boolean as its logical data type</span>
</span><a id="src/core/helper_functions.py-517" name="src/core/helper_functions.py-517"></a>        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/core/helper_functions.py-518" name="src/core/helper_functions.py-518"></a><span class="hll">            <span class="k">return</span> <span class="s1">'f4'</span> <span class="c1">#if value is None will set as np.nan which is a float data type</span>
</span><a id="src/core/helper_functions.py-519" name="src/core/helper_functions.py-519"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="src/core/helper_functions.py-520" name="src/core/helper_functions.py-520"></a>            <span class="k">return</span> <span class="s1">'O'</span>
<a id="src/core/helper_functions.py-521" name="src/core/helper_functions.py-521"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-522" name="src/core/helper_functions.py-522"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s1">'Value type not recognized...Defaulting to object...May corrupt data'</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-523" name="src/core/helper_functions.py-523"></a><span class="hll">            <span class="k">return</span> <span class="s1">'O'</span>
</span><a id="src/core/helper_functions.py-524" name="src/core/helper_functions.py-524"></a>
<a id="src/core/helper_functions.py-525" name="src/core/helper_functions.py-525"></a>    <span class="k">def</span> <span class="nf">_get_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="src/core/helper_functions.py-526" name="src/core/helper_functions.py-526"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/core/helper_functions.py-527" name="src/core/helper_functions.py-527"></a><span class="sd">        Checks the variable shape and returns the corresponding dtype shape suitable for matlab</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-530" name="src/core/helper_functions.py-530"></a>            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span>
<a id="src/core/helper_functions.py-531" name="src/core/helper_functions.py-531"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
<a id="src/core/helper_functions.py-532" name="src/core/helper_functions.py-532"></a>            <span class="k">try</span><span class="p">:</span>
<a id="src/core/helper_functions.py-533" name="src/core/helper_functions.py-533"></a>                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<a id="src/core/helper_functions.py-534" name="src/core/helper_functions.py-534"></a><span class="hll">            <span class="k">except</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-535" name="src/core/helper_functions.py-535"></a><span class="hll">                <span class="k">return</span> <span class="p">()</span>  <span class="c1"># fallback if conversion fails</span>
</span><a id="src/core/helper_functions.py-536" name="src/core/helper_functions.py-536"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-537" name="src/core/helper_functions.py-537"></a>            <span class="k">return</span> <span class="p">()</span>
<a id="src/core/helper_functions.py-538" name="src/core/helper_functions.py-538"></a>
<a id="src/core/helper_functions.py-539" name="src/core/helper_functions.py-539"></a>    <span class="k">def</span> <span class="nf">_flatten_dic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">parent_key</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">'_'</span><span class="p">):</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-551" name="src/core/helper_functions.py-551"></a>        <span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>
<a id="src/core/helper_functions.py-552" name="src/core/helper_functions.py-552"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="src/core/helper_functions.py-553" name="src/core/helper_functions.py-553"></a>            <span class="n">new_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}{</span><span class="n">sep</span><span class="si">}{</span><span class="n">k</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">parent_key</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="src/core/helper_functions.py-554" name="src/core/helper_functions.py-554"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="src/core/helper_functions.py-555" name="src/core/helper_functions.py-555"></a><span class="hll">                <span class="n">items</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flatten_dic</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">new_key</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">))</span>
</span><a id="src/core/helper_functions.py-556" name="src/core/helper_functions.py-556"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-557" name="src/core/helper_functions.py-557"></a>                <span class="n">items</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<a id="src/core/helper_functions.py-558" name="src/core/helper_functions.py-558"></a>        <span class="k">return</span> <span class="n">items</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-569" name="src/core/helper_functions.py-569"></a>
<a id="src/core/helper_functions.py-570" name="src/core/helper_functions.py-570"></a><span class="sd">        Returns:</span>
<a id="src/core/helper_functions.py-571" name="src/core/helper_functions.py-571"></a><span class="sd">            np.ndarray  The larger array with the small array embedded</span>
<a id="src/core/helper_functions.py-572" name="src/core/helper_functions.py-572"></a><span class="sd">        '''</span>
<a id="src/core/helper_functions.py-573" name="src/core/helper_functions.py-573"></a><span class="hll">        <span class="n">small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-574" name="src/core/helper_functions.py-574"></a><span class="hll">        <span class="n">target_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">target_shape</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-575" name="src/core/helper_functions.py-575"></a>
<a id="src/core/helper_functions.py-576" name="src/core/helper_functions.py-576"></a><span class="hll">        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">t</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">small</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">target_shape</span><span class="p">)):</span>
</span><a id="src/core/helper_functions.py-577" name="src/core/helper_functions.py-577"></a><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Target shape must be &gt;= input shape in all dimensions."</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-578" name="src/core/helper_functions.py-578"></a>
<a id="src/core/helper_functions.py-579" name="src/core/helper_functions.py-579"></a><span class="hll">        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">target_shape</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-580" name="src/core/helper_functions.py-580"></a>
<a id="src/core/helper_functions.py-581" name="src/core/helper_functions.py-581"></a><span class="hll">        <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-582" name="src/core/helper_functions.py-582"></a>            <span class="c1"># Center the small array in each dimension</span>
<a id="src/core/helper_functions.py-583" name="src/core/helper_functions.py-583"></a><span class="hll">            <span class="n">slices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><a id="src/core/helper_functions.py-584" name="src/core/helper_functions.py-584"></a>                <span class="nb">slice</span><span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
<a id="src/core/helper_functions.py-585" name="src/core/helper_functions.py-585"></a>                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">small</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">target_shape</span><span class="p">)</span>
<a id="src/core/helper_functions.py-586" name="src/core/helper_functions.py-586"></a>            <span class="p">)</span>
<a id="src/core/helper_functions.py-587" name="src/core/helper_functions.py-587"></a>        <span class="k">else</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-585" name="src/core/helper_functions.py-585"></a>                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">small</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">target_shape</span><span class="p">)</span>
<a id="src/core/helper_functions.py-586" name="src/core/helper_functions.py-586"></a>            <span class="p">)</span>
<a id="src/core/helper_functions.py-587" name="src/core/helper_functions.py-587"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/core/helper_functions.py-588" name="src/core/helper_functions.py-588"></a>            <span class="c1"># Top-left placement</span>
<a id="src/core/helper_functions.py-589" name="src/core/helper_functions.py-589"></a><span class="hll">            <span class="n">slices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">small</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-590" name="src/core/helper_functions.py-590"></a>
<a id="src/core/helper_functions.py-591" name="src/core/helper_functions.py-591"></a><span class="hll">        <span class="n">result</span><span class="p">[</span><span class="n">slices</span><span class="p">]</span> <span class="o">=</span> <span class="n">small</span>
</span><a id="src/core/helper_functions.py-592" name="src/core/helper_functions.py-592"></a><span class="hll">        <span class="k">return</span> <span class="n">result</span>
</span><a id="src/core/helper_functions.py-593" name="src/core/helper_functions.py-593"></a>
<a id="src/core/helper_functions.py-594" name="src/core/helper_functions.py-594"></a>    <span class="k">def</span> <span class="nf">_highest_common_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">):</span>
<a id="src/core/helper_functions.py-595" name="src/core/helper_functions.py-595"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/core/helper_functions.py-596" name="src/core/helper_functions.py-596"></a><span class="sd">        Gets the largest common shape between two arrays.</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-599" name="src/core/helper_functions.py-599"></a><span class="sd">        Returns:</span>
<a id="src/core/helper_functions.py-600" name="src/core/helper_functions.py-600"></a><span class="sd">            largest shape as a tuple ex: (10,) or (40,40)</span>
<a id="src/core/helper_functions.py-601" name="src/core/helper_functions.py-601"></a><span class="sd">        '''</span>
<a id="src/core/helper_functions.py-602" name="src/core/helper_functions.py-602"></a>        <span class="c1"># Convert to tuples (in case input is a NumPy array's shape)</span>
<a id="src/core/helper_functions.py-603" name="src/core/helper_functions.py-603"></a><span class="hll">        <span class="n">shape1</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape1</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-604" name="src/core/helper_functions.py-604"></a><span class="hll">        <span class="n">shape2</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape2</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-605" name="src/core/helper_functions.py-605"></a>
<a id="src/core/helper_functions.py-606" name="src/core/helper_functions.py-606"></a>        <span class="c1"># Pad the shorter shape with 1s on the left</span>
<a id="src/core/helper_functions.py-607" name="src/core/helper_functions.py-607"></a><span class="hll">        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape2</span><span class="p">))</span>
</span><a id="src/core/helper_functions.py-608" name="src/core/helper_functions.py-608"></a><span class="hll">        <span class="n">shape1_padded</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape1</span><span class="p">))</span> <span class="o">+</span> <span class="n">shape1</span>
</span><a id="src/core/helper_functions.py-609" name="src/core/helper_functions.py-609"></a><span class="hll">        <span class="n">shape2_padded</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape2</span><span class="p">))</span> <span class="o">+</span> <span class="n">shape2</span>
</span><a id="src/core/helper_functions.py-610" name="src/core/helper_functions.py-610"></a>
<a id="src/core/helper_functions.py-611" name="src/core/helper_functions.py-611"></a>        <span class="c1"># Take max dimension-wise</span>
<a id="src/core/helper_functions.py-612" name="src/core/helper_functions.py-612"></a><span class="hll">        <span class="n">result</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">shape1_padded</span><span class="p">,</span> <span class="n">shape2_padded</span><span class="p">))</span>
</span><a id="src/core/helper_functions.py-613" name="src/core/helper_functions.py-613"></a><span class="hll">        <span class="k">return</span> <span class="n">result</span>
</span><a id="src/core/helper_functions.py-614" name="src/core/helper_functions.py-614"></a>
<a id="src/core/helper_functions.py-615" name="src/core/helper_functions.py-615"></a>
<a id="src/core/helper_functions.py-616" name="src/core/helper_functions.py-616"></a>
<a id="src/core/helper_functions.py-617" name="src/core/helper_functions.py-617"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/core/helper_functions.py-616" name="src/core/helper_functions.py-616"></a>
<a id="src/core/helper_functions.py-617" name="src/core/helper_functions.py-617"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
<a id="src/core/helper_functions.py-618" name="src/core/helper_functions.py-618"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">explore_package</span><span class="p">(</span><span class="s1">'src.core'</span><span class="p">))</span>
<a id="src/core/helper_functions.py-619" name="src/core/helper_functions.py-619"></a>
<a id="src/core/helper_functions.py-620" name="src/core/helper_functions.py-620"></a><span class="hll">    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'random data'</span><span class="p">,</span> <span class="s1">'&lt;f8'</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
</span><a id="src/core/helper_functions.py-621" name="src/core/helper_functions.py-621"></a><span class="hll">    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'random data'</span><span class="p">,</span> <span class="s1">'&lt;f8'</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,))</span>
</span><a id="src/core/helper_functions.py-622" name="src/core/helper_functions.py-622"></a>
<a id="src/core/helper_functions.py-623" name="src/core/helper_functions.py-623"></a><span class="hll">    <span class="n">matlab_saver</span> <span class="o">=</span> <span class="n">MatlabSaver</span><span class="p">()</span>
</span><a id="src/core/helper_functions.py-624" name="src/core/helper_functions.py-624"></a><span class="hll">    <span class="n">dif</span> <span class="o">=</span> <span class="n">matlab_saver</span><span class="o">.</span><span class="n">_compare_tuples</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-625" name="src/core/helper_functions.py-625"></a>
<a id="src/core/helper_functions.py-626" name="src/core/helper_functions.py-626"></a><span class="hll">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dif</span><span class="p">)):</span>
</span><a id="src/core/helper_functions.py-627" name="src/core/helper_functions.py-627"></a>        <span class="c1">#loops through all differences</span>
<a id="src/core/helper_functions.py-628" name="src/core/helper_functions.py-628"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="n">dif</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><a id="src/core/helper_functions.py-629" name="src/core/helper_functions.py-629"></a><span class="hll">        <span class="k">if</span> <span class="n">dif</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-630" name="src/core/helper_functions.py-630"></a>            <span class="c1">#if difference is size gets highest common shape</span>
<a id="src/core/helper_functions.py-631" name="src/core/helper_functions.py-631"></a><span class="hll">            <span class="n">shape_1</span> <span class="o">=</span> <span class="n">dif</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><a id="src/core/helper_functions.py-632" name="src/core/helper_functions.py-632"></a><span class="hll">            <span class="n">shape_2</span> <span class="o">=</span> <span class="n">dif</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</span><a id="src/core/helper_functions.py-633" name="src/core/helper_functions.py-633"></a><span class="hll">            <span class="n">best_shape</span> <span class="o">=</span> <span class="n">matlab_saver</span><span class="o">.</span><span class="n">_highest_common_shape</span><span class="p">(</span><span class="n">shape_1</span><span class="p">,</span> <span class="n">shape_2</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-634" name="src/core/helper_functions.py-634"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="n">best_shape</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-635" name="src/core/helper_functions.py-635"></a><span class="hll">        <span class="k">if</span> <span class="n">dif</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><a id="src/core/helper_functions.py-636" name="src/core/helper_functions.py-636"></a>            <span class="c1">#should never be a difference in data type</span>
<a id="src/core/helper_functions.py-637" name="src/core/helper_functions.py-637"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s1">'difference in data types..defaulting to object'</span><span class="p">)</span>
</span><a id="src/core/helper_functions.py-638" name="src/core/helper_functions.py-638"></a><span class="hll">            <span class="n">best_dtype</span> <span class="o">=</span> <span class="s1">'O'</span>
</span><a id="src/core/helper_functions.py-639" name="src/core/helper_functions.py-639"></a>
<a id="src/core/helper_functions.py-640" name="src/core/helper_functions.py-640"></a><span class="hll">        <span class="n">new_dtype_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
</span><a id="src/core/helper_functions.py-641" name="src/core/helper_functions.py-641"></a>
<a id="src/core/helper_functions.py-642" name="src/core/helper_functions.py-642"></a>
<a id="src/core/helper_functions.py-643" name="src/core/helper_functions.py-643"></a>
<a id="src/core/helper_functions.py-644" name="src/core/helper_functions.py-644"></a><span class="hll">    <span class="n">small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</span><a id="src/core/helper_functions.py-645" name="src/core/helper_functions.py-645"></a><span class="hll">    <span class="n">large</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</span><a id="src/core/helper_functions.py-646" name="src/core/helper_functions.py-646"></a>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/Model/experiments/confocal.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-69" name="src/Model/experiments/confocal.py-69"></a>    <span class="k">def</span> <span class="nf">setup_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-70" name="src/Model/experiments/confocal.py-70"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-71" name="src/Model/experiments/confocal.py-71"></a><span class="sd">        Gets paths for adbasic file and loads them onto ADwin.</span>
<a id="src/Model/experiments/confocal.py-72" name="src/Model/experiments/confocal.py-72"></a><span class="sd">        '''</span>
<a id="src/Model/experiments/confocal.py-73" name="src/Model/experiments/confocal.py-73"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">stop_process</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-74" name="src/Model/experiments/confocal.py-74"></a><span class="hll">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-75" name="src/Model/experiments/confocal.py-75"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">clear_process</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-76" name="src/Model/experiments/confocal.py-76"></a><span class="hll">        <span class="n">one_d_scan_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'Controller'</span><span class="p">,</span><span class="s1">'binary_files'</span><span class="p">,</span> <span class="s1">'ADbasic'</span><span class="p">,</span> <span class="s1">'One_D_Scan.TB2'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-77" name="src/Model/experiments/confocal.py-77"></a>        <span class="n">one_d_scan</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">one_d_scan_path</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-78" name="src/Model/experiments/confocal.py-78"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_2'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'load'</span><span class="p">:</span> <span class="n">one_d_scan</span><span class="p">}})</span>
</span><a id="src/Model/experiments/confocal.py-79" name="src/Model/experiments/confocal.py-79"></a>        <span class="c1"># one_d_scan script increments an index then adds count values to an array in a constant time interval</span>
<a id="src/Model/experiments/confocal.py-80" name="src/Model/experiments/confocal.py-80"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">clock_functions</span><span class="p">(</span><span class="s1">'Frame'</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># reset ALL clocks to default settings</span>
</span><a id="src/Model/experiments/confocal.py-81" name="src/Model/experiments/confocal.py-81"></a>
<a id="src/Model/experiments/confocal.py-82" name="src/Model/experiments/confocal.py-82"></a><span class="hll">        <span class="n">z_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'z_pos'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-83" name="src/Model/experiments/confocal.py-83"></a>        <span class="c1">#maz range is 0 to 100</span>
<a id="src/Model/experiments/confocal.py-84" name="src/Model/experiments/confocal.py-84"></a><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'z_pos'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-85" name="src/Model/experiments/confocal.py-85"></a><span class="hll">            <span class="n">z_pos</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><a id="src/Model/experiments/confocal.py-86" name="src/Model/experiments/confocal.py-86"></a><span class="hll">        <span class="k">elif</span> <span class="n">z_pos</span> <span class="o">&gt;</span> <span class="mf">100.0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-87" name="src/Model/experiments/confocal.py-87"></a><span class="hll">            <span class="n">z_pos</span> <span class="o">=</span> <span class="mf">100.0</span>
</span><a id="src/Model/experiments/confocal.py-88" name="src/Model/experiments/confocal.py-88"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'z_pos'</span><span class="p">:</span> <span class="n">z_pos</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-89" name="src/Model/experiments/confocal.py-89"></a>
<a id="src/Model/experiments/confocal.py-90" name="src/Model/experiments/confocal.py-90"></a>        <span class="c1"># tracker to only save 3D image slice once</span>
<a id="src/Model/experiments/confocal.py-91" name="src/Model/experiments/confocal.py-91"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data_collected</span> <span class="o">=</span> <span class="kc">False</span>
</span><a id="src/Model/experiments/confocal.py-92" name="src/Model/experiments/confocal.py-92"></a>
<a id="src/Model/experiments/confocal.py-93" name="src/Model/experiments/confocal.py-93"></a>    <span class="k">def</span> <span class="nf">after_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-94" name="src/Model/experiments/confocal.py-94"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-95" name="src/Model/experiments/confocal.py-95"></a><span class="sd">        Cleans up adwin and moves nanodrive to specified position</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-94" name="src/Model/experiments/confocal.py-94"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-95" name="src/Model/experiments/confocal.py-95"></a><span class="sd">        Cleans up adwin and moves nanodrive to specified position</span>
<a id="src/Model/experiments/confocal.py-96" name="src/Model/experiments/confocal.py-96"></a><span class="sd">        '''</span>
<a id="src/Model/experiments/confocal.py-97" name="src/Model/experiments/confocal.py-97"></a>        <span class="c1"># clearing process to aviod memory fragmentation when running different experiments in GUI</span>
<a id="src/Model/experiments/confocal.py-98" name="src/Model/experiments/confocal.py-98"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">stop_process</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1">#neccesary if process is does not stop for some reason</span>
</span><a id="src/Model/experiments/confocal.py-99" name="src/Model/experiments/confocal.py-99"></a><span class="hll">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-100" name="src/Model/experiments/confocal.py-100"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">clear_process</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-101" name="src/Model/experiments/confocal.py-101"></a><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'ending_behavior'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'return_to_inital_pos'</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-102" name="src/Model/experiments/confocal.py-102"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x_pos'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_inital</span><span class="p">,</span> <span class="s1">'y_pos'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_inital</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-103" name="src/Model/experiments/confocal.py-103"></a><span class="hll">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'ending_behavior'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'return_to_origin'</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-104" name="src/Model/experiments/confocal.py-104"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x_pos'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">'y_pos'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-105" name="src/Model/experiments/confocal.py-105"></a>
<a id="src/Model/experiments/confocal.py-106" name="src/Model/experiments/confocal.py-106"></a>    <span class="k">def</span> <span class="nf">_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-107" name="src/Model/experiments/confocal.py-107"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/Model/experiments/confocal.py-108" name="src/Model/experiments/confocal.py-108"></a><span class="sd">        This is the actual function that will be executed. It uses only information that is provided in the settings property</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-107" name="src/Model/experiments/confocal.py-107"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/Model/experiments/confocal.py-108" name="src/Model/experiments/confocal.py-108"></a><span class="sd">        This is the actual function that will be executed. It uses only information that is provided in the settings property</span>
<a id="src/Model/experiments/confocal.py-109" name="src/Model/experiments/confocal.py-109"></a><span class="sd">        will be overwritten in the __init__</span>
<a id="src/Model/experiments/confocal.py-110" name="src/Model/experiments/confocal.py-110"></a><span class="sd">        """</span>
<a id="src/Model/experiments/confocal.py-111" name="src/Model/experiments/confocal.py-111"></a><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'reboot_adwin'</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-112" name="src/Model/experiments/confocal.py-112"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">reboot_adwin</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-113" name="src/Model/experiments/confocal.py-113"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">setup_scan</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-114" name="src/Model/experiments/confocal.py-114"></a><span class="hll">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-115" name="src/Model/experiments/confocal.py-115"></a>
<a id="src/Model/experiments/confocal.py-116" name="src/Model/experiments/confocal.py-116"></a>        <span class="c1">#y scanning range is 5 to 95 to compensate for warm up time</span>
<a id="src/Model/experiments/confocal.py-117" name="src/Model/experiments/confocal.py-117"></a><span class="hll">        <span class="n">x_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_a'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-118" name="src/Model/experiments/confocal.py-118"></a><span class="hll">        <span class="n">y_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_a'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">],</span> <span class="mf">5.0</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-119" name="src/Model/experiments/confocal.py-119"></a><span class="hll">        <span class="n">x_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_b'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">],</span> <span class="mf">100.0</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-120" name="src/Model/experiments/confocal.py-120"></a><span class="hll">        <span class="n">y_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_b'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">],</span> <span class="mf">95.0</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-121" name="src/Model/experiments/confocal.py-121"></a>
<a id="src/Model/experiments/confocal.py-122" name="src/Model/experiments/confocal.py-122"></a>        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'resolution'</span><span class="p">]</span>
<a id="src/Model/experiments/confocal.py-123" name="src/Model/experiments/confocal.py-123"></a><span class="hll">        <span class="n">num_points</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span>
</span><a id="src/Model/experiments/confocal.py-124" name="src/Model/experiments/confocal.py-124"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s1">'num_points'</span><span class="p">,</span><span class="n">num_points</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-125" name="src/Model/experiments/confocal.py-125"></a><span class="hll">        <span class="k">if</span> <span class="n">num_points</span> <span class="o">&lt;</span> <span class="mi">91</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-126" name="src/Model/experiments/confocal.py-126"></a><span class="hll">            <span class="n">new_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correct_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-127" name="src/Model/experiments/confocal.py-127"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Works best with minimum 91 pixel resolution in y-direction. You are getting a free resolution upgrade to </span><span class="si">{</span><span class="n">new_step</span><span class="si">}</span><span class="s1"> um!'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-128" name="src/Model/experiments/confocal.py-128"></a>
<a id="src/Model/experiments/confocal.py-129" name="src/Model/experiments/confocal.py-129"></a>        <span class="c1">#array form point_a x,y to point_b x,y with step of resolution</span>
<a id="src/Model/experiments/confocal.py-130" name="src/Model/experiments/confocal.py-130"></a><span class="hll">        <span class="n">x_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-131" name="src/Model/experiments/confocal.py-131"></a>        <span class="n">y_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-132" name="src/Model/experiments/confocal.py-132"></a>
<a id="src/Model/experiments/confocal.py-133" name="src/Model/experiments/confocal.py-133"></a>        <span class="c1">#adds point 5 um before and after</span>
<a id="src/Model/experiments/confocal.py-134" name="src/Model/experiments/confocal.py-134"></a><span class="hll">        <span class="n">y_before</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y_min</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span><span class="n">y_min</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-135" name="src/Model/experiments/confocal.py-135"></a><span class="hll">        <span class="n">y_after</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y_max</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">+</span> <span class="mf">5.0</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-136" name="src/Model/experiments/confocal.py-136"></a><span class="hll">        <span class="n">y_array_adj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y_before</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-137" name="src/Model/experiments/confocal.py-137"></a><span class="hll">        <span class="n">y_array_adj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_array_adj</span><span class="p">,</span> <span class="n">y_after</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-138" name="src/Model/experiments/confocal.py-138"></a>
<a id="src/Model/experiments/confocal.py-139" name="src/Model/experiments/confocal.py-139"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">x_inital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'x_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-140" name="src/Model/experiments/confocal.py-140"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">y_inital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'y_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-141" name="src/Model/experiments/confocal.py-141"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'z_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-142" name="src/Model/experiments/confocal.py-142"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'z_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span>
</span><a id="src/Model/experiments/confocal.py-143" name="src/Model/experiments/confocal.py-143"></a>
<a id="src/Model/experiments/confocal.py-144" name="src/Model/experiments/confocal.py-144"></a>        <span class="c1">#makes sure data is getting recorded. If still equal none after running experiment data is not being stored or not measured</span>
<a id="src/Model/experiments/confocal.py-145" name="src/Model/experiments/confocal.py-145"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'x_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="src/Model/experiments/confocal.py-146" name="src/Model/experiments/confocal.py-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'y_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="src/Model/experiments/confocal.py-147" name="src/Model/experiments/confocal.py-147"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/confocal.py-148" name="src/Model/experiments/confocal.py-148"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_rate'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="src/Model/experiments/confocal.py-149" name="src/Model/experiments/confocal.py-149"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="src/Model/experiments/confocal.py-150" name="src/Model/experiments/confocal.py-150"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_img'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/confocal.py-151" name="src/Model/experiments/confocal.py-151"></a>        <span class="c1">#local lists to store data and append to global self.data lists</span>
<a id="src/Model/experiments/confocal.py-152" name="src/Model/experiments/confocal.py-152"></a>        <span class="n">x_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/Model/experiments/confocal.py-153" name="src/Model/experiments/confocal.py-153"></a>        <span class="n">y_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/Model/experiments/confocal.py-154" name="src/Model/experiments/confocal.py-154"></a><span class="hll">        <span class="n">raw_count_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/confocal.py-155" name="src/Model/experiments/confocal.py-155"></a>        <span class="n">count_rate_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/Model/experiments/confocal.py-156" name="src/Model/experiments/confocal.py-156"></a><span class="hll">        <span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/confocal.py-157" name="src/Model/experiments/confocal.py-157"></a>
<a id="src/Model/experiments/confocal.py-158" name="src/Model/experiments/confocal.py-158"></a>        <span class="c1"># set data to zero and update to plot while experiment runs</span>
<a id="src/Model/experiments/confocal.py-159" name="src/Model/experiments/confocal.py-159"></a><span class="hll">        <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_array</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-160" name="src/Model/experiments/confocal.py-160"></a><span class="hll">        <span class="n">Ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_array</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-161" name="src/Model/experiments/confocal.py-161"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">))</span>
</span><a id="src/Model/experiments/confocal.py-162" name="src/Model/experiments/confocal.py-162"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_img'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_array_adj</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">))</span>
</span><a id="src/Model/experiments/confocal.py-163" name="src/Model/experiments/confocal.py-163"></a>
<a id="src/Model/experiments/confocal.py-164" name="src/Model/experiments/confocal.py-164"></a>        <span class="n">interation_num</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#number to track progress</span>
<a id="src/Model/experiments/confocal.py-165" name="src/Model/experiments/confocal.py-165"></a>        <span class="n">total_interations</span> <span class="o">=</span> <span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span><span class="o">/</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span><span class="o">/</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>       <span class="c1">#plus 1 because in total_iterations because range is inclusive ie. [0,10]</span>
<a id="src/Model/experiments/confocal.py-166" name="src/Model/experiments/confocal.py-166"></a>        <span class="c1">#print('total_interations=',total_interations)</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-169" name="src/Model/experiments/confocal.py-169"></a>        <span class="c1">#time_per_pt is in millisecond and the adwin delay time is delay_value*3.3ns</span>
<a id="src/Model/experiments/confocal.py-170" name="src/Model/experiments/confocal.py-170"></a>        <span class="n">adwin_delay</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]</span><span class="o">*</span><span class="mf">1e6</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">))</span>
<a id="src/Model/experiments/confocal.py-171" name="src/Model/experiments/confocal.py-171"></a>        <span class="c1">#print('adwin delay: ',delay)</span>
<a id="src/Model/experiments/confocal.py-172" name="src/Model/experiments/confocal.py-172"></a>
<a id="src/Model/experiments/confocal.py-173" name="src/Model/experiments/confocal.py-173"></a><span class="hll">        <span class="n">wf</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y_array_adj</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-174" name="src/Model/experiments/confocal.py-174"></a><span class="hll">        <span class="n">len_wf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_array_adj</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-175" name="src/Model/experiments/confocal.py-175"></a>        <span class="c1">#print(len_wf,wf)</span>
<a id="src/Model/experiments/confocal.py-176" name="src/Model/experiments/confocal.py-176"></a><span class="hll">        <span class="n">load_read_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span> <span class="c1">#used for scaling when rates are different</span>
</span><a id="src/Model/experiments/confocal.py-177" name="src/Model/experiments/confocal.py-177"></a><span class="hll">        <span class="n">num_points_read</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">load_read_ratio</span><span class="o">*</span><span class="n">len_wf</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="c1">#20 is added to compensate for start warm up producing ~15 points of unwanted values</span>
</span><a id="src/Model/experiments/confocal.py-178" name="src/Model/experiments/confocal.py-178"></a>
<a id="src/Model/experiments/confocal.py-179" name="src/Model/experiments/confocal.py-179"></a>        <span class="c1">#set inital x and y and set nanodrive stage to that position</span>
<a id="src/Model/experiments/confocal.py-180" name="src/Model/experiments/confocal.py-180"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x_pos'</span><span class="p">:</span><span class="n">x_min</span><span class="p">,</span><span class="s1">'y_pos'</span><span class="p">:</span><span class="n">y_min</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span><span class="s1">'num_datapoints'</span><span class="p">:</span><span class="n">len_wf</span><span class="p">,</span><span class="s1">'read_rate'</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">'load_rate'</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]})</span>
</span><a id="src/Model/experiments/confocal.py-181" name="src/Model/experiments/confocal.py-181"></a>        <span class="c1">#load_rate is time_per_pt; 2.0ms = 5000Hz</span>
<a id="src/Model/experiments/confocal.py-182" name="src/Model/experiments/confocal.py-182"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_2'</span><span class="p">:{</span><span class="s1">'delay'</span><span class="p">:</span><span class="n">adwin_delay</span><span class="p">}})</span>
<a id="src/Model/experiments/confocal.py-183" name="src/Model/experiments/confocal.py-183"></a>        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1">#time for stage to move to starting posiition and adwin process to initilize</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-182" name="src/Model/experiments/confocal.py-182"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_2'</span><span class="p">:{</span><span class="s1">'delay'</span><span class="p">:</span><span class="n">adwin_delay</span><span class="p">}})</span>
<a id="src/Model/experiments/confocal.py-183" name="src/Model/experiments/confocal.py-183"></a>        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1">#time for stage to move to starting posiition and adwin process to initilize</span>
<a id="src/Model/experiments/confocal.py-184" name="src/Model/experiments/confocal.py-184"></a>
<a id="src/Model/experiments/confocal.py-185" name="src/Model/experiments/confocal.py-185"></a>
<a id="src/Model/experiments/confocal.py-186" name="src/Model/experiments/confocal.py-186"></a><span class="hll">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x_array</span><span class="p">):</span>
</span><a id="src/Model/experiments/confocal.py-187" name="src/Model/experiments/confocal.py-187"></a><span class="hll">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abort</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-188" name="src/Model/experiments/confocal.py-188"></a><span class="hll">                <span class="k">break</span>
</span><a id="src/Model/experiments/confocal.py-189" name="src/Model/experiments/confocal.py-189"></a><span class="hll">            <span class="n">img_row</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/confocal.py-190" name="src/Model/experiments/confocal.py-190"></a><span class="hll">            <span class="n">raw_img_row</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/confocal.py-191" name="src/Model/experiments/confocal.py-191"></a><span class="hll">            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-192" name="src/Model/experiments/confocal.py-192"></a>
<a id="src/Model/experiments/confocal.py-193" name="src/Model/experiments/confocal.py-193"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x_pos'</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s1">'y_pos'</span><span class="p">:</span><span class="n">y_min</span><span class="o">-</span><span class="mf">5.0</span><span class="p">})</span>     <span class="c1">#goes to x position</span>
</span><a id="src/Model/experiments/confocal.py-194" name="src/Model/experiments/confocal.py-194"></a><span class="hll">            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-195" name="src/Model/experiments/confocal.py-195"></a>            <span class="n">x_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'x_pos'</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-196" name="src/Model/experiments/confocal.py-196"></a>            <span class="n">x_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-197" name="src/Model/experiments/confocal.py-197"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'x_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_data</span>     <span class="c1">#adds x postion to data</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-199" name="src/Model/experiments/confocal.py-199"></a>            <span class="c1">#The two different code lines to start counting seem to work for cropping. Honestly cant give a precise explaination, it seems to be related to</span>
<a id="src/Model/experiments/confocal.py-200" name="src/Model/experiments/confocal.py-200"></a>            <span class="c1">#hardware delay. If the time_per_pt is 5.0 starting counting before waveform set up works to within 1 pixel with numpy cropping. If the</span>
<a id="src/Model/experiments/confocal.py-201" name="src/Model/experiments/confocal.py-201"></a>            <span class="c1">#time_per_pt is 2.0 starting counting after waveform set up matches slow scan to a pixel. Sorry for a lack of explaination but this just seems to work.</span>
<a id="src/Model/experiments/confocal.py-202" name="src/Model/experiments/confocal.py-202"></a>            <span class="c1">#See data/dylan_staples/confocal_scans_w_resolution_target for images and additional details</span>
<a id="src/Model/experiments/confocal.py-203" name="src/Model/experiments/confocal.py-203"></a><span class="hll">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]</span> <span class="o">==</span> <span class="mf">5.0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-204" name="src/Model/experiments/confocal.py-204"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_2'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'running'</span><span class="p">:</span> <span class="kc">True</span><span class="p">}})</span>
</span><a id="src/Model/experiments/confocal.py-205" name="src/Model/experiments/confocal.py-205"></a>
<a id="src/Model/experiments/confocal.py-206" name="src/Model/experiments/confocal.py-206"></a>            <span class="c1">#trigger waveform on y-axis and record position data</span>
<a id="src/Model/experiments/confocal.py-207" name="src/Model/experiments/confocal.py-207"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s1">'num_datapoints'</span><span class="p">:</span> <span class="n">len_wf</span><span class="p">,</span> <span class="s1">'load_waveform'</span><span class="p">:</span> <span class="n">wf</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-208" name="src/Model/experiments/confocal.py-208"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s1">'num_datapoints'</span><span class="p">:</span> <span class="n">num_points_read</span><span class="p">,</span> <span class="s1">'read_waveform'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">empty_waveform</span><span class="p">},</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-209" name="src/Model/experiments/confocal.py-209"></a>
<a id="src/Model/experiments/confocal.py-210" name="src/Model/experiments/confocal.py-210"></a>            <span class="c1">#restricted load_rate and read_rate to ensure cropping works. 2ms and 5ms count times are good as smaller window for speed and a larger window if more counts are needed</span>
<a id="src/Model/experiments/confocal.py-211" name="src/Model/experiments/confocal.py-211"></a><span class="hll">            <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-212" name="src/Model/experiments/confocal.py-212"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_2'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'running'</span><span class="p">:</span> <span class="kc">True</span><span class="p">}})</span>
</span><a id="src/Model/experiments/confocal.py-213" name="src/Model/experiments/confocal.py-213"></a>
<a id="src/Model/experiments/confocal.py-214" name="src/Model/experiments/confocal.py-214"></a><span class="hll">            <span class="n">y_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">waveform_acquisition</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-215" name="src/Model/experiments/confocal.py-215"></a><span class="hll">            <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]</span><span class="o">*</span><span class="n">len_wf</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-216" name="src/Model/experiments/confocal.py-216"></a>
<a id="src/Model/experiments/confocal.py-217" name="src/Model/experiments/confocal.py-217"></a>            <span class="c1">#want to get data only in desired range not range5um</span>
<a id="src/Model/experiments/confocal.py-218" name="src/Model/experiments/confocal.py-218"></a><span class="hll">            <span class="n">y_pos_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-219" name="src/Model/experiments/confocal.py-219"></a>            <span class="c1"># index for the points of the read array when at y_min and y_max. Scale step by load_read_ratio to get points closest to y_min &amp; y_max</span>
<a id="src/Model/experiments/confocal.py-220" name="src/Model/experiments/confocal.py-220"></a><span class="hll">            <span class="n">lower_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">y_pos_array</span> <span class="o">&gt;</span> <span class="n">y_min</span> <span class="o">-</span> <span class="n">step</span> <span class="o">/</span> <span class="n">load_read_ratio</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_pos_array</span> <span class="o">&lt;</span> <span class="n">y_min</span> <span class="o">+</span> <span class="n">step</span> <span class="o">/</span> <span class="n">load_read_ratio</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-221" name="src/Model/experiments/confocal.py-221"></a><span class="hll">            <span class="n">upper_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">y_pos_array</span> <span class="o">&gt;</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">step</span> <span class="o">/</span> <span class="n">load_read_ratio</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_pos_array</span> <span class="o">&lt;</span> <span class="n">y_max</span> <span class="o">+</span> <span class="n">step</span> <span class="o">/</span> <span class="n">load_read_ratio</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-222" name="src/Model/experiments/confocal.py-222"></a><span class="hll">            <span class="n">y_pos_cropped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y_pos_array</span><span class="p">[</span><span class="n">lower_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">upper_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><a id="src/Model/experiments/confocal.py-223" name="src/Model/experiments/confocal.py-223"></a>
<a id="src/Model/experiments/confocal.py-224" name="src/Model/experiments/confocal.py-224"></a>            <span class="c1">#y_data.extend(y_pos_cropped)</span>
<a id="src/Model/experiments/confocal.py-225" name="src/Model/experiments/confocal.py-225"></a><span class="hll">            <span class="n">y_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">y_pos</span><span class="p">))</span>
</span><a id="src/Model/experiments/confocal.py-226" name="src/Model/experiments/confocal.py-226"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'y_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_data</span>
</span><a id="src/Model/experiments/confocal.py-227" name="src/Model/experiments/confocal.py-227"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_2'</span><span class="p">:{</span><span class="s1">'running'</span><span class="p">:</span><span class="kc">False</span><span class="p">}})</span>
</span><a id="src/Model/experiments/confocal.py-228" name="src/Model/experiments/confocal.py-228"></a>
<a id="src/Model/experiments/confocal.py-229" name="src/Model/experiments/confocal.py-229"></a>            <span class="c1">#different index for count data if read and load rates are different</span>
<a id="src/Model/experiments/confocal.py-230" name="src/Model/experiments/confocal.py-230"></a><span class="hll">            <span class="n">counts_lower_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lower_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">load_read_ratio</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-231" name="src/Model/experiments/confocal.py-231"></a><span class="hll">            <span class="n">counts_upper_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">upper_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">load_read_ratio</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-232" name="src/Model/experiments/confocal.py-232"></a><span class="hll">            <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counts_upper_index</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-233" name="src/Model/experiments/confocal.py-233"></a>
<a id="src/Model/experiments/confocal.py-234" name="src/Model/experiments/confocal.py-234"></a>            <span class="c1">#get mode of index list and difference between mode and previous value</span>
<a id="src/Model/experiments/confocal.py-235" name="src/Model/experiments/confocal.py-235"></a><span class="hll">            <span class="n">index_mode</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">index_list</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">index_list</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-236" name="src/Model/experiments/confocal.py-236"></a><span class="hll">            <span class="n">index_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">counts_upper_index</span> <span class="o">-</span> <span class="n">index_mode</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-237" name="src/Model/experiments/confocal.py-237"></a>            <span class="c1"># index starts at 0 so need to add 1 if there is an index difference</span>
<a id="src/Model/experiments/confocal.py-238" name="src/Model/experiments/confocal.py-238"></a><span class="hll">            <span class="k">if</span> <span class="n">index_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-239" name="src/Model/experiments/confocal.py-239"></a><span class="hll">                <span class="n">index_diff</span> <span class="o">=</span> <span class="n">index_diff</span> <span class="o">+</span> <span class="mi">1</span>
</span><a id="src/Model/experiments/confocal.py-240" name="src/Model/experiments/confocal.py-240"></a>
<a id="src/Model/experiments/confocal.py-241" name="src/Model/experiments/confocal.py-241"></a>            <span class="c1"># get count data from adwin and record it</span>
<a id="src/Model/experiments/confocal.py-242" name="src/Model/experiments/confocal.py-242"></a><span class="hll">            <span class="n">raw_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'int_array'</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">len_wf</span><span class="o">+</span><span class="mi">20</span><span class="p">)))</span>
</span><a id="src/Model/experiments/confocal.py-243" name="src/Model/experiments/confocal.py-243"></a>            <span class="c1"># units of count/seconds</span>
<a id="src/Model/experiments/confocal.py-244" name="src/Model/experiments/confocal.py-244"></a><span class="hll">            <span class="n">count_rate</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">])</span>
</span><a id="src/Model/experiments/confocal.py-245" name="src/Model/experiments/confocal.py-245"></a>
<a id="src/Model/experiments/confocal.py-246" name="src/Model/experiments/confocal.py-246"></a><span class="hll">            <span class="n">crop_index</span> <span class="o">=</span> <span class="o">-</span><span class="n">index_mode</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">index_diff</span>
</span><a id="src/Model/experiments/confocal.py-247" name="src/Model/experiments/confocal.py-247"></a><span class="hll">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]</span> <span class="o">==</span> <span class="mf">5.0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-248" name="src/Model/experiments/confocal.py-248"></a><span class="hll">                <span class="n">crop_index</span> <span class="o">=</span> <span class="n">crop_index</span><span class="o">-</span><span class="mi">2</span>
</span><a id="src/Model/experiments/confocal.py-249" name="src/Model/experiments/confocal.py-249"></a><span class="hll">            <span class="n">cropped_raw_counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">[</span><span class="n">crop_index</span><span class="p">:</span><span class="n">crop_index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_array</span><span class="p">)])</span>
</span><a id="src/Model/experiments/confocal.py-250" name="src/Model/experiments/confocal.py-250"></a><span class="hll">            <span class="n">cropped_count_rate</span> <span class="o">=</span> <span class="n">count_rate</span><span class="p">[</span><span class="n">crop_index</span><span class="p">:</span><span class="n">crop_index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_array</span><span class="p">)]</span>
</span><a id="src/Model/experiments/confocal.py-251" name="src/Model/experiments/confocal.py-251"></a>
<a id="src/Model/experiments/confocal.py-252" name="src/Model/experiments/confocal.py-252"></a><span class="hll">            <span class="n">raw_count_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cropped_raw_counts</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-253" name="src/Model/experiments/confocal.py-253"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_count_data</span>
</span><a id="src/Model/experiments/confocal.py-254" name="src/Model/experiments/confocal.py-254"></a>
<a id="src/Model/experiments/confocal.py-255" name="src/Model/experiments/confocal.py-255"></a><span class="hll">            <span class="n">count_rate_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cropped_count_rate</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-256" name="src/Model/experiments/confocal.py-256"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_rate'</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_rate_data</span>
<a id="src/Model/experiments/confocal.py-257" name="src/Model/experiments/confocal.py-257"></a>
<a id="src/Model/experiments/confocal.py-258" name="src/Model/experiments/confocal.py-258"></a>            <span class="c1">#adds count rate data to raw img and cropped count img</span>
<a id="src/Model/experiments/confocal.py-259" name="src/Model/experiments/confocal.py-259"></a><span class="hll">            <span class="n">raw_img_row</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">count_rate</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-260" name="src/Model/experiments/confocal.py-260"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_img'</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">raw_img_row</span>
</span><a id="src/Model/experiments/confocal.py-261" name="src/Model/experiments/confocal.py-261"></a><span class="hll">            <span class="n">img_row</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cropped_count_rate</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-262" name="src/Model/experiments/confocal.py-262"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">img_row</span>  <span class="c1"># add previous scan data so image plots</span>
</span><a id="src/Model/experiments/confocal.py-263" name="src/Model/experiments/confocal.py-263"></a>
<a id="src/Model/experiments/confocal.py-264" name="src/Model/experiments/confocal.py-264"></a>            <span class="c1"># updates process bar and plots count_img so far</span>
<a id="src/Model/experiments/confocal.py-265" name="src/Model/experiments/confocal.py-265"></a><span class="hll">            <span class="n">interation_num</span> <span class="o">=</span> <span class="n">interation_num</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_array</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-266" name="src/Model/experiments/confocal.py-266"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span><span class="n">interation_num</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_interations</span>
<a id="src/Model/experiments/confocal.py-267" name="src/Model/experiments/confocal.py-267"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-268" name="src/Model/experiments/confocal.py-268"></a>
<a id="src/Model/experiments/confocal.py-269" name="src/Model/experiments/confocal.py-269"></a>        <span class="c1">#tracker to only save test image once</span>
<a id="src/Model/experiments/confocal.py-270" name="src/Model/experiments/confocal.py-270"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data_collected</span> <span class="o">=</span> <span class="kc">True</span>
</span><a id="src/Model/experiments/confocal.py-271" name="src/Model/experiments/confocal.py-271"></a>
<a id="src/Model/experiments/confocal.py-272" name="src/Model/experiments/confocal.py-272"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s1">'Data collected'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-273" name="src/Model/experiments/confocal.py-273"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'x_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_data</span>
<a id="src/Model/experiments/confocal.py-274" name="src/Model/experiments/confocal.py-274"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'y_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-275" name="src/Model/experiments/confocal.py-275"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">raw_count_data</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-276" name="src/Model/experiments/confocal.py-276"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_rate'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">count_rate_data</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-277" name="src/Model/experiments/confocal.py-277"></a>        <span class="c1">#print('Position Data: ','\n',self.data['x_pos'],'\n',self.data['y_pos'],'\n','Max x: ',np.max(self.data['x_pos']),'Max y: ',np.max(self.data['y_pos']))</span>
<a id="src/Model/experiments/confocal.py-278" name="src/Model/experiments/confocal.py-278"></a>        <span class="c1">#print('Counts: ','\n',self.count_data)</span>
<a id="src/Model/experiments/confocal.py-279" name="src/Model/experiments/confocal.py-279"></a>        <span class="c1">#print('All data: ',self.data)</span>
<a id="src/Model/experiments/confocal.py-280" name="src/Model/experiments/confocal.py-280"></a>
<a id="src/Model/experiments/confocal.py-281" name="src/Model/experiments/confocal.py-281"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">after_scan</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-282" name="src/Model/experiments/confocal.py-282"></a>
<a id="src/Model/experiments/confocal.py-283" name="src/Model/experiments/confocal.py-283"></a>    <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-284" name="src/Model/experiments/confocal.py-284"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-285" name="src/Model/experiments/confocal.py-285"></a><span class="sd">        This function plots the data. It is triggered when the updateProgress signal is emited and when after the _function is executed.</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-312" name="src/Model/experiments/confocal.py-312"></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="p">{}:</span>
<a id="src/Model/experiments/confocal.py-313" name="src/Model/experiments/confocal.py-313"></a>            <span class="c1">#for colorbar to display graident without artificial zeros</span>
<a id="src/Model/experiments/confocal.py-314" name="src/Model/experiments/confocal.py-314"></a>            <span class="k">try</span><span class="p">:</span> <span class="c1">#sometimes when data is inputted as argument it does not have 'count_img' key; this try/except prevents error if that happens</span>
<a id="src/Model/experiments/confocal.py-315" name="src/Model/experiments/confocal.py-315"></a>                <span class="n">non_zero_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="src/Model/experiments/confocal.py-316" name="src/Model/experiments/confocal.py-316"></a><span class="hll">            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-317" name="src/Model/experiments/confocal.py-317"></a><span class="hll">                <span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-318" name="src/Model/experiments/confocal.py-318"></a><span class="hll">                <span class="n">non_zero_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-319" name="src/Model/experiments/confocal.py-319"></a>            <span class="k">if</span> <span class="n">non_zero_values</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-320" name="src/Model/experiments/confocal.py-320"></a>                <span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">non_zero_values</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-321" name="src/Model/experiments/confocal.py-321"></a>            <span class="k">else</span><span class="p">:</span> <span class="c1">#if else to aviod ValueError</span>
<a id="src/Model/experiments/confocal.py-322" name="src/Model/experiments/confocal.py-322"></a><span class="hll">                <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
</span><a id="src/Model/experiments/confocal.py-323" name="src/Model/experiments/confocal.py-323"></a>
<a id="src/Model/experiments/confocal.py-324" name="src/Model/experiments/confocal.py-324"></a>            <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">])]</span>
<a id="src/Model/experiments/confocal.py-325" name="src/Model/experiments/confocal.py-325"></a>            <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_a'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_b'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_a'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_b'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">]]</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-333" name="src/Model/experiments/confocal.py-333"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">count_image</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-334" name="src/Model/experiments/confocal.py-334"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-335" name="src/Model/experiments/confocal.py-335"></a>
<a id="src/Model/experiments/confocal.py-336" name="src/Model/experiments/confocal.py-336"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'3D_scan'</span><span class="p">][</span><span class="s1">'enable'</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_collected</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-337" name="src/Model/experiments/confocal.py-337"></a><span class="hll">                        <span class="nb">print</span><span class="p">(</span><span class="s1">'z ='</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span><span class="p">,</span> <span class="s1">'max counts ='</span><span class="p">,</span> <span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><a id="src/Model/experiments/confocal.py-338" name="src/Model/experiments/confocal.py-338"></a><span class="hll">                        <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Confocal Scan with z = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-339" name="src/Model/experiments/confocal.py-339"></a><span class="hll">                        <span class="n">scene</span> <span class="o">=</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-340" name="src/Model/experiments/confocal.py-340"></a><span class="hll">                        <span class="n">exporter</span> <span class="o">=</span> <span class="n">ImageExporter</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-341" name="src/Model/experiments/confocal.py-341"></a><span class="hll">                        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'3D_scan'</span><span class="p">][</span><span class="s1">'folderpath'</span><span class="p">],</span> <span class="sa">f</span><span class="s1">'confocal_scan_z_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">.png'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-342" name="src/Model/experiments/confocal.py-342"></a><span class="hll">                        <span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-343" name="src/Model/experiments/confocal.py-343"></a>
<a id="src/Model/experiments/confocal.py-344" name="src/Model/experiments/confocal.py-344"></a><span class="hll">                <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-345" name="src/Model/experiments/confocal.py-345"></a>                    <span class="c1"># sometimes when clicking other experiments ImageItem is deleted but _plot_refresh is false. This ensures the image can be replotted</span>
<a id="src/Model/experiments/confocal.py-346" name="src/Model/experiments/confocal.py-346"></a><span class="hll">                    <span class="n">create_img</span><span class="p">(</span><span class="n">add_colobar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-347" name="src/Model/experiments/confocal.py-347"></a>
<a id="src/Model/experiments/confocal.py-348" name="src/Model/experiments/confocal.py-348"></a>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axes_list</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-349" name="src/Model/experiments/confocal.py-349"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">count_image</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">],</span> <span class="n">autoLevels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-350" name="src/Model/experiments/confocal.py-350"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">count_image</span><span class="o">.</span><span class="n">setLevels</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">])])</span>
</span><a id="src/Model/experiments/confocal.py-351" name="src/Model/experiments/confocal.py-351"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">setLevels</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">])])</span>
</span><a id="src/Model/experiments/confocal.py-352" name="src/Model/experiments/confocal.py-352"></a>
<a id="src/Model/experiments/confocal.py-353" name="src/Model/experiments/confocal.py-353"></a>    <span class="k">def</span> <span class="nf">correct_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_step</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-354" name="src/Model/experiments/confocal.py-354"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-355" name="src/Model/experiments/confocal.py-355"></a><span class="sd">        Increases resolution by one threshold if the step size does not give enough points for a good y-array.</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-354" name="src/Model/experiments/confocal.py-354"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-355" name="src/Model/experiments/confocal.py-355"></a><span class="sd">        Increases resolution by one threshold if the step size does not give enough points for a good y-array.</span>
<a id="src/Model/experiments/confocal.py-356" name="src/Model/experiments/confocal.py-356"></a><span class="sd">        For good y-array len() &gt; 90</span>
<a id="src/Model/experiments/confocal.py-357" name="src/Model/experiments/confocal.py-357"></a><span class="sd">         '''</span>
<a id="src/Model/experiments/confocal.py-358" name="src/Model/experiments/confocal.py-358"></a><span class="hll">        <span class="k">if</span> <span class="n">old_step</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-359" name="src/Model/experiments/confocal.py-359"></a><span class="hll">            <span class="k">return</span> <span class="mf">0.5</span>
</span><a id="src/Model/experiments/confocal.py-360" name="src/Model/experiments/confocal.py-360"></a><span class="hll">        <span class="k">elif</span> <span class="n">old_step</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-361" name="src/Model/experiments/confocal.py-361"></a><span class="hll">            <span class="k">return</span> <span class="mf">1.0</span>
</span><a id="src/Model/experiments/confocal.py-362" name="src/Model/experiments/confocal.py-362"></a><span class="hll">        <span class="k">elif</span> <span class="n">old_step</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-363" name="src/Model/experiments/confocal.py-363"></a><span class="hll">            <span class="k">return</span> <span class="mf">0.25</span>
</span><a id="src/Model/experiments/confocal.py-364" name="src/Model/experiments/confocal.py-364"></a><span class="hll">        <span class="k">elif</span> <span class="n">old_step</span> <span class="o">==</span> <span class="mf">0.25</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-365" name="src/Model/experiments/confocal.py-365"></a><span class="hll">            <span class="k">return</span> <span class="mf">0.1</span>
</span><a id="src/Model/experiments/confocal.py-366" name="src/Model/experiments/confocal.py-366"></a><span class="hll">        <span class="k">elif</span> <span class="n">old_step</span> <span class="o">==</span> <span class="mf">0.1</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-367" name="src/Model/experiments/confocal.py-367"></a><span class="hll">            <span class="k">return</span> <span class="mf">0.05</span>
</span><a id="src/Model/experiments/confocal.py-368" name="src/Model/experiments/confocal.py-368"></a><span class="hll">        <span class="k">elif</span> <span class="n">old_step</span> <span class="o">==</span> <span class="mf">0.05</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-369" name="src/Model/experiments/confocal.py-369"></a><span class="hll">            <span class="k">return</span> <span class="mf">0.025</span>
</span><a id="src/Model/experiments/confocal.py-370" name="src/Model/experiments/confocal.py-370"></a><span class="hll">        <span class="k">elif</span> <span class="n">old_step</span> <span class="o">==</span> <span class="mf">0.025</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-371" name="src/Model/experiments/confocal.py-371"></a><span class="hll">            <span class="k">return</span> <span class="mf">0.001</span>
</span><a id="src/Model/experiments/confocal.py-372" name="src/Model/experiments/confocal.py-372"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-373" name="src/Model/experiments/confocal.py-373"></a><span class="hll">            <span class="k">raise</span> <span class="ne">KeyError</span>
</span><a id="src/Model/experiments/confocal.py-374" name="src/Model/experiments/confocal.py-374"></a>
<a id="src/Model/experiments/confocal.py-375" name="src/Model/experiments/confocal.py-375"></a>
<a id="src/Model/experiments/confocal.py-376" name="src/Model/experiments/confocal.py-376"></a>
<a id="src/Model/experiments/confocal.py-377" name="src/Model/experiments/confocal.py-377"></a><span class="k">class</span> <span class="nc">ConfocalScan_Slow</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-423" name="src/Model/experiments/confocal.py-423"></a>    <span class="k">def</span> <span class="nf">setup_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-424" name="src/Model/experiments/confocal.py-424"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-425" name="src/Model/experiments/confocal.py-425"></a><span class="sd">        Gets paths for adbasic file and loads them onto ADwin.</span>
<a id="src/Model/experiments/confocal.py-426" name="src/Model/experiments/confocal.py-426"></a><span class="sd">        '''</span>
<a id="src/Model/experiments/confocal.py-427" name="src/Model/experiments/confocal.py-427"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">stop_process</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-428" name="src/Model/experiments/confocal.py-428"></a><span class="hll">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-429" name="src/Model/experiments/confocal.py-429"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">clear_process</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-430" name="src/Model/experiments/confocal.py-430"></a><span class="hll">        <span class="n">trial_counter_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'Controller'</span><span class="p">,</span><span class="s1">'binary_files'</span><span class="p">,</span> <span class="s1">'ADbasic'</span><span class="p">,</span> <span class="s1">'Trial_Counter.TB1'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-431" name="src/Model/experiments/confocal.py-431"></a><span class="hll">        <span class="n">trial_counter</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">trial_counter_path</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-432" name="src/Model/experiments/confocal.py-432"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_1'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'load'</span><span class="p">:</span> <span class="n">trial_counter</span><span class="p">}})</span>
</span><a id="src/Model/experiments/confocal.py-433" name="src/Model/experiments/confocal.py-433"></a>        <span class="c1">#trial counter simply reads the counter value</span>
<a id="src/Model/experiments/confocal.py-434" name="src/Model/experiments/confocal.py-434"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">clock_functions</span><span class="p">(</span><span class="s1">'Frame'</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># reset ALL clocks to default settings</span>
</span><a id="src/Model/experiments/confocal.py-435" name="src/Model/experiments/confocal.py-435"></a>
<a id="src/Model/experiments/confocal.py-436" name="src/Model/experiments/confocal.py-436"></a><span class="hll">        <span class="n">z_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'z_pos'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-437" name="src/Model/experiments/confocal.py-437"></a><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'z_pos'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-438" name="src/Model/experiments/confocal.py-438"></a><span class="hll">            <span class="n">z_pos</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><a id="src/Model/experiments/confocal.py-439" name="src/Model/experiments/confocal.py-439"></a><span class="hll">        <span class="k">elif</span> <span class="n">z_pos</span> <span class="o">&gt;</span> <span class="mf">100.0</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-440" name="src/Model/experiments/confocal.py-440"></a><span class="hll">            <span class="n">z_pos</span> <span class="o">=</span> <span class="mf">100.0</span>
</span><a id="src/Model/experiments/confocal.py-441" name="src/Model/experiments/confocal.py-441"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'z_pos'</span><span class="p">:</span> <span class="n">z_pos</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-442" name="src/Model/experiments/confocal.py-442"></a>
<a id="src/Model/experiments/confocal.py-443" name="src/Model/experiments/confocal.py-443"></a>        <span class="c1"># tracker to only save 3D image slice once</span>
<a id="src/Model/experiments/confocal.py-444" name="src/Model/experiments/confocal.py-444"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data_collected</span> <span class="o">=</span> <span class="kc">False</span>
</span><a id="src/Model/experiments/confocal.py-445" name="src/Model/experiments/confocal.py-445"></a>
<a id="src/Model/experiments/confocal.py-446" name="src/Model/experiments/confocal.py-446"></a>    <span class="k">def</span> <span class="nf">after_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-447" name="src/Model/experiments/confocal.py-447"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-448" name="src/Model/experiments/confocal.py-448"></a><span class="sd">        Cleans up adwin and moves nanodrive to specified position</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-447" name="src/Model/experiments/confocal.py-447"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-448" name="src/Model/experiments/confocal.py-448"></a><span class="sd">        Cleans up adwin and moves nanodrive to specified position</span>
<a id="src/Model/experiments/confocal.py-449" name="src/Model/experiments/confocal.py-449"></a><span class="sd">        '''</span>
<a id="src/Model/experiments/confocal.py-450" name="src/Model/experiments/confocal.py-450"></a>        <span class="c1"># clearing process to aviod memory fragmentation when running different experiments in GUI</span>
<a id="src/Model/experiments/confocal.py-451" name="src/Model/experiments/confocal.py-451"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">stop_process</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1">#neccesary if process is does not stop for some reason</span>
</span><a id="src/Model/experiments/confocal.py-452" name="src/Model/experiments/confocal.py-452"></a><span class="hll">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-453" name="src/Model/experiments/confocal.py-453"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">clear_process</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-454" name="src/Model/experiments/confocal.py-454"></a><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'ending_behavior'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'return_to_inital_pos'</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-455" name="src/Model/experiments/confocal.py-455"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x_pos'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_inital</span><span class="p">,</span> <span class="s1">'y_pos'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_inital</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-456" name="src/Model/experiments/confocal.py-456"></a><span class="hll">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'ending_behavior'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'return_to_origin'</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-457" name="src/Model/experiments/confocal.py-457"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x_pos'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">'y_pos'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-458" name="src/Model/experiments/confocal.py-458"></a>
<a id="src/Model/experiments/confocal.py-459" name="src/Model/experiments/confocal.py-459"></a>    <span class="k">def</span> <span class="nf">_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-460" name="src/Model/experiments/confocal.py-460"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/Model/experiments/confocal.py-461" name="src/Model/experiments/confocal.py-461"></a><span class="sd">        This is the actual function that will be executed. It uses only information that is provided in the settings property</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-460" name="src/Model/experiments/confocal.py-460"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/Model/experiments/confocal.py-461" name="src/Model/experiments/confocal.py-461"></a><span class="sd">        This is the actual function that will be executed. It uses only information that is provided in the settings property</span>
<a id="src/Model/experiments/confocal.py-462" name="src/Model/experiments/confocal.py-462"></a><span class="sd">        will be overwritten in the __init__</span>
<a id="src/Model/experiments/confocal.py-463" name="src/Model/experiments/confocal.py-463"></a><span class="sd">        """</span>
<a id="src/Model/experiments/confocal.py-464" name="src/Model/experiments/confocal.py-464"></a><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'reboot_adwin'</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-465" name="src/Model/experiments/confocal.py-465"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">reboot_adwin</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-466" name="src/Model/experiments/confocal.py-466"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">setup_scan</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-467" name="src/Model/experiments/confocal.py-467"></a><span class="hll">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-468" name="src/Model/experiments/confocal.py-468"></a>
<a id="src/Model/experiments/confocal.py-469" name="src/Model/experiments/confocal.py-469"></a><span class="hll">        <span class="n">x_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_a'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-470" name="src/Model/experiments/confocal.py-470"></a><span class="hll">        <span class="n">x_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_b'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-471" name="src/Model/experiments/confocal.py-471"></a><span class="hll">        <span class="n">y_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_a'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-472" name="src/Model/experiments/confocal.py-472"></a><span class="hll">        <span class="n">y_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_b'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-473" name="src/Model/experiments/confocal.py-473"></a><span class="hll">        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'resolution'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-474" name="src/Model/experiments/confocal.py-474"></a>        <span class="c1">#array form point_a x,y to point_b x,y with step of resolution</span>
<a id="src/Model/experiments/confocal.py-475" name="src/Model/experiments/confocal.py-475"></a><span class="hll">        <span class="n">x_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-476" name="src/Model/experiments/confocal.py-476"></a><span class="hll">        <span class="n">y_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-477" name="src/Model/experiments/confocal.py-477"></a><span class="hll">        <span class="n">reversed_y_array</span> <span class="o">=</span> <span class="n">y_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-478" name="src/Model/experiments/confocal.py-478"></a>
<a id="src/Model/experiments/confocal.py-479" name="src/Model/experiments/confocal.py-479"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">x_inital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'x_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-480" name="src/Model/experiments/confocal.py-480"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">y_inital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'y_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-481" name="src/Model/experiments/confocal.py-481"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'z_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-482" name="src/Model/experiments/confocal.py-482"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'z_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span>
</span><a id="src/Model/experiments/confocal.py-483" name="src/Model/experiments/confocal.py-483"></a>
<a id="src/Model/experiments/confocal.py-484" name="src/Model/experiments/confocal.py-484"></a>        <span class="c1">#makes sure data is getting recorded. If still equal none after running experiment data is not being stored or measured</span>
<a id="src/Model/experiments/confocal.py-485" name="src/Model/experiments/confocal.py-485"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'x_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/confocal.py-486" name="src/Model/experiments/confocal.py-486"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'y_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/confocal.py-487" name="src/Model/experiments/confocal.py-487"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/confocal.py-488" name="src/Model/experiments/confocal.py-488"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'counts'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/confocal.py-489" name="src/Model/experiments/confocal.py-489"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/confocal.py-490" name="src/Model/experiments/confocal.py-490"></a>        <span class="c1">#local lists to store data and append to global self.data lists</span>
<a id="src/Model/experiments/confocal.py-491" name="src/Model/experiments/confocal.py-491"></a><span class="hll">        <span class="n">x_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/confocal.py-492" name="src/Model/experiments/confocal.py-492"></a><span class="hll">        <span class="n">y_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/confocal.py-493" name="src/Model/experiments/confocal.py-493"></a><span class="hll">        <span class="n">raw_counts_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/confocal.py-494" name="src/Model/experiments/confocal.py-494"></a><span class="hll">        <span class="n">count_rate_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/confocal.py-495" name="src/Model/experiments/confocal.py-495"></a>
<a id="src/Model/experiments/confocal.py-496" name="src/Model/experiments/confocal.py-496"></a><span class="hll">        <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_array</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-497" name="src/Model/experiments/confocal.py-497"></a><span class="hll">        <span class="n">Ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_array</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-498" name="src/Model/experiments/confocal.py-498"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">))</span>
</span><a id="src/Model/experiments/confocal.py-499" name="src/Model/experiments/confocal.py-499"></a>
<a id="src/Model/experiments/confocal.py-500" name="src/Model/experiments/confocal.py-500"></a><span class="hll">        <span class="n">interation_num</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#number to track progress</span>
</span><a id="src/Model/experiments/confocal.py-501" name="src/Model/experiments/confocal.py-501"></a><span class="hll">        <span class="n">total_interations</span> <span class="o">=</span> <span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span><span class="o">/</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span><span class="o">/</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>       <span class="c1">#plus 1 because in total_iterations range is inclusive ie. [0,10]</span>
</span><a id="src/Model/experiments/confocal.py-502" name="src/Model/experiments/confocal.py-502"></a>        <span class="c1">#print('total_interations=',total_interations)</span>
<a id="src/Model/experiments/confocal.py-503" name="src/Model/experiments/confocal.py-503"></a>
<a id="src/Model/experiments/confocal.py-504" name="src/Model/experiments/confocal.py-504"></a>        <span class="c1">#formula to set adwin to count for correct time frame. The event section is run every delay*3.3ns so the counter increments for that time then is read and clear</span>
<a id="src/Model/experiments/confocal.py-505" name="src/Model/experiments/confocal.py-505"></a>        <span class="c1">#time_per_pt is in millisecond and the adwin delay time is delay_value*3.3ns</span>
<a id="src/Model/experiments/confocal.py-506" name="src/Model/experiments/confocal.py-506"></a><span class="hll">        <span class="n">adwin_delay</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]</span><span class="o">*</span><span class="mf">1e6</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">))</span>
</span><a id="src/Model/experiments/confocal.py-507" name="src/Model/experiments/confocal.py-507"></a>        <span class="c1">#print('adwin delay: ',adwin_delay)  606061 for 2ms and 606061*3.3 ns ~= 2 ms</span>
<a id="src/Model/experiments/confocal.py-508" name="src/Model/experiments/confocal.py-508"></a>
<a id="src/Model/experiments/confocal.py-509" name="src/Model/experiments/confocal.py-509"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_1'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'delay'</span><span class="p">:</span> <span class="n">adwin_delay</span><span class="p">,</span> <span class="s1">'running'</span><span class="p">:</span> <span class="kc">True</span><span class="p">}})</span>
</span><a id="src/Model/experiments/confocal.py-510" name="src/Model/experiments/confocal.py-510"></a>        <span class="c1"># print(adwin_delay * 3.3 * 1e-9)</span>
<a id="src/Model/experiments/confocal.py-511" name="src/Model/experiments/confocal.py-511"></a>        <span class="c1"># set inital x and y and set nanodrive stage to that position</span>
<a id="src/Model/experiments/confocal.py-512" name="src/Model/experiments/confocal.py-512"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x_pos'</span><span class="p">:</span> <span class="n">x_min</span><span class="p">,</span> <span class="s1">'y_pos'</span><span class="p">:</span> <span class="n">y_min</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-513" name="src/Model/experiments/confocal.py-513"></a><span class="hll">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># time for stage to move and adwin process to initilize</span>
</span><a id="src/Model/experiments/confocal.py-514" name="src/Model/experiments/confocal.py-514"></a>
<a id="src/Model/experiments/confocal.py-515" name="src/Model/experiments/confocal.py-515"></a><span class="hll">        <span class="n">forward</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#used to rasterize more efficently going forward then back</span>
</span><a id="src/Model/experiments/confocal.py-516" name="src/Model/experiments/confocal.py-516"></a><span class="hll">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x_array</span><span class="p">):</span>
</span><a id="src/Model/experiments/confocal.py-517" name="src/Model/experiments/confocal.py-517"></a><span class="hll">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abort</span><span class="p">:</span>  <span class="c1"># halts loop (and experiment) if stop button is pressed</span>
</span><a id="src/Model/experiments/confocal.py-518" name="src/Model/experiments/confocal.py-518"></a><span class="hll">                <span class="k">break</span> <span class="c1">#need to put break in x for loop which takes some time to stop but if stopped in y loop array sizes may mismatch and require a GUI restart</span>
</span><a id="src/Model/experiments/confocal.py-519" name="src/Model/experiments/confocal.py-519"></a><span class="hll">            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-520" name="src/Model/experiments/confocal.py-520"></a><span class="hll">            <span class="n">img_row</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">#used for tracking image rows and adding to count_img; list not saved</span>
</span><a id="src/Model/experiments/confocal.py-521" name="src/Model/experiments/confocal.py-521"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x_pos'</span><span class="p">:</span><span class="n">x</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-522" name="src/Model/experiments/confocal.py-522"></a>
<a id="src/Model/experiments/confocal.py-523" name="src/Model/experiments/confocal.py-523"></a><span class="hll">            <span class="k">if</span> <span class="n">forward</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-524" name="src/Model/experiments/confocal.py-524"></a><span class="hll">                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">y_array</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-525" name="src/Model/experiments/confocal.py-525"></a><span class="hll">                    <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-526" name="src/Model/experiments/confocal.py-526"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-527" name="src/Model/experiments/confocal.py-527"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'y_pos'</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-528" name="src/Model/experiments/confocal.py-528"></a><span class="hll">                    <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'settle_time'</span><span class="p">])</span>
</span><a id="src/Model/experiments/confocal.py-529" name="src/Model/experiments/confocal.py-529"></a>
<a id="src/Model/experiments/confocal.py-530" name="src/Model/experiments/confocal.py-530"></a><span class="hll">                    <span class="n">x_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'x_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-531" name="src/Model/experiments/confocal.py-531"></a><span class="hll">                    <span class="n">x_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-532" name="src/Model/experiments/confocal.py-532"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'x_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_data</span>  <span class="c1"># adds x postion to data</span>
</span><a id="src/Model/experiments/confocal.py-533" name="src/Model/experiments/confocal.py-533"></a><span class="hll">                    <span class="n">y_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'y_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-534" name="src/Model/experiments/confocal.py-534"></a><span class="hll">                    <span class="n">y_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-535" name="src/Model/experiments/confocal.py-535"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'y_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_data</span>  <span class="c1"># adds y postion to data</span>
</span><a id="src/Model/experiments/confocal.py-536" name="src/Model/experiments/confocal.py-536"></a>
<a id="src/Model/experiments/confocal.py-537" name="src/Model/experiments/confocal.py-537"></a><span class="hll">                    <span class="n">raw_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'int_var'</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1">#raw number of counter triggers</span>
</span><a id="src/Model/experiments/confocal.py-538" name="src/Model/experiments/confocal.py-538"></a><span class="hll">                    <span class="n">count_rate</span> <span class="o">=</span> <span class="n">raw_counts</span><span class="o">*</span><span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]</span> <span class="c1"># in units of counts/second</span>
</span><a id="src/Model/experiments/confocal.py-539" name="src/Model/experiments/confocal.py-539"></a>
<a id="src/Model/experiments/confocal.py-540" name="src/Model/experiments/confocal.py-540"></a><span class="hll">                    <span class="n">img_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_rate</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-541" name="src/Model/experiments/confocal.py-541"></a><span class="hll">                    <span class="n">raw_counts_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-542" name="src/Model/experiments/confocal.py-542"></a><span class="hll">                    <span class="n">count_rate_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_rate</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-543" name="src/Model/experiments/confocal.py-543"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_counts_data</span>
</span><a id="src/Model/experiments/confocal.py-544" name="src/Model/experiments/confocal.py-544"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_rate_data</span>
</span><a id="src/Model/experiments/confocal.py-545" name="src/Model/experiments/confocal.py-545"></a>
<a id="src/Model/experiments/confocal.py-546" name="src/Model/experiments/confocal.py-546"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-547" name="src/Model/experiments/confocal.py-547"></a><span class="hll">                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">reversed_y_array</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-548" name="src/Model/experiments/confocal.py-548"></a><span class="hll">                    <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-549" name="src/Model/experiments/confocal.py-549"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-550" name="src/Model/experiments/confocal.py-550"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'y_pos'</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-551" name="src/Model/experiments/confocal.py-551"></a><span class="hll">                    <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'settle_time'</span><span class="p">])</span>
</span><a id="src/Model/experiments/confocal.py-552" name="src/Model/experiments/confocal.py-552"></a>
<a id="src/Model/experiments/confocal.py-553" name="src/Model/experiments/confocal.py-553"></a><span class="hll">                    <span class="n">x_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'x_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-554" name="src/Model/experiments/confocal.py-554"></a><span class="hll">                    <span class="n">x_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-555" name="src/Model/experiments/confocal.py-555"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'x_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_data</span>  <span class="c1"># adds x postion to data</span>
</span><a id="src/Model/experiments/confocal.py-556" name="src/Model/experiments/confocal.py-556"></a><span class="hll">                    <span class="n">y_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'y_pos'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-557" name="src/Model/experiments/confocal.py-557"></a><span class="hll">                    <span class="n">y_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-558" name="src/Model/experiments/confocal.py-558"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'y_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_data</span>  <span class="c1"># adds y postion to data</span>
</span><a id="src/Model/experiments/confocal.py-559" name="src/Model/experiments/confocal.py-559"></a>
<a id="src/Model/experiments/confocal.py-560" name="src/Model/experiments/confocal.py-560"></a><span class="hll">                    <span class="n">raw_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'int_var'</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># raw number of counter triggers</span>
</span><a id="src/Model/experiments/confocal.py-561" name="src/Model/experiments/confocal.py-561"></a><span class="hll">                    <span class="n">count_rate</span> <span class="o">=</span> <span class="n">raw_counts</span><span class="o">*</span><span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'time_per_pt'</span><span class="p">]</span> <span class="c1"># in units of counts/second</span>
</span><a id="src/Model/experiments/confocal.py-562" name="src/Model/experiments/confocal.py-562"></a>
<a id="src/Model/experiments/confocal.py-563" name="src/Model/experiments/confocal.py-563"></a><span class="hll">                    <span class="n">img_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_rate</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-564" name="src/Model/experiments/confocal.py-564"></a><span class="hll">                    <span class="n">raw_counts_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-565" name="src/Model/experiments/confocal.py-565"></a><span class="hll">                    <span class="n">count_rate_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_rate</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-566" name="src/Model/experiments/confocal.py-566"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_counts_data</span>
</span><a id="src/Model/experiments/confocal.py-567" name="src/Model/experiments/confocal.py-567"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_rate_data</span>
</span><a id="src/Model/experiments/confocal.py-568" name="src/Model/experiments/confocal.py-568"></a><span class="hll">                <span class="n">img_row</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1">#reversed since going from y_max --&gt; y_min</span>
</span><a id="src/Model/experiments/confocal.py-569" name="src/Model/experiments/confocal.py-569"></a>
<a id="src/Model/experiments/confocal.py-570" name="src/Model/experiments/confocal.py-570"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">img_row</span>
</span><a id="src/Model/experiments/confocal.py-571" name="src/Model/experiments/confocal.py-571"></a><span class="hll">            <span class="n">forward</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">forward</span>
</span><a id="src/Model/experiments/confocal.py-572" name="src/Model/experiments/confocal.py-572"></a>
<a id="src/Model/experiments/confocal.py-573" name="src/Model/experiments/confocal.py-573"></a><span class="hll">            <span class="n">interation_num</span> <span class="o">=</span> <span class="n">interation_num</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_array</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-574" name="src/Model/experiments/confocal.py-574"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span><span class="n">interation_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_interations</span>
</span><a id="src/Model/experiments/confocal.py-575" name="src/Model/experiments/confocal.py-575"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-576" name="src/Model/experiments/confocal.py-576"></a>
<a id="src/Model/experiments/confocal.py-577" name="src/Model/experiments/confocal.py-577"></a>        <span class="c1"># tracker to only save test image once</span>
<a id="src/Model/experiments/confocal.py-578" name="src/Model/experiments/confocal.py-578"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data_collected</span> <span class="o">=</span> <span class="kc">True</span>
</span><a id="src/Model/experiments/confocal.py-579" name="src/Model/experiments/confocal.py-579"></a>
<a id="src/Model/experiments/confocal.py-580" name="src/Model/experiments/confocal.py-580"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s1">'Data collected'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-581" name="src/Model/experiments/confocal.py-581"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'x_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_data</span>
</span><a id="src/Model/experiments/confocal.py-582" name="src/Model/experiments/confocal.py-582"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'y_pos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_data</span>
</span><a id="src/Model/experiments/confocal.py-583" name="src/Model/experiments/confocal.py-583"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_counts_data</span>
</span><a id="src/Model/experiments/confocal.py-584" name="src/Model/experiments/confocal.py-584"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_rate_data</span>
</span><a id="src/Model/experiments/confocal.py-585" name="src/Model/experiments/confocal.py-585"></a>
<a id="src/Model/experiments/confocal.py-586" name="src/Model/experiments/confocal.py-586"></a>        <span class="c1">#print('Position Data: ', '\n', self.data['x_pos'], '\n', self.data['y_pos'], '\n', 'Max x: ',np.max(self.data['x_pos']), 'Max y: ', np.max(self.data['y_pos']))</span>
<a id="src/Model/experiments/confocal.py-587" name="src/Model/experiments/confocal.py-587"></a>        <span class="c1">#print('All data: ',self.data)</span>
<a id="src/Model/experiments/confocal.py-588" name="src/Model/experiments/confocal.py-588"></a>
<a id="src/Model/experiments/confocal.py-589" name="src/Model/experiments/confocal.py-589"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_2'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'running'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}})</span>
</span><a id="src/Model/experiments/confocal.py-590" name="src/Model/experiments/confocal.py-590"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">after_scan</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-591" name="src/Model/experiments/confocal.py-591"></a>
<a id="src/Model/experiments/confocal.py-592" name="src/Model/experiments/confocal.py-592"></a>    <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-593" name="src/Model/experiments/confocal.py-593"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-594" name="src/Model/experiments/confocal.py-594"></a><span class="sd">        This function plots the data. It is triggered when the updateProgress signal is emited and when after the _function is executed.</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-624" name="src/Model/experiments/confocal.py-624"></a>            <span class="n">non_zero_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="src/Model/experiments/confocal.py-625" name="src/Model/experiments/confocal.py-625"></a>            <span class="k">if</span> <span class="n">non_zero_values</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-626" name="src/Model/experiments/confocal.py-626"></a>                <span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">non_zero_values</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-627" name="src/Model/experiments/confocal.py-627"></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># if else to aviod ValueError</span>
<a id="src/Model/experiments/confocal.py-628" name="src/Model/experiments/confocal.py-628"></a><span class="hll">                <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
</span><a id="src/Model/experiments/confocal.py-629" name="src/Model/experiments/confocal.py-629"></a>
<a id="src/Model/experiments/confocal.py-630" name="src/Model/experiments/confocal.py-630"></a>            <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">])]</span>
<a id="src/Model/experiments/confocal.py-631" name="src/Model/experiments/confocal.py-631"></a>            <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_a'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_b'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_a'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point_b'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">]]</span>
<a id="src/Model/experiments/confocal.py-632" name="src/Model/experiments/confocal.py-632"></a>            <span class="c1"># extent = [np.min(data['x_pos']), np.max(data['x_pos']), np.min(data['y_pos']), np.max(data['y_pos'])]</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-640" name="src/Model/experiments/confocal.py-640"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">slow_count_image</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-641" name="src/Model/experiments/confocal.py-641"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-642" name="src/Model/experiments/confocal.py-642"></a>
<a id="src/Model/experiments/confocal.py-643" name="src/Model/experiments/confocal.py-643"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'3D_scan'</span><span class="p">][</span><span class="s1">'enable'</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_collected</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-644" name="src/Model/experiments/confocal.py-644"></a><span class="hll">                        <span class="nb">print</span><span class="p">(</span><span class="s1">'z ='</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span><span class="p">,</span> <span class="s1">'max counts ='</span><span class="p">,</span> <span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><a id="src/Model/experiments/confocal.py-645" name="src/Model/experiments/confocal.py-645"></a><span class="hll">                        <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Confocal Scan with z = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-646" name="src/Model/experiments/confocal.py-646"></a><span class="hll">                        <span class="n">scene</span> <span class="o">=</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-647" name="src/Model/experiments/confocal.py-647"></a><span class="hll">                        <span class="n">exporter</span> <span class="o">=</span> <span class="n">ImageExporter</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-648" name="src/Model/experiments/confocal.py-648"></a><span class="hll">                        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'3D_scan'</span><span class="p">][</span><span class="s1">'folderpath'</span><span class="p">],</span> <span class="sa">f</span><span class="s1">'confocal_scan_z_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">z_inital</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">.png'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-649" name="src/Model/experiments/confocal.py-649"></a><span class="hll">                        <span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-650" name="src/Model/experiments/confocal.py-650"></a>
<a id="src/Model/experiments/confocal.py-651" name="src/Model/experiments/confocal.py-651"></a><span class="hll">                <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
</span><a id="src/Model/experiments/confocal.py-652" name="src/Model/experiments/confocal.py-652"></a>                    <span class="c1"># sometimes when clicking other experiments ImageItem is deleted but _plot_refresh is false. This ensures the image can be replotted</span>
<a id="src/Model/experiments/confocal.py-653" name="src/Model/experiments/confocal.py-653"></a><span class="hll">                    <span class="n">create_img</span><span class="p">(</span><span class="n">add_colobar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-654" name="src/Model/experiments/confocal.py-654"></a>
<a id="src/Model/experiments/confocal.py-655" name="src/Model/experiments/confocal.py-655"></a>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axes_list</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-656" name="src/Model/experiments/confocal.py-656"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">slow_count_image</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">],</span> <span class="n">autoLevels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-657" name="src/Model/experiments/confocal.py-657"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">slow_count_image</span><span class="o">.</span><span class="n">setLevels</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">])])</span>
</span><a id="src/Model/experiments/confocal.py-658" name="src/Model/experiments/confocal.py-658"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">setLevels</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'count_img'</span><span class="p">])])</span>
</span><a id="src/Model/experiments/confocal.py-659" name="src/Model/experiments/confocal.py-659"></a>
<a id="src/Model/experiments/confocal.py-660" name="src/Model/experiments/confocal.py-660"></a>
<a id="src/Model/experiments/confocal.py-661" name="src/Model/experiments/confocal.py-661"></a>
<a id="src/Model/experiments/confocal.py-662" name="src/Model/experiments/confocal.py-662"></a><span class="k">class</span> <span class="nc">Confocal_Point</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-705" name="src/Model/experiments/confocal.py-705"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-706" name="src/Model/experiments/confocal.py-706"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-707" name="src/Model/experiments/confocal.py-707"></a><span class="sd">        Gets paths for adbasic file and loads them onto ADwin.</span>
<a id="src/Model/experiments/confocal.py-708" name="src/Model/experiments/confocal.py-708"></a><span class="sd">        '''</span>
<a id="src/Model/experiments/confocal.py-709" name="src/Model/experiments/confocal.py-709"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">stop_process</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-710" name="src/Model/experiments/confocal.py-710"></a><span class="hll">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-711" name="src/Model/experiments/confocal.py-711"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">clear_process</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-712" name="src/Model/experiments/confocal.py-712"></a><span class="hll">        <span class="n">trial_counter_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'Controller'</span><span class="p">,</span><span class="s1">'binary_files'</span><span class="p">,</span> <span class="s1">'ADbasic'</span><span class="p">,</span> <span class="s1">'Averagable_Trial_Counter.TB1'</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-713" name="src/Model/experiments/confocal.py-713"></a>        <span class="n">trial_counter</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">trial_counter_path</span><span class="p">)</span>
<a id="src/Model/experiments/confocal.py-714" name="src/Model/experiments/confocal.py-714"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_1'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'load'</span><span class="p">:</span> <span class="n">trial_counter</span><span class="p">}})</span>
</span><a id="src/Model/experiments/confocal.py-715" name="src/Model/experiments/confocal.py-715"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">clock_functions</span><span class="p">(</span><span class="s1">'Frame'</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># reset ALL clocks to default settings</span>
</span><a id="src/Model/experiments/confocal.py-716" name="src/Model/experiments/confocal.py-716"></a>
<a id="src/Model/experiments/confocal.py-717" name="src/Model/experiments/confocal.py-717"></a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-718" name="src/Model/experiments/confocal.py-718"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-719" name="src/Model/experiments/confocal.py-719"></a><span class="sd">        Cleans up adwin after experiment</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-717" name="src/Model/experiments/confocal.py-717"></a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-718" name="src/Model/experiments/confocal.py-718"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-719" name="src/Model/experiments/confocal.py-719"></a><span class="sd">        Cleans up adwin after experiment</span>
<a id="src/Model/experiments/confocal.py-720" name="src/Model/experiments/confocal.py-720"></a><span class="sd">        '''</span>
<a id="src/Model/experiments/confocal.py-721" name="src/Model/experiments/confocal.py-721"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">stop_process</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-722" name="src/Model/experiments/confocal.py-722"></a><span class="hll">        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-723" name="src/Model/experiments/confocal.py-723"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">clear_process</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-724" name="src/Model/experiments/confocal.py-724"></a>
<a id="src/Model/experiments/confocal.py-725" name="src/Model/experiments/confocal.py-725"></a>    <span class="k">def</span> <span class="nf">_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-726" name="src/Model/experiments/confocal.py-726"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/Model/experiments/confocal.py-727" name="src/Model/experiments/confocal.py-727"></a><span class="sd">        This is the actual function that will be executed. It uses only information that is provided in the settings property</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-726" name="src/Model/experiments/confocal.py-726"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/Model/experiments/confocal.py-727" name="src/Model/experiments/confocal.py-727"></a><span class="sd">        This is the actual function that will be executed. It uses only information that is provided in the settings property</span>
<a id="src/Model/experiments/confocal.py-728" name="src/Model/experiments/confocal.py-728"></a><span class="sd">        will be overwritten in the __init__</span>
<a id="src/Model/experiments/confocal.py-729" name="src/Model/experiments/confocal.py-729"></a><span class="sd">        """</span>
<a id="src/Model/experiments/confocal.py-730" name="src/Model/experiments/confocal.py-730"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-731" name="src/Model/experiments/confocal.py-731"></a>
<a id="src/Model/experiments/confocal.py-732" name="src/Model/experiments/confocal.py-732"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'counts'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="src/Model/experiments/confocal.py-733" name="src/Model/experiments/confocal.py-733"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/confocal.py-734" name="src/Model/experiments/confocal.py-734"></a>        <span class="c1"># set to zero initially for smoother plotting</span>
<a id="src/Model/experiments/confocal.py-735" name="src/Model/experiments/confocal.py-735"></a><span class="hll">        <span class="n">count_rate_data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'graph_params'</span><span class="p">][</span><span class="s1">'length_data'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-736" name="src/Model/experiments/confocal.py-736"></a><span class="hll">        <span class="n">raw_counts_data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'graph_params'</span><span class="p">][</span><span class="s1">'length_data'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-737" name="src/Model/experiments/confocal.py-737"></a>
<a id="src/Model/experiments/confocal.py-738" name="src/Model/experiments/confocal.py-738"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">]</span>
<a id="src/Model/experiments/confocal.py-739" name="src/Model/experiments/confocal.py-739"></a>        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">]</span>
<a id="src/Model/experiments/confocal.py-740" name="src/Model/experiments/confocal.py-740"></a><span class="hll">        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'point'</span><span class="p">][</span><span class="s1">'z'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-741" name="src/Model/experiments/confocal.py-741"></a>
<a id="src/Model/experiments/confocal.py-742" name="src/Model/experiments/confocal.py-742"></a><span class="hll">        <span class="n">num_cycles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'num_cycles'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-743" name="src/Model/experiments/confocal.py-743"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">set_int_var</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">num_cycles</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-744" name="src/Model/experiments/confocal.py-744"></a>        <span class="c1">#set adwin delay which determines the counting time</span>
<a id="src/Model/experiments/confocal.py-745" name="src/Model/experiments/confocal.py-745"></a>        <span class="n">adwin_delay</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'count_time'</span><span class="p">]</span><span class="o">*</span><span class="mf">1e6</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">))</span>
<a id="src/Model/experiments/confocal.py-746" name="src/Model/experiments/confocal.py-746"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_1'</span><span class="p">:{</span><span class="s1">'delay'</span><span class="p">:</span><span class="n">adwin_delay</span><span class="p">,</span><span class="s1">'running'</span><span class="p">:</span><span class="kc">True</span><span class="p">}})</span>
<a id="src/Model/experiments/confocal.py-747" name="src/Model/experiments/confocal.py-747"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">nd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x_pos'</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s1">'y_pos'</span><span class="p">:</span><span class="n">y</span><span class="p">,</span><span class="s1">'z_pos'</span><span class="p">:</span><span class="n">z</span><span class="p">})</span>
</span><a id="src/Model/experiments/confocal.py-748" name="src/Model/experiments/confocal.py-748"></a>        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1">#time for stage to move and adwin process to initilize</span>
<a id="src/Model/experiments/confocal.py-749" name="src/Model/experiments/confocal.py-749"></a>
<a id="src/Model/experiments/confocal.py-750" name="src/Model/experiments/confocal.py-750"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'continuous'</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-751" name="src/Model/experiments/confocal.py-751"></a><span class="hll">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'plot_avg'</span><span class="p">]:</span>
</span><a id="src/Model/experiments/confocal.py-752" name="src/Model/experiments/confocal.py-752"></a><span class="hll">                <span class="n">counting_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'count_time'</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'num_cycles'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-753" name="src/Model/experiments/confocal.py-753"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-754" name="src/Model/experiments/confocal.py-754"></a><span class="hll">                <span class="n">counting_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'count_time'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-755" name="src/Model/experiments/confocal.py-755"></a><span class="hll">            <span class="n">sleep</span><span class="p">((</span><span class="n">counting_time</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>    <span class="c1">#sleep for 1.5 times the count time to ensure enough time for counts. Does not affect counting window</span>
</span><a id="src/Model/experiments/confocal.py-756" name="src/Model/experiments/confocal.py-756"></a>
<a id="src/Model/experiments/confocal.py-757" name="src/Model/experiments/confocal.py-757"></a><span class="hll">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'plot_avg'</span><span class="p">]:</span>
</span><a id="src/Model/experiments/confocal.py-758" name="src/Model/experiments/confocal.py-758"></a><span class="hll">                <span class="n">raw_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'int_var'</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'num_cycles'</span><span class="p">]</span>  <span class="c1"># Par_5 stores the total counts over 'num_cycles'</span>
</span><a id="src/Model/experiments/confocal.py-759" name="src/Model/experiments/confocal.py-759"></a><span class="hll">                <span class="n">counts</span> <span class="o">=</span> <span class="n">raw_counts</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'count_time'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-760" name="src/Model/experiments/confocal.py-760"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-761" name="src/Model/experiments/confocal.py-761"></a><span class="hll">                <span class="n">raw_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'int_var'</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># read variable from adwin</span>
</span><a id="src/Model/experiments/confocal.py-762" name="src/Model/experiments/confocal.py-762"></a><span class="hll">                <span class="n">counts</span> <span class="o">=</span> <span class="n">raw_counts</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'count_time'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-763" name="src/Model/experiments/confocal.py-763"></a>
<a id="src/Model/experiments/confocal.py-764" name="src/Model/experiments/confocal.py-764"></a><span class="hll">            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>        <span class="c1">#just want the single value to be viewable so will plot a straight line (with 2 points) of its value</span>
</span><a id="src/Model/experiments/confocal.py-765" name="src/Model/experiments/confocal.py-765"></a><span class="hll">                <span class="n">raw_counts_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-766" name="src/Model/experiments/confocal.py-766"></a><span class="hll">                <span class="n">count_rate_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-767" name="src/Model/experiments/confocal.py-767"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_counts_data</span>
</span><a id="src/Model/experiments/confocal.py-768" name="src/Model/experiments/confocal.py-768"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_rate_data</span>
</span><a id="src/Model/experiments/confocal.py-769" name="src/Model/experiments/confocal.py-769"></a>
<a id="src/Model/experiments/confocal.py-770" name="src/Model/experiments/confocal.py-770"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'continuous'</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-771" name="src/Model/experiments/confocal.py-771"></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abort</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>     <span class="c1">#self._abort is defined in experiment.py and is true false while running and set false when stop button is hit</span>
<a id="src/Model/experiments/confocal.py-772" name="src/Model/experiments/confocal.py-772"></a><span class="hll">                <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'graph_params'</span><span class="p">][</span><span class="s1">'refresh_rate'</span><span class="p">])</span>    <span class="c1">#effictivly this sleep is the time interval the graph is refreshed (1/fps) counting window</span>
</span><a id="src/Model/experiments/confocal.py-773" name="src/Model/experiments/confocal.py-773"></a>
<a id="src/Model/experiments/confocal.py-774" name="src/Model/experiments/confocal.py-774"></a><span class="hll">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'plot_avg'</span><span class="p">]:</span>
</span><a id="src/Model/experiments/confocal.py-775" name="src/Model/experiments/confocal.py-775"></a><span class="hll">                    <span class="n">raw_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'int_var'</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'num_cycles'</span><span class="p">]</span> <span class="c1">#Par_5 stores the total counts over 'num_cycles'</span>
</span><a id="src/Model/experiments/confocal.py-776" name="src/Model/experiments/confocal.py-776"></a><span class="hll">                    <span class="n">counts</span> <span class="o">=</span> <span class="n">raw_counts</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'count_time'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-777" name="src/Model/experiments/confocal.py-777"></a>                <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-778" name="src/Model/experiments/confocal.py-778"></a><span class="hll">                    <span class="n">raw_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">read_probes</span><span class="p">(</span><span class="s1">'int_var'</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># read variable from adwin</span>
</span><a id="src/Model/experiments/confocal.py-779" name="src/Model/experiments/confocal.py-779"></a><span class="hll">                    <span class="n">counts</span> <span class="o">=</span> <span class="n">raw_counts</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'count_time'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-780" name="src/Model/experiments/confocal.py-780"></a>
<a id="src/Model/experiments/confocal.py-781" name="src/Model/experiments/confocal.py-781"></a>                <span class="c1">#append most recent value and remove oldest value</span>
<a id="src/Model/experiments/confocal.py-782" name="src/Model/experiments/confocal.py-782"></a><span class="hll">                <span class="n">raw_counts_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-783" name="src/Model/experiments/confocal.py-783"></a><span class="hll">                <span class="n">raw_counts_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-784" name="src/Model/experiments/confocal.py-784"></a><span class="hll">                <span class="n">count_rate_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-785" name="src/Model/experiments/confocal.py-785"></a><span class="hll">                <span class="n">count_rate_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><a id="src/Model/experiments/confocal.py-786" name="src/Model/experiments/confocal.py-786"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_counts_data</span>
</span><a id="src/Model/experiments/confocal.py-787" name="src/Model/experiments/confocal.py-787"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'counts'</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_rate_data</span>
</span><a id="src/Model/experiments/confocal.py-788" name="src/Model/experiments/confocal.py-788"></a>                <span class="c1">#print('Current count rate', self.data['counts'][-1])</span>
<a id="src/Model/experiments/confocal.py-789" name="src/Model/experiments/confocal.py-789"></a>
<a id="src/Model/experiments/confocal.py-790" name="src/Model/experiments/confocal.py-790"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="mi">50</span>   <span class="c1">#this is a infinite loop till stop button is hit; progress &amp; updateProgress is only here to update plot</span>
</span><a id="src/Model/experiments/confocal.py-791" name="src/Model/experiments/confocal.py-791"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="p">)</span>     <span class="c1">#calling updateProgress.emit triggers _plot</span>
<a id="src/Model/experiments/confocal.py-792" name="src/Model/experiments/confocal.py-792"></a>
<a id="src/Model/experiments/confocal.py-793" name="src/Model/experiments/confocal.py-793"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">adw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'process_1'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'running'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}})</span>
</span><a id="src/Model/experiments/confocal.py-794" name="src/Model/experiments/confocal.py-794"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</span><a id="src/Model/experiments/confocal.py-795" name="src/Model/experiments/confocal.py-795"></a>
<a id="src/Model/experiments/confocal.py-796" name="src/Model/experiments/confocal.py-796"></a>    <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-797" name="src/Model/experiments/confocal.py-797"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/Model/experiments/confocal.py-798" name="src/Model/experiments/confocal.py-798"></a><span class="sd">        This function plots the data. It is triggered when the updateProgress signal is emited and when after the _function is executed.</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-802" name="src/Model/experiments/confocal.py-802"></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="p">{}:</span>
<a id="src/Model/experiments/confocal.py-803" name="src/Model/experiments/confocal.py-803"></a>
<a id="src/Model/experiments/confocal.py-804" name="src/Model/experiments/confocal.py-804"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'graph_params'</span><span class="p">][</span><span class="s1">'plot_raw_counts'</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-805" name="src/Model/experiments/confocal.py-805"></a>                <span class="c1"># sometimes counts are so low it rounds to zero. Plotting raw counts can be useful</span>
<a id="src/Model/experiments/confocal.py-806" name="src/Model/experiments/confocal.py-806"></a><span class="hll">                <span class="n">plot_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'raw_counts'</span><span class="p">]</span>
</span><a id="src/Model/experiments/confocal.py-807" name="src/Model/experiments/confocal.py-807"></a><span class="hll">                <span class="n">axes_label</span> <span class="o">=</span> <span class="s1">'counts'</span>
</span><a id="src/Model/experiments/confocal.py-808" name="src/Model/experiments/confocal.py-808"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/confocal.py-809" name="src/Model/experiments/confocal.py-809"></a>                <span class="n">plot_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'counts'</span><span class="p">]</span>
<a id="src/Model/experiments/confocal.py-810" name="src/Model/experiments/confocal.py-810"></a>                <span class="n">axes_label</span> <span class="o">=</span> <span class="s1">'counts/sec'</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/confocal.py-844" name="src/Model/experiments/confocal.py-844"></a>
<a id="src/Model/experiments/confocal.py-845" name="src/Model/experiments/confocal.py-845"></a>        <span class="k">return</span> <span class="n">axes_list</span>
<a id="src/Model/experiments/confocal.py-846" name="src/Model/experiments/confocal.py-846"></a>
<a id="src/Model/experiments/confocal.py-847" name="src/Model/experiments/confocal.py-847"></a>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">):</span>
<a id="src/Model/experiments/confocal.py-848" name="src/Model/experiments/confocal.py-848"></a><span class="hll">        <span class="n">Experiment</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">)</span>
</span></pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/Model/experiments/example_experiment.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/example_experiment.py-64" name="src/Model/experiments/example_experiment.py-64"></a><span class="sd">            figure_list = [&lt;bottom graph object&gt;,&lt;top graph object&gt;]</span>
<a id="src/Model/experiments/example_experiment.py-65" name="src/Model/experiments/example_experiment.py-65"></a><span class="sd">        Returns:</span>
<a id="src/Model/experiments/example_experiment.py-66" name="src/Model/experiments/example_experiment.py-66"></a><span class="sd">            axes_list = [&lt;bottom graph left plot&gt;,&lt;bottom graph right plot&gt;,&lt;top graph plot&gt;]</span>
<a id="src/Model/experiments/example_experiment.py-67" name="src/Model/experiments/example_experiment.py-67"></a><span class="sd">        """</span>
<a id="src/Model/experiments/example_experiment.py-68" name="src/Model/experiments/example_experiment.py-68"></a><span class="hll">        <span class="n">axes_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/example_experiment.py-69" name="src/Model/experiments/example_experiment.py-69"></a><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_refresh</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><a id="src/Model/experiments/example_experiment.py-70" name="src/Model/experiments/example_experiment.py-70"></a><span class="hll">            <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">figure_list</span><span class="p">:</span>
</span><a id="src/Model/experiments/example_experiment.py-71" name="src/Model/experiments/example_experiment.py-71"></a><span class="hll">                <span class="n">graph</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><a id="src/Model/experiments/example_experiment.py-72" name="src/Model/experiments/example_experiment.py-72"></a><span class="hll">            <span class="n">axes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">addPlot</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><a id="src/Model/experiments/example_experiment.py-73" name="src/Model/experiments/example_experiment.py-73"></a><span class="hll">            <span class="n">axes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">addPlot</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><a id="src/Model/experiments/example_experiment.py-74" name="src/Model/experiments/example_experiment.py-74"></a><span class="hll">            <span class="n">axes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">addPlot</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><a id="src/Model/experiments/example_experiment.py-75" name="src/Model/experiments/example_experiment.py-75"></a>
<a id="src/Model/experiments/example_experiment.py-76" name="src/Model/experiments/example_experiment.py-76"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/example_experiment.py-77" name="src/Model/experiments/example_experiment.py-77"></a><span class="hll">            <span class="n">axes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><a id="src/Model/experiments/example_experiment.py-78" name="src/Model/experiments/example_experiment.py-78"></a><span class="hll">            <span class="n">axes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><a id="src/Model/experiments/example_experiment.py-79" name="src/Model/experiments/example_experiment.py-79"></a><span class="hll">            <span class="n">axes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><a id="src/Model/experiments/example_experiment.py-80" name="src/Model/experiments/example_experiment.py-80"></a>
<a id="src/Model/experiments/example_experiment.py-81" name="src/Model/experiments/example_experiment.py-81"></a><span class="hll">        <span class="k">return</span> <span class="n">axes_list</span>
</span><a id="src/Model/experiments/example_experiment.py-82" name="src/Model/experiments/example_experiment.py-82"></a>
<a id="src/Model/experiments/example_experiment.py-83" name="src/Model/experiments/example_experiment.py-83"></a>    <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">):</span>
<a id="src/Model/experiments/example_experiment.py-84" name="src/Model/experiments/example_experiment.py-84"></a><span class="hll">        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</span><a id="src/Model/experiments/example_experiment.py-85" name="src/Model/experiments/example_experiment.py-85"></a><span class="hll">        <span class="n">axes_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>     <span class="c1">#plots x on top plot</span>
</span><a id="src/Model/experiments/example_experiment.py-86" name="src/Model/experiments/example_experiment.py-86"></a><span class="hll">        <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1">#plots x**2 on bottom left plot</span>
</span><a id="src/Model/experiments/example_experiment.py-87" name="src/Model/experiments/example_experiment.py-87"></a><span class="hll">        <span class="n">axes_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>  <span class="c1">#plots x**3 on bottom right plot</span>
</span><a id="src/Model/experiments/example_experiment.py-88" name="src/Model/experiments/example_experiment.py-88"></a>
<a id="src/Model/experiments/example_experiment.py-89" name="src/Model/experiments/example_experiment.py-89"></a><span class="k">class</span> <span class="nc">ExampleExperiment</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
<a id="src/Model/experiments/example_experiment.py-90" name="src/Model/experiments/example_experiment.py-90"></a><span class="w">    </span><span class="sd">"""</span>
<a id="src/Model/experiments/example_experiment.py-91" name="src/Model/experiments/example_experiment.py-91"></a><span class="sd">Example Experiment that has all different types of parameters (integer, str, fload, point, list of parameters). Plots 1D and 2D data.</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/example_experiment.py-123" name="src/Model/experiments/example_experiment.py-123"></a>
<a id="src/Model/experiments/example_experiment.py-124" name="src/Model/experiments/example_experiment.py-124"></a>        <span class="c1"># some generic function</span>
<a id="src/Model/experiments/example_experiment.py-125" name="src/Model/experiments/example_experiment.py-125"></a>        <span class="kn">import</span> <span class="nn">time</span>
<a id="src/Model/experiments/example_experiment.py-126" name="src/Model/experiments/example_experiment.py-126"></a>        <span class="kn">import</span> <span class="nn">random</span>
<a id="src/Model/experiments/example_experiment.py-127" name="src/Model/experiments/example_experiment.py-127"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/example_experiment.py-128" name="src/Model/experiments/example_experiment.py-128"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'image_data'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/Model/experiments/example_experiment.py-129" name="src/Model/experiments/example_experiment.py-129"></a>        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span>
<a id="src/Model/experiments/example_experiment.py-130" name="src/Model/experiments/example_experiment.py-130"></a>        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
<a id="src/Model/experiments/example_experiment.py-131" name="src/Model/experiments/example_experiment.py-131"></a>        <span class="n">wait_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'wait_time'</span><span class="p">]</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/example_experiment.py-135" name="src/Model/experiments/example_experiment.py-135"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
<a id="src/Model/experiments/example_experiment.py-136" name="src/Model/experiments/example_experiment.py-136"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
<a id="src/Model/experiments/example_experiment.py-137" name="src/Model/experiments/example_experiment.py-137"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'</span><span class="si">{:s}</span><span class="s1"> count </span><span class="si">{:02d}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<a id="src/Model/experiments/example_experiment.py-138" name="src/Model/experiments/example_experiment.py-138"></a>            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
<a id="src/Model/experiments/example_experiment.py-139" name="src/Model/experiments/example_experiment.py-139"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><a id="src/Model/experiments/example_experiment.py-140" name="src/Model/experiments/example_experiment.py-140"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="mf">100.</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">count</span>
<a id="src/Model/experiments/example_experiment.py-141" name="src/Model/experiments/example_experiment.py-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="p">)</span>
<a id="src/Model/experiments/example_experiment.py-142" name="src/Model/experiments/example_experiment.py-142"></a>
<a id="src/Model/experiments/example_experiment.py-143" name="src/Model/experiments/example_experiment.py-143"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'random_data'</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>
</span><a id="src/Model/experiments/example_experiment.py-144" name="src/Model/experiments/example_experiment.py-144"></a>
<a id="src/Model/experiments/example_experiment.py-145" name="src/Model/experiments/example_experiment.py-145"></a>        <span class="c1"># create image data</span>
<a id="src/Model/experiments/example_experiment.py-146" name="src/Model/experiments/example_experiment.py-146"></a><span class="hll">        <span class="n">Nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">])))</span>
</span><a id="src/Model/experiments/example_experiment.py-147" name="src/Model/experiments/example_experiment.py-147"></a><span class="hll">        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">Nx</span> <span class="o">**</span> <span class="mi">2</span><span class="p">])</span>
</span><a id="src/Model/experiments/example_experiment.py-148" name="src/Model/experiments/example_experiment.py-148"></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Nx</span><span class="p">))</span>
<a id="src/Model/experiments/example_experiment.py-149" name="src/Model/experiments/example_experiment.py-149"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'image_data'</span><span class="p">:</span> <span class="n">img</span><span class="p">})</span>
</span><a id="src/Model/experiments/example_experiment.py-150" name="src/Model/experiments/example_experiment.py-150"></a>
<a id="src/Model/experiments/example_experiment.py-151" name="src/Model/experiments/example_experiment.py-151"></a>
<a id="src/Model/experiments/example_experiment.py-152" name="src/Model/experiments/example_experiment.py-152"></a>    <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="src/Model/experiments/example_experiment.py-153" name="src/Model/experiments/example_experiment.py-153"></a><span class="w">        </span><span class="sd">"""</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/example_experiment.py-164" name="src/Model/experiments/example_experiment.py-164"></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
<a id="src/Model/experiments/example_experiment.py-165" name="src/Model/experiments/example_experiment.py-165"></a>
<a id="src/Model/experiments/example_experiment.py-166" name="src/Model/experiments/example_experiment.py-166"></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="p">{}:</span>
<a id="src/Model/experiments/example_experiment.py-167" name="src/Model/experiments/example_experiment.py-167"></a>            <span class="k">if</span> <span class="n">plot_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'main'</span><span class="p">,</span> <span class="s1">'two'</span><span class="p">):</span>
<a id="src/Model/experiments/example_experiment.py-168" name="src/Model/experiments/example_experiment.py-168"></a><span class="hll">                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/Model/experiments/example_experiment.py-169" name="src/Model/experiments/example_experiment.py-169"></a><span class="hll">                    <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">])</span>
</span><a id="src/Model/experiments/example_experiment.py-170" name="src/Model/experiments/example_experiment.py-170"></a>            <span class="k">if</span> <span class="n">plot_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'aux'</span><span class="p">,</span> <span class="s1">'two'</span><span class="p">,</span> <span class="s1">'2D'</span><span class="p">):</span>
<a id="src/Model/experiments/example_experiment.py-171" name="src/Model/experiments/example_experiment.py-171"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/Model/experiments/example_experiment.py-172" name="src/Model/experiments/example_experiment.py-172"></a>                    <span class="n">axes_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">])</span>
<a id="src/Model/experiments/example_experiment.py-173" name="src/Model/experiments/example_experiment.py-173"></a>            <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">'2D'</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/example_experiment.py-202" name="src/Model/experiments/example_experiment.py-202"></a>                        <span class="n">create_img</span><span class="p">()</span>
<a id="src/Model/experiments/example_experiment.py-203" name="src/Model/experiments/example_experiment.py-203"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/example_experiment.py-204" name="src/Model/experiments/example_experiment.py-204"></a>                        <span class="k">try</span><span class="p">:</span>
<a id="src/Model/experiments/example_experiment.py-205" name="src/Model/experiments/example_experiment.py-205"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">ex_image</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'image_data'</span><span class="p">],</span> <span class="n">autoLevels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="src/Model/experiments/example_experiment.py-206" name="src/Model/experiments/example_experiment.py-206"></a><span class="hll">                            <span class="bp">self</span><span class="o">.</span><span class="n">ex_image</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
</span><a id="src/Model/experiments/example_experiment.py-207" name="src/Model/experiments/example_experiment.py-207"></a><span class="hll">                            <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
</span><a id="src/Model/experiments/example_experiment.py-208" name="src/Model/experiments/example_experiment.py-208"></a>                        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
<a id="src/Model/experiments/example_experiment.py-209" name="src/Model/experiments/example_experiment.py-209"></a>                            <span class="c1"># sometimes when clicking other experiments ImageItem is deleted but _plot_refresh is false. This ensures the image can be replotted</span>
<a id="src/Model/experiments/example_experiment.py-210" name="src/Model/experiments/example_experiment.py-210"></a><span class="hll">                            <span class="n">create_img</span><span class="p">(</span><span class="n">add_colobar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/Model/experiments/example_experiment.py-211" name="src/Model/experiments/example_experiment.py-211"></a>
<a id="src/Model/experiments/example_experiment.py-212" name="src/Model/experiments/example_experiment.py-212"></a>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">):</span>
<a id="src/Model/experiments/example_experiment.py-213" name="src/Model/experiments/example_experiment.py-213"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/Model/experiments/example_experiment.py-214" name="src/Model/experiments/example_experiment.py-214"></a><span class="sd">        updates the data in already existing plots. the axes objects are provided in axes_list</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/example_experiment.py-220" name="src/Model/experiments/example_experiment.py-220"></a><span class="sd">        """</span>
<a id="src/Model/experiments/example_experiment.py-221" name="src/Model/experiments/example_experiment.py-221"></a>        <span class="n">plot_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'plot_style'</span><span class="p">]</span>
<a id="src/Model/experiments/example_experiment.py-222" name="src/Model/experiments/example_experiment.py-222"></a>        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">'2D'</span><span class="p">:</span>
<a id="src/Model/experiments/example_experiment.py-223" name="src/Model/experiments/example_experiment.py-223"></a>            <span class="c1"># now update the data</span>
<a id="src/Model/experiments/example_experiment.py-224" name="src/Model/experiments/example_experiment.py-224"></a><span class="hll">            <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'image_data'</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'image_data'</span><span class="p">])]</span>
</span><a id="src/Model/experiments/example_experiment.py-225" name="src/Model/experiments/example_experiment.py-225"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">ex_image</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'image_data'</span><span class="p">])</span>
</span><a id="src/Model/experiments/example_experiment.py-226" name="src/Model/experiments/example_experiment.py-226"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">ex_image</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
</span><a id="src/Model/experiments/example_experiment.py-227" name="src/Model/experiments/example_experiment.py-227"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
</span><a id="src/Model/experiments/example_experiment.py-228" name="src/Model/experiments/example_experiment.py-228"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/example_experiment.py-229" name="src/Model/experiments/example_experiment.py-229"></a>            <span class="c1"># fall back to default behaviour</span>
<a id="src/Model/experiments/example_experiment.py-230" name="src/Model/experiments/example_experiment.py-230"></a>            <span class="n">Experiment</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">)</span>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/Model/experiments/nv_loc_experiment.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/nv_loc_experiment.py-36" name="src/Model/experiments/nv_loc_experiment.py-36"></a><span class="sd">        This is the actual function that will be executed. It uses only information that is provided in the settings property</span>
<a id="src/Model/experiments/nv_loc_experiment.py-37" name="src/Model/experiments/nv_loc_experiment.py-37"></a><span class="sd">        will be overwritten in the __init__</span>
<a id="src/Model/experiments/nv_loc_experiment.py-38" name="src/Model/experiments/nv_loc_experiment.py-38"></a><span class="sd">        """</span>
<a id="src/Model/experiments/nv_loc_experiment.py-39" name="src/Model/experiments/nv_loc_experiment.py-39"></a>        <span class="c1">#print('NV Locations:',self.data['nv_locations'])</span>
<a id="src/Model/experiments/nv_loc_experiment.py-40" name="src/Model/experiments/nv_loc_experiment.py-40"></a><span class="hll">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'execution_time'</span><span class="p">])</span>
</span><a id="src/Model/experiments/nv_loc_experiment.py-41" name="src/Model/experiments/nv_loc_experiment.py-41"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s1">'All data:'</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span></pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/Model/experiments/select_points.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/select_points.py-51" name="src/Model/experiments/select_points.py-51"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/Model/experiments/select_points.py-52" name="src/Model/experiments/select_points.py-52"></a><span class="sd">        Waits until stopped to keep experiment live. Gui must handle calling of Toggle_NV function on mouse click.</span>
<a id="src/Model/experiments/select_points.py-53" name="src/Model/experiments/select_points.py-53"></a><span class="sd">        If using with an experiment iterator use skip button to stop and go to next experiment</span>
<a id="src/Model/experiments/select_points.py-54" name="src/Model/experiments/select_points.py-54"></a><span class="sd">        """</span>
<a id="src/Model/experiments/select_points.py-55" name="src/Model/experiments/select_points.py-55"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'!!! IF USING ExperimentIterator CLICK SelectPoints IN GUI EXPERIMENT TREE !!!'</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-56" name="src/Model/experiments/select_points.py-56"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'!!! IF NO IMAGE CLICK EXPERIMENT WITH IMAGE THEN SelectPoints !!!'</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-57" name="src/Model/experiments/select_points.py-57"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'!!! In ExperimentIterator use skip button to finish SelectPoints !!!'</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-58" name="src/Model/experiments/select_points.py-58"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'nv_locations'</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">'image_data'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'extent'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'pt_indices'</span><span class="p">:</span> <span class="p">[]}</span>
</span><a id="src/Model/experiments/select_points.py-59" name="src/Model/experiments/select_points.py-59"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="mi">50</span>
<a id="src/Model/experiments/select_points.py-60" name="src/Model/experiments/select_points.py-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">updateProgress</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="p">)</span>
<a id="src/Model/experiments/select_points.py-61" name="src/Model/experiments/select_points.py-61"></a>        <span class="c1"># keep experiment alive while NVs are selected</span>
<a id="src/Model/experiments/select_points.py-62" name="src/Model/experiments/select_points.py-62"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abort</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/select_points.py-84" name="src/Model/experiments/select_points.py-84"></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">pg</span><span class="o">.</span><span class="n">ImageItem</span><span class="p">):</span>
<a id="src/Model/experiments/select_points.py-85" name="src/Model/experiments/select_points.py-85"></a>                        <span class="n">image</span> <span class="o">=</span> <span class="n">item</span>
<a id="src/Model/experiments/select_points.py-86" name="src/Model/experiments/select_points.py-86"></a>                        <span class="n">image_data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">image</span>
<a id="src/Model/experiments/select_points.py-87" name="src/Model/experiments/select_points.py-87"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-88" name="src/Model/experiments/select_points.py-88"></a><span class="hll">                <span class="n">Experiment</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_list</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-89" name="src/Model/experiments/select_points.py-89"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="s1">'NO IMAGE FOUND'</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-90" name="src/Model/experiments/select_points.py-90"></a><span class="hll">                <span class="k">raise</span>
</span><a id="src/Model/experiments/select_points.py-91" name="src/Model/experiments/select_points.py-91"></a>
<a id="src/Model/experiments/select_points.py-92" name="src/Model/experiments/select_points.py-92"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'image_data'</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_data</span>
<a id="src/Model/experiments/select_points.py-93" name="src/Model/experiments/select_points.py-93"></a>
<a id="src/Model/experiments/select_points.py-94" name="src/Model/experiments/select_points.py-94"></a>            <span class="n">rect</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/select_points.py-149" name="src/Model/experiments/select_points.py-149"></a>                <span class="k">try</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-150" name="src/Model/experiments/select_points.py-150"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sp_image</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'image_data'</span><span class="p">],</span> <span class="n">autoLevels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="src/Model/experiments/select_points.py-151" name="src/Model/experiments/select_points.py-151"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sp_image</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
<a id="src/Model/experiments/select_points.py-152" name="src/Model/experiments/select_points.py-152"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
<a id="src/Model/experiments/select_points.py-153" name="src/Model/experiments/select_points.py-153"></a><span class="hll">                <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
</span><a id="src/Model/experiments/select_points.py-154" name="src/Model/experiments/select_points.py-154"></a>                    <span class="c1">#sometimes when clicking other experiments ImageItem is deleted but _plot_refresh is false. This ensures the image can be replotted</span>
<a id="src/Model/experiments/select_points.py-155" name="src/Model/experiments/select_points.py-155"></a><span class="hll">                    <span class="n">create_img</span><span class="p">(</span><span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-156" name="src/Model/experiments/select_points.py-156"></a>
<a id="src/Model/experiments/select_points.py-157" name="src/Model/experiments/select_points.py-157"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">axes_list</span><span class="p">)</span>
<a id="src/Model/experiments/select_points.py-158" name="src/Model/experiments/select_points.py-158"></a>
<a id="src/Model/experiments/select_points.py-159" name="src/Model/experiments/select_points.py-159"></a>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes_list</span><span class="p">):</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/select_points.py-175" name="src/Model/experiments/select_points.py-175"></a>        <span class="n">text_labels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/Model/experiments/select_points.py-176" name="src/Model/experiments/select_points.py-176"></a>
<a id="src/Model/experiments/select_points.py-177" name="src/Model/experiments/select_points.py-177"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-178" name="src/Model/experiments/select_points.py-178"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">400</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-179" name="src/Model/experiments/select_points.py-179"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="s2">"Cannot select more than 400 locations in image!"</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-180" name="src/Model/experiments/select_points.py-180"></a><span class="hll">                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Cannot select more than 400 locations in image!"</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-181" name="src/Model/experiments/select_points.py-181"></a>
<a id="src/Model/experiments/select_points.py-182" name="src/Model/experiments/select_points.py-182"></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">]):</span>
<a id="src/Model/experiments/select_points.py-183" name="src/Model/experiments/select_points.py-183"></a>                <span class="n">xmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'extent'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="src/Model/experiments/select_points.py-184" name="src/Model/experiments/select_points.py-184"></a>                <span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'extent'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/select_points.py-245" name="src/Model/experiments/select_points.py-245"></a>                <span class="n">d</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">distance_upper_bound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'patch_size'</span><span class="p">])</span>
<a id="src/Model/experiments/select_points.py-246" name="src/Model/experiments/select_points.py-246"></a>
<a id="src/Model/experiments/select_points.py-247" name="src/Model/experiments/select_points.py-247"></a>                <span class="c1"># removes NV if previously selected</span>
<a id="src/Model/experiments/select_points.py-248" name="src/Model/experiments/select_points.py-248"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
<a id="src/Model/experiments/select_points.py-249" name="src/Model/experiments/select_points.py-249"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Removed NV at (x,y) = (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"nv_locations"</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">) and index (i,j) = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"pt_indices"</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-250" name="src/Model/experiments/select_points.py-250"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-251" name="src/Model/experiments/select_points.py-251"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'pt_indices'</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-252" name="src/Model/experiments/select_points.py-252"></a>                <span class="c1"># adds NV if not previously selected</span>
<a id="src/Model/experiments/select_points.py-253" name="src/Model/experiments/select_points.py-253"></a>                <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-254" name="src/Model/experiments/select_points.py-254"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
<a id="src/Model/experiments/select_points.py-255" name="src/Model/experiments/select_points.py-255"></a>                    <span class="n">index</span> <span class="o">=</span> <span class="n">index_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/select_points.py-257" name="src/Model/experiments/select_points.py-257"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Selected NV at (x,y) = (</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">) and index (i,j) = </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<a id="src/Model/experiments/select_points.py-258" name="src/Model/experiments/select_points.py-258"></a>
<a id="src/Model/experiments/select_points.py-259" name="src/Model/experiments/select_points.py-259"></a>                <span class="c1"># randomize</span>
<a id="src/Model/experiments/select_points.py-260" name="src/Model/experiments/select_points.py-260"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'randomize'</span><span class="p">]:</span>
<a id="src/Model/experiments/select_points.py-261" name="src/Model/experiments/select_points.py-261"></a><span class="hll">                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'warning! randomize not avalable when manually selecting points'</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-262" name="src/Model/experiments/select_points.py-262"></a>
<a id="src/Model/experiments/select_points.py-263" name="src/Model/experiments/select_points.py-263"></a>            <span class="c1">#if type is not free we calculate the total points of locations from the first selected points</span>
<a id="src/Model/experiments/select_points.py-264" name="src/Model/experiments/select_points.py-264"></a>            <span class="c1">#not adding point indexing for specific geometries as idk how they are to be used in future -- Dylan Staples</span>
<a id="src/Model/experiments/select_points.py-265" name="src/Model/experiments/select_points.py-265"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'square'</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/Model/experiments/select_points.py-263" name="src/Model/experiments/select_points.py-263"></a>            <span class="c1">#if type is not free we calculate the total points of locations from the first selected points</span>
<a id="src/Model/experiments/select_points.py-264" name="src/Model/experiments/select_points.py-264"></a>            <span class="c1">#not adding point indexing for specific geometries as idk how they are to be used in future -- Dylan Staples</span>
<a id="src/Model/experiments/select_points.py-265" name="src/Model/experiments/select_points.py-265"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'square'</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-266" name="src/Model/experiments/select_points.py-266"></a>                <span class="c1"># here we create a rectangular grid, where pts a and be define the top left and bottom right corner of the rectangle</span>
<a id="src/Model/experiments/select_points.py-267" name="src/Model/experiments/select_points.py-267"></a><span class="hll">                <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'Nx'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'Ny'</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-268" name="src/Model/experiments/select_points.py-268"></a><span class="hll">                <span class="n">pta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-269" name="src/Model/experiments/select_points.py-269"></a><span class="hll">                <span class="n">ptb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-270" name="src/Model/experiments/select_points.py-270"></a><span class="hll">                <span class="n">tmp</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="n">pta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">ptb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pta</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">pta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">ptb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pta</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">Ny</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">)])</span>
</span><a id="src/Model/experiments/select_points.py-271" name="src/Model/experiments/select_points.py-271"></a><span class="hll">                <span class="n">nv_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="p">(</span><span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><a id="src/Model/experiments/select_points.py-272" name="src/Model/experiments/select_points.py-272"></a>
<a id="src/Model/experiments/select_points.py-273" name="src/Model/experiments/select_points.py-273"></a>                <span class="c1"># randomize</span>
<a id="src/Model/experiments/select_points.py-274" name="src/Model/experiments/select_points.py-274"></a><span class="hll">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'randomize'</span><span class="p">]:</span>
</span><a id="src/Model/experiments/select_points.py-275" name="src/Model/experiments/select_points.py-275"></a><span class="hll">                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">nv_pts</span><span class="p">)</span>  <span class="c1"># shuffles in place</span>
</span><a id="src/Model/experiments/select_points.py-276" name="src/Model/experiments/select_points.py-276"></a>
<a id="src/Model/experiments/select_points.py-277" name="src/Model/experiments/select_points.py-277"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">]</span> <span class="o">=</span> <span class="n">nv_pts</span>
</span><a id="src/Model/experiments/select_points.py-278" name="src/Model/experiments/select_points.py-278"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><a id="src/Model/experiments/select_points.py-279" name="src/Model/experiments/select_points.py-279"></a>
<a id="src/Model/experiments/select_points.py-280" name="src/Model/experiments/select_points.py-280"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'line'</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-281" name="src/Model/experiments/select_points.py-281"></a>                <span class="c1"># here we create a straight line between points a and b</span>
<a id="src/Model/experiments/select_points.py-282" name="src/Model/experiments/select_points.py-282"></a><span class="hll">                <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'Nx'</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-283" name="src/Model/experiments/select_points.py-283"></a><span class="hll">                <span class="n">pta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-284" name="src/Model/experiments/select_points.py-284"></a><span class="hll">                <span class="n">ptb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-285" name="src/Model/experiments/select_points.py-285"></a><span class="hll">                <span class="n">nv_pts</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">ptb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pta</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">pta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">ptb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pta</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
</span><a id="src/Model/experiments/select_points.py-286" name="src/Model/experiments/select_points.py-286"></a>
<a id="src/Model/experiments/select_points.py-287" name="src/Model/experiments/select_points.py-287"></a>                <span class="c1"># randomize</span>
<a id="src/Model/experiments/select_points.py-288" name="src/Model/experiments/select_points.py-288"></a><span class="hll">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'randomize'</span><span class="p">]:</span>
</span><a id="src/Model/experiments/select_points.py-289" name="src/Model/experiments/select_points.py-289"></a><span class="hll">                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">nv_pts</span><span class="p">)</span>  <span class="c1"># shuffles in place</span>
</span><a id="src/Model/experiments/select_points.py-290" name="src/Model/experiments/select_points.py-290"></a>
<a id="src/Model/experiments/select_points.py-291" name="src/Model/experiments/select_points.py-291"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">]</span> <span class="o">=</span> <span class="n">nv_pts</span>
</span><a id="src/Model/experiments/select_points.py-292" name="src/Model/experiments/select_points.py-292"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><a id="src/Model/experiments/select_points.py-293" name="src/Model/experiments/select_points.py-293"></a>
<a id="src/Model/experiments/select_points.py-294" name="src/Model/experiments/select_points.py-294"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'ring'</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-295" name="src/Model/experiments/select_points.py-295"></a>                <span class="c1"># here we create a circular grid, where pts a and be define the center and the outermost ring</span>
<a id="src/Model/experiments/select_points.py-296" name="src/Model/experiments/select_points.py-296"></a><span class="hll">                <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'Nx'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'Ny'</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-297" name="src/Model/experiments/select_points.py-297"></a><span class="hll">                <span class="n">pt_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># center</span>
</span><a id="src/Model/experiments/select_points.py-298" name="src/Model/experiments/select_points.py-298"></a><span class="hll">                <span class="n">pt_outer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># outermost ring</span>
</span><a id="src/Model/experiments/select_points.py-299" name="src/Model/experiments/select_points.py-299"></a>                <span class="c1"># radius of outermost ring:</span>
<a id="src/Model/experiments/select_points.py-300" name="src/Model/experiments/select_points.py-300"></a><span class="hll">                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pt_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_outer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">pt_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_outer</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-301" name="src/Model/experiments/select_points.py-301"></a>
<a id="src/Model/experiments/select_points.py-302" name="src/Model/experiments/select_points.py-302"></a>                <span class="c1"># angles</span>
<a id="src/Model/experiments/select_points.py-303" name="src/Model/experiments/select_points.py-303"></a><span class="hll">                <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">Nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-304" name="src/Model/experiments/select_points.py-304"></a>                <span class="c1"># create points on rings</span>
<a id="src/Model/experiments/select_points.py-305" name="src/Model/experiments/select_points.py-305"></a><span class="hll">                <span class="n">nv_pts</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/select_points.py-306" name="src/Model/experiments/select_points.py-306"></a><span class="hll">                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rmax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><a id="src/Model/experiments/select_points.py-307" name="src/Model/experiments/select_points.py-307"></a><span class="hll">                    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
</span><a id="src/Model/experiments/select_points.py-308" name="src/Model/experiments/select_points.py-308"></a><span class="hll">                        <span class="n">nv_pts</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="n">pt_center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="n">pt_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
</span><a id="src/Model/experiments/select_points.py-309" name="src/Model/experiments/select_points.py-309"></a>
<a id="src/Model/experiments/select_points.py-310" name="src/Model/experiments/select_points.py-310"></a>                <span class="c1"># randomize</span>
<a id="src/Model/experiments/select_points.py-311" name="src/Model/experiments/select_points.py-311"></a><span class="hll">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'randomize'</span><span class="p">]:</span>
</span><a id="src/Model/experiments/select_points.py-312" name="src/Model/experiments/select_points.py-312"></a><span class="hll">                    <span class="n">coarray</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nv_pts</span><span class="p">,</span> <span class="n">angles</span><span class="p">))</span>
</span><a id="src/Model/experiments/select_points.py-313" name="src/Model/experiments/select_points.py-313"></a><span class="hll">                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">coarray</span><span class="p">)</span>  <span class="c1"># shuffles in place</span>
</span><a id="src/Model/experiments/select_points.py-314" name="src/Model/experiments/select_points.py-314"></a><span class="hll">                    <span class="n">nv_pts</span><span class="p">,</span> <span class="n">angles</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">coarray</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-315" name="src/Model/experiments/select_points.py-315"></a>
<a id="src/Model/experiments/select_points.py-316" name="src/Model/experiments/select_points.py-316"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nv_pts</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-317" name="src/Model/experiments/select_points.py-317"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'angles'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span><span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><a id="src/Model/experiments/select_points.py-318" name="src/Model/experiments/select_points.py-318"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'ring_data'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt_center</span><span class="p">,</span> <span class="n">pt_outer</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-319" name="src/Model/experiments/select_points.py-319"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><a id="src/Model/experiments/select_points.py-320" name="src/Model/experiments/select_points.py-320"></a>
<a id="src/Model/experiments/select_points.py-321" name="src/Model/experiments/select_points.py-321"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'arc'</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-322" name="src/Model/experiments/select_points.py-322"></a>                <span class="c1"># here we create a circular grid, where pts a and be define the center and the outermost ring</span>
<a id="src/Model/experiments/select_points.py-323" name="src/Model/experiments/select_points.py-323"></a><span class="hll">                <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'Nx'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'Ny'</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-324" name="src/Model/experiments/select_points.py-324"></a><span class="hll">                <span class="n">pt_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># center</span>
</span><a id="src/Model/experiments/select_points.py-325" name="src/Model/experiments/select_points.py-325"></a><span class="hll">                <span class="n">pt_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># arc point one (radius)</span>
</span><a id="src/Model/experiments/select_points.py-326" name="src/Model/experiments/select_points.py-326"></a><span class="hll">                <span class="n">pt_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># arc point two (direction)</span>
</span><a id="src/Model/experiments/select_points.py-327" name="src/Model/experiments/select_points.py-327"></a><span class="hll">                <span class="n">pt_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># arc point three (angle)</span>
</span><a id="src/Model/experiments/select_points.py-328" name="src/Model/experiments/select_points.py-328"></a>
<a id="src/Model/experiments/select_points.py-329" name="src/Model/experiments/select_points.py-329"></a>                <span class="c1"># radius of outermost ring:</span>
<a id="src/Model/experiments/select_points.py-330" name="src/Model/experiments/select_points.py-330"></a><span class="hll">                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pt_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_start</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">pt_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-331" name="src/Model/experiments/select_points.py-331"></a><span class="hll">                <span class="n">angle_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="n">pt_start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">pt_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><a id="src/Model/experiments/select_points.py-332" name="src/Model/experiments/select_points.py-332"></a>                <span class="c1"># arctan always returns between -pi/2 and pi/2, so adjust to allow full range of angles</span>
<a id="src/Model/experiments/select_points.py-333" name="src/Model/experiments/select_points.py-333"></a><span class="hll">                <span class="k">if</span> <span class="p">((</span><span class="n">pt_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><a id="src/Model/experiments/select_points.py-334" name="src/Model/experiments/select_points.py-334"></a><span class="hll">                    <span class="n">angle_start</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><a id="src/Model/experiments/select_points.py-335" name="src/Model/experiments/select_points.py-335"></a>
<a id="src/Model/experiments/select_points.py-336" name="src/Model/experiments/select_points.py-336"></a><span class="hll">                <span class="n">angle_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="n">pt_end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">pt_end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><a id="src/Model/experiments/select_points.py-337" name="src/Model/experiments/select_points.py-337"></a>                <span class="c1"># arctan always returns between -pi/2 and pi/2, so adjust to allow full range of angles</span>
<a id="src/Model/experiments/select_points.py-338" name="src/Model/experiments/select_points.py-338"></a><span class="hll">                <span class="k">if</span> <span class="p">((</span><span class="n">pt_end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt_center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
</span><a id="src/Model/experiments/select_points.py-339" name="src/Model/experiments/select_points.py-339"></a><span class="hll">                    <span class="n">angle_end</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><a id="src/Model/experiments/select_points.py-340" name="src/Model/experiments/select_points.py-340"></a>
<a id="src/Model/experiments/select_points.py-341" name="src/Model/experiments/select_points.py-341"></a><span class="hll">                <span class="k">if</span> <span class="n">pt_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pt_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><a id="src/Model/experiments/select_points.py-342" name="src/Model/experiments/select_points.py-342"></a>                    <span class="c1"># counter-clockwise: invert the order of the angles</span>
<a id="src/Model/experiments/select_points.py-343" name="src/Model/experiments/select_points.py-343"></a><span class="hll">                    <span class="n">angle_start</span><span class="p">,</span> <span class="n">angle_end</span> <span class="o">=</span> <span class="n">angle_end</span><span class="p">,</span> <span class="n">angle_start</span>
</span><a id="src/Model/experiments/select_points.py-344" name="src/Model/experiments/select_points.py-344"></a>
<a id="src/Model/experiments/select_points.py-345" name="src/Model/experiments/select_points.py-345"></a><span class="hll">                <span class="k">if</span> <span class="n">angle_start</span> <span class="o">&gt;</span> <span class="n">angle_end</span><span class="p">:</span>
</span><a id="src/Model/experiments/select_points.py-346" name="src/Model/experiments/select_points.py-346"></a>                    <span class="c1"># make sure that start is the smaller</span>
<a id="src/Model/experiments/select_points.py-347" name="src/Model/experiments/select_points.py-347"></a>                    <span class="c1"># (e.g. angle_start= 180 deg and angle_end =10, we want to got from 180 to 370 deg)</span>
<a id="src/Model/experiments/select_points.py-348" name="src/Model/experiments/select_points.py-348"></a><span class="hll">                    <span class="n">angle_end</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><a id="src/Model/experiments/select_points.py-349" name="src/Model/experiments/select_points.py-349"></a>
<a id="src/Model/experiments/select_points.py-350" name="src/Model/experiments/select_points.py-350"></a>                <span class="c1"># create points on arcs</span>
<a id="src/Model/experiments/select_points.py-351" name="src/Model/experiments/select_points.py-351"></a><span class="hll">                <span class="n">nv_pts</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/Model/experiments/select_points.py-352" name="src/Model/experiments/select_points.py-352"></a><span class="hll">                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rmax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><a id="src/Model/experiments/select_points.py-353" name="src/Model/experiments/select_points.py-353"></a><span class="hll">                    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">angle_start</span><span class="p">,</span> <span class="n">angle_end</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><a id="src/Model/experiments/select_points.py-354" name="src/Model/experiments/select_points.py-354"></a><span class="hll">                        <span class="n">nv_pts</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">pt_center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">pt_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
</span><a id="src/Model/experiments/select_points.py-355" name="src/Model/experiments/select_points.py-355"></a>
<a id="src/Model/experiments/select_points.py-356" name="src/Model/experiments/select_points.py-356"></a>                <span class="c1"># randomize</span>
<a id="src/Model/experiments/select_points.py-357" name="src/Model/experiments/select_points.py-357"></a><span class="hll">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'randomize'</span><span class="p">]:</span>
</span><a id="src/Model/experiments/select_points.py-358" name="src/Model/experiments/select_points.py-358"></a><span class="hll">                    <span class="n">coarray</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nv_pts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">angle_start</span><span class="p">,</span> <span class="n">angle_end</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>
</span><a id="src/Model/experiments/select_points.py-359" name="src/Model/experiments/select_points.py-359"></a><span class="hll">                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">coarray</span><span class="p">)</span>  <span class="c1"># shuffles in place</span>
</span><a id="src/Model/experiments/select_points.py-360" name="src/Model/experiments/select_points.py-360"></a><span class="hll">                    <span class="n">nv_pts</span><span class="p">,</span> <span class="n">angles</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">coarray</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-361" name="src/Model/experiments/select_points.py-361"></a>                <span class="k">else</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-362" name="src/Model/experiments/select_points.py-362"></a><span class="hll">                    <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">angle_start</span><span class="p">,</span> <span class="n">angle_end</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-363" name="src/Model/experiments/select_points.py-363"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'nv_locations'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nv_pts</span><span class="p">)</span>
</span><a id="src/Model/experiments/select_points.py-364" name="src/Model/experiments/select_points.py-364"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'arc_data'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt_center</span><span class="p">,</span> <span class="n">pt_start</span><span class="p">,</span> <span class="n">pt_end</span><span class="p">]</span>
</span><a id="src/Model/experiments/select_points.py-365" name="src/Model/experiments/select_points.py-365"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'angles'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><a id="src/Model/experiments/select_points.py-366" name="src/Model/experiments/select_points.py-366"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><a id="src/Model/experiments/select_points.py-367" name="src/Model/experiments/select_points.py-367"></a>
<a id="src/Model/experiments/select_points.py-368" name="src/Model/experiments/select_points.py-368"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
<a id="src/Model/experiments/select_points.py-369" name="src/Model/experiments/select_points.py-369"></a>    <span class="n">experiment</span><span class="p">,</span> <span class="n">failed</span><span class="p">,</span> <span class="n">instr</span> <span class="o">=</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">load_and_append</span><span class="p">({</span><span class="s1">'SelectPoints'</span><span class="p">:</span><span class="s1">'SelectPoints'</span><span class="p">})</span>
<a id="src/Model/experiments/select_points.py-370" name="src/Model/experiments/select_points.py-370"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/tools/hdf5 saving.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/hdf5 saving.py-1" name="src/tools/hdf5 saving.py-1"></a><span class="hll"><span class="kn">import</span> <span class="nn">h5py</span>
</span><a id="src/tools/hdf5 saving.py-2" name="src/tools/hdf5 saving.py-2"></a><span class="hll"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><a id="src/tools/hdf5 saving.py-3" name="src/tools/hdf5 saving.py-3"></a><span class="hll"><span class="kn">from</span> <span class="nn">src.core.helper_functions</span> <span class="kn">import</span> <span class="n">structure_data_for_hdf5</span>
</span><a id="src/tools/hdf5 saving.py-4" name="src/tools/hdf5 saving.py-4"></a>
<a id="src/tools/hdf5 saving.py-5" name="src/tools/hdf5 saving.py-5"></a>
<a id="src/tools/hdf5 saving.py-6" name="src/tools/hdf5 saving.py-6"></a><span class="hll"><span class="k">def</span> <span class="nf">guess_numpy_dtype</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><a id="src/tools/hdf5 saving.py-7" name="src/tools/hdf5 saving.py-7"></a><span class="hll">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><a id="src/tools/hdf5 saving.py-8" name="src/tools/hdf5 saving.py-8"></a><span class="hll">        <span class="k">return</span> <span class="s1">'f8'</span>
</span><a id="src/tools/hdf5 saving.py-9" name="src/tools/hdf5 saving.py-9"></a><span class="hll">    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span> <span class="c1">#need to put bool before int as True/False are technically 1/0</span>
</span><a id="src/tools/hdf5 saving.py-10" name="src/tools/hdf5 saving.py-10"></a><span class="hll">        <span class="k">return</span> <span class="s1">'bool'</span>
</span><a id="src/tools/hdf5 saving.py-11" name="src/tools/hdf5 saving.py-11"></a><span class="hll">    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><a id="src/tools/hdf5 saving.py-12" name="src/tools/hdf5 saving.py-12"></a><span class="hll">        <span class="k">return</span> <span class="s1">'i4'</span>
</span><a id="src/tools/hdf5 saving.py-13" name="src/tools/hdf5 saving.py-13"></a><span class="hll">    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><a id="src/tools/hdf5 saving.py-14" name="src/tools/hdf5 saving.py-14"></a><span class="hll">        <span class="k">return</span> <span class="s1">'S</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># +1 so empty string (S0) dont casue an error</span>
</span><a id="src/tools/hdf5 saving.py-15" name="src/tools/hdf5 saving.py-15"></a><span class="hll">    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><a id="src/tools/hdf5 saving.py-16" name="src/tools/hdf5 saving.py-16"></a><span class="hll">        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">dtype</span>
</span><a id="src/tools/hdf5 saving.py-17" name="src/tools/hdf5 saving.py-17"></a><span class="hll">    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><a id="src/tools/hdf5 saving.py-18" name="src/tools/hdf5 saving.py-18"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s1">'dictionary detected'</span><span class="p">)</span>
</span><a id="src/tools/hdf5 saving.py-19" name="src/tools/hdf5 saving.py-19"></a><span class="hll">        <span class="k">return</span> <span class="s1">'O'</span>
</span><a id="src/tools/hdf5 saving.py-20" name="src/tools/hdf5 saving.py-20"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/tools/hdf5 saving.py-21" name="src/tools/hdf5 saving.py-21"></a><span class="hll">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'hdf5 unsupported data type'</span><span class="p">)</span>
</span><a id="src/tools/hdf5 saving.py-22" name="src/tools/hdf5 saving.py-22"></a>
<a id="src/tools/hdf5 saving.py-23" name="src/tools/hdf5 saving.py-23"></a>
<a id="src/tools/hdf5 saving.py-24" name="src/tools/hdf5 saving.py-24"></a><span class="hll"><span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><a id="src/tools/hdf5 saving.py-25" name="src/tools/hdf5 saving.py-25"></a><span class="hll">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><a id="src/tools/hdf5 saving.py-26" name="src/tools/hdf5 saving.py-26"></a><span class="hll">        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span>
</span><a id="src/tools/hdf5 saving.py-27" name="src/tools/hdf5 saving.py-27"></a><span class="hll">    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><a id="src/tools/hdf5 saving.py-28" name="src/tools/hdf5 saving.py-28"></a><span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><a id="src/tools/hdf5 saving.py-29" name="src/tools/hdf5 saving.py-29"></a><span class="hll">            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</span><a id="src/tools/hdf5 saving.py-30" name="src/tools/hdf5 saving.py-30"></a><span class="hll">        <span class="k">except</span><span class="p">:</span>
</span><a id="src/tools/hdf5 saving.py-31" name="src/tools/hdf5 saving.py-31"></a><span class="hll">            <span class="k">return</span> <span class="p">()</span>  <span class="c1"># fallback if conversion fails</span>
</span><a id="src/tools/hdf5 saving.py-32" name="src/tools/hdf5 saving.py-32"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/tools/hdf5 saving.py-33" name="src/tools/hdf5 saving.py-33"></a><span class="hll">        <span class="k">return</span> <span class="p">()</span>  <span class="c1"># scalar or unknown type</span>
</span><a id="src/tools/hdf5 saving.py-34" name="src/tools/hdf5 saving.py-34"></a>
<a id="src/tools/hdf5 saving.py-35" name="src/tools/hdf5 saving.py-35"></a><span class="hll"><span class="n">name</span> <span class="o">=</span> <span class="s1">'random.hdf5'</span>
</span><a id="src/tools/hdf5 saving.py-36" name="src/tools/hdf5 saving.py-36"></a><span class="hll"><span class="n">file</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'D:\Data\dylan_staples\hdf5_save_testing</span><span class="se">\\</span><span class="s1">'</span>
</span><a id="src/tools/hdf5 saving.py-37" name="src/tools/hdf5 saving.py-37"></a>
<a id="src/tools/hdf5 saving.py-38" name="src/tools/hdf5 saving.py-38"></a><span class="hll"><span class="n">rand_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">16</span><span class="p">,))</span>
</span><a id="src/tools/hdf5 saving.py-39" name="src/tools/hdf5 saving.py-39"></a><span class="hll"><span class="n">img_1</span> <span class="o">=</span> <span class="n">rand_1</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span><a id="src/tools/hdf5 saving.py-40" name="src/tools/hdf5 saving.py-40"></a><span class="hll"><span class="n">rand_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">16</span><span class="p">,))</span>
</span><a id="src/tools/hdf5 saving.py-41" name="src/tools/hdf5 saving.py-41"></a><span class="hll"><span class="n">img_2</span> <span class="o">=</span> <span class="n">rand_1</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span><a id="src/tools/hdf5 saving.py-42" name="src/tools/hdf5 saving.py-42"></a><span class="hll"><span class="n">rand_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">64</span><span class="p">,))</span>
</span><a id="src/tools/hdf5 saving.py-43" name="src/tools/hdf5 saving.py-43"></a><span class="hll"><span class="n">img_3</span> <span class="o">=</span> <span class="n">rand_1</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</span><a id="src/tools/hdf5 saving.py-44" name="src/tools/hdf5 saving.py-44"></a><span class="hll"><span class="n">rand_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">64</span><span class="p">,))</span>
</span><a id="src/tools/hdf5 saving.py-45" name="src/tools/hdf5 saving.py-45"></a><span class="hll"><span class="n">img_4</span> <span class="o">=</span> <span class="n">rand_1</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</span><a id="src/tools/hdf5 saving.py-46" name="src/tools/hdf5 saving.py-46"></a>
<a id="src/tools/hdf5 saving.py-47" name="src/tools/hdf5 saving.py-47"></a><span class="hll"><span class="n">ex_data_1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'random_data'</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">rand_1</span><span class="p">),</span><span class="s1">'image_data'</span><span class="p">:</span> <span class="n">img_1</span><span class="p">}</span>
</span><a id="src/tools/hdf5 saving.py-48" name="src/tools/hdf5 saving.py-48"></a><span class="hll"><span class="n">ex_settings_1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'count'</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="s1">'wait_time'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'point'</span><span class="p">:{</span><span class="s1">'x'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">'y'</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="s1">'plot_style'</span><span class="p">:</span> <span class="s1">'2D'</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'tag'</span><span class="p">:</span> <span class="s1">'exampleexperiment_1'</span><span class="p">,</span> <span class="s1">'save'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><a id="src/tools/hdf5 saving.py-49" name="src/tools/hdf5 saving.py-49"></a>
<a id="src/tools/hdf5 saving.py-50" name="src/tools/hdf5 saving.py-50"></a><span class="hll"><span class="n">ex_data_2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'random_data'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">rand_2</span><span class="p">),</span><span class="s1">'image_data'</span><span class="p">:</span> <span class="n">img_2</span><span class="p">}</span>
</span><a id="src/tools/hdf5 saving.py-51" name="src/tools/hdf5 saving.py-51"></a><span class="hll"><span class="n">ex_settings_2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'count'</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="s1">'wait_time'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'point'</span><span class="p">:{</span><span class="s1">'x'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">'y'</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="s1">'plot_style'</span><span class="p">:</span> <span class="s1">'2D'</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'tag'</span><span class="p">:</span> <span class="s1">'exampleexperiment_2'</span><span class="p">,</span> <span class="s1">'save'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><a id="src/tools/hdf5 saving.py-52" name="src/tools/hdf5 saving.py-52"></a>
<a id="src/tools/hdf5 saving.py-53" name="src/tools/hdf5 saving.py-53"></a><span class="hll"><span class="n">ex_data_3</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'random_data'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">rand_3</span><span class="p">),</span><span class="s1">'image_data'</span><span class="p">:</span> <span class="n">img_3</span><span class="p">}</span>
</span><a id="src/tools/hdf5 saving.py-54" name="src/tools/hdf5 saving.py-54"></a><span class="hll"><span class="n">ex_settings_3</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'count'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="s1">'wait_time'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'point'</span><span class="p">:{</span><span class="s1">'x'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">'y'</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="s1">'plot_style'</span><span class="p">:</span> <span class="s1">'2D'</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'tag'</span><span class="p">:</span> <span class="s1">'exampleexperiment_3'</span><span class="p">,</span> <span class="s1">'save'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><a id="src/tools/hdf5 saving.py-55" name="src/tools/hdf5 saving.py-55"></a>
<a id="src/tools/hdf5 saving.py-56" name="src/tools/hdf5 saving.py-56"></a><span class="hll"><span class="n">ex_data_4</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'random_data'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">rand_4</span><span class="p">),</span><span class="s1">'image_data'</span><span class="p">:</span> <span class="n">img_4</span><span class="p">}</span>
</span><a id="src/tools/hdf5 saving.py-57" name="src/tools/hdf5 saving.py-57"></a><span class="hll"><span class="n">ex_settings_4</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'count'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="s1">'wait_time'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'point'</span><span class="p">:{</span><span class="s1">'x'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">'y'</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="s1">'plot_style'</span><span class="p">:</span> <span class="s1">'2D'</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'tag'</span><span class="p">:</span> <span class="s1">'exampleexperiment_4'</span><span class="p">,</span> <span class="s1">'save'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><a id="src/tools/hdf5 saving.py-58" name="src/tools/hdf5 saving.py-58"></a>
<a id="src/tools/hdf5 saving.py-59" name="src/tools/hdf5 saving.py-59"></a><span class="c1">#general way to save data from a dictionary</span>
<a id="src/tools/hdf5 saving.py-60" name="src/tools/hdf5 saving.py-60"></a><span class="sd">'''with h5py.File(file+name, 'w') as f:</span>
<a id="src/tools/hdf5 saving.py-61" name="src/tools/hdf5 saving.py-61"></a><span class="sd">    ex_1 = f.create_group('example_experiment_1')</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/hdf5 saving.py-73" name="src/tools/hdf5 saving.py-73"></a><span class="sd">        if value_type == 'bool':</span>
<a id="src/tools/hdf5 saving.py-74" name="src/tools/hdf5 saving.py-74"></a><span class="sd">            dset.attrs['description'] = "0 = False, 1 = True"'''</span>
<a id="src/tools/hdf5 saving.py-75" name="src/tools/hdf5 saving.py-75"></a>
<a id="src/tools/hdf5 saving.py-76" name="src/tools/hdf5 saving.py-76"></a><span class="c1">#saving with function 1 iterator deep</span>
<a id="src/tools/hdf5 saving.py-77" name="src/tools/hdf5 saving.py-77"></a><span class="hll"><span class="n">data_1_layer</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex_data_1</span><span class="p">,</span> <span class="n">ex_data_2</span><span class="p">]</span>
</span><a id="src/tools/hdf5 saving.py-78" name="src/tools/hdf5 saving.py-78"></a><span class="hll"><span class="n">settings_1_layer</span> <span class="o">=</span> <span class="p">[</span><span class="n">ex_settings_1</span><span class="p">,</span> <span class="n">ex_settings_2</span><span class="p">]</span>
</span><a id="src/tools/hdf5 saving.py-79" name="src/tools/hdf5 saving.py-79"></a>
<a id="src/tools/hdf5 saving.py-80" name="src/tools/hdf5 saving.py-80"></a><span class="hll"><span class="n">structure_data_for_hdf5</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="o">+</span><span class="s1">'func_test.hdf5'</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data_1_layer</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings_1_layer</span><span class="p">)</span>
</span><a id="src/tools/hdf5 saving.py-81" name="src/tools/hdf5 saving.py-81"></a>
<a id="src/tools/hdf5 saving.py-82" name="src/tools/hdf5 saving.py-82"></a><span class="hll"><span class="n">data_2_layer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ex_data_1</span><span class="p">,</span> <span class="n">ex_data_2</span><span class="p">],[</span><span class="n">ex_data_3</span><span class="p">,</span> <span class="n">ex_data_4</span><span class="p">]]</span>
</span><a id="src/tools/hdf5 saving.py-83" name="src/tools/hdf5 saving.py-83"></a><span class="hll"><span class="n">settings_2_layer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ex_settings_1</span><span class="p">,</span> <span class="n">ex_settings_2</span><span class="p">],[</span><span class="n">ex_settings_3</span><span class="p">,</span> <span class="n">ex_settings_4</span><span class="p">]]</span>
</span><a id="src/tools/hdf5 saving.py-84" name="src/tools/hdf5 saving.py-84"></a>
<a id="src/tools/hdf5 saving.py-85" name="src/tools/hdf5 saving.py-85"></a>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/tools/matlab save test again.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/matlab save test again.py-1" name="src/tools/matlab save test again.py-1"></a><span class="hll"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><a id="src/tools/matlab save test again.py-2" name="src/tools/matlab save test again.py-2"></a><span class="hll"><span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">savemat</span>
</span><a id="src/tools/matlab save test again.py-3" name="src/tools/matlab save test again.py-3"></a><span class="hll"><span class="kn">from</span> <span class="nn">src.core.helper_functions</span> <span class="kn">import</span> <span class="n">structure_data_for_matlab</span>
</span><a id="src/tools/matlab save test again.py-4" name="src/tools/matlab save test again.py-4"></a>
<a id="src/tools/matlab save test again.py-5" name="src/tools/matlab save test again.py-5"></a>
<a id="src/tools/matlab save test again.py-6" name="src/tools/matlab save test again.py-6"></a><span class="hll"><span class="n">filename</span> <span class="o">=</span> <span class="s1">'test_pyton_matlab_save.mat'</span>
</span><a id="src/tools/matlab save test again.py-7" name="src/tools/matlab save test again.py-7"></a><span class="hll"><span class="n">filelocation</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'C:\Users\Duttlab\Experiments\AQuISS_default_save_location\data</span><span class="se">\\</span><span class="s1">'</span> <span class="o">+</span> <span class="n">filename</span>
</span><a id="src/tools/matlab save test again.py-8" name="src/tools/matlab save test again.py-8"></a>
<a id="src/tools/matlab save test again.py-9" name="src/tools/matlab save test again.py-9"></a><span class="c1">#MAKE A ARRAY OF TUPLES !!! Structure is important</span>
<a id="src/tools/matlab save test again.py-10" name="src/tools/matlab save test again.py-10"></a><span class="hll"><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">'c'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'field1 has a really long name like over 31 characters'</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s1">'field2'</span><span class="p">,</span><span class="nb">object</span><span class="p">),(</span><span class="s1">'field3'</span><span class="p">,</span><span class="nb">bool</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-11" name="src/tools/matlab save test again.py-11"></a><span class="c1">#dicts save as 1x1 structs only!</span>
<a id="src/tools/matlab save test again.py-12" name="src/tools/matlab save test again.py-12"></a><span class="hll"><span class="n">dicts</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">'field1'</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">'field2'</span><span class="p">:</span><span class="s1">'one'</span><span class="p">},{</span><span class="s1">'field1'</span><span class="p">:</span><span class="mf">0.6</span><span class="p">,</span> <span class="s1">'field2'</span><span class="p">:</span><span class="s1">'two'</span><span class="p">},{</span><span class="s1">'field1'</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span><span class="s1">'field2'</span><span class="p">:</span><span class="s1">'three'</span><span class="p">}]</span>
</span><a id="src/tools/matlab save test again.py-13" name="src/tools/matlab save test again.py-13"></a>
<a id="src/tools/matlab save test again.py-14" name="src/tools/matlab save test again.py-14"></a><span class="hll"><span class="n">savemat</span><span class="p">(</span><span class="n">filelocation</span><span class="p">,</span> <span class="p">{</span><span class="s1">'dicts'</span><span class="p">:</span><span class="n">dicts</span><span class="p">,</span> <span class="s1">'tuple_array'</span><span class="p">:</span><span class="n">array</span><span class="p">})</span>
</span><a id="src/tools/matlab save test again.py-15" name="src/tools/matlab save test again.py-15"></a>
<a id="src/tools/matlab save test again.py-16" name="src/tools/matlab save test again.py-16"></a><span class="c1">#Stack overflow</span>
<a id="src/tools/matlab save test again.py-17" name="src/tools/matlab save test again.py-17"></a><span class="c1">#https://stackoverflow.com/questions/61542500/convert-multiple-python-dictionaries-to-matlab-structure-array-with-scipy-io-sav</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/matlab save test again.py-16" name="src/tools/matlab save test again.py-16"></a><span class="c1">#Stack overflow</span>
<a id="src/tools/matlab save test again.py-17" name="src/tools/matlab save test again.py-17"></a><span class="c1">#https://stackoverflow.com/questions/61542500/convert-multiple-python-dictionaries-to-matlab-structure-array-with-scipy-io-sav</span>
<a id="src/tools/matlab save test again.py-18" name="src/tools/matlab save test again.py-18"></a>
<a id="src/tools/matlab save test again.py-19" name="src/tools/matlab save test again.py-19"></a>
<a id="src/tools/matlab save test again.py-20" name="src/tools/matlab save test again.py-20"></a><span class="hll"><span class="n">ex_data_1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'random_data'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8486161845846729</span><span class="p">,</span> <span class="mf">0.3130657602243422</span><span class="p">,</span> <span class="mf">0.08220784202620657</span><span class="p">,</span> <span class="mf">0.7566239357229991</span><span class="p">,</span> <span class="mf">0.1566956979052001</span><span class="p">,</span> <span class="mf">0.7763677820680961</span><span class="p">,</span> <span class="mf">0.2822495884326256</span><span class="p">,</span> <span class="mf">0.07358801896021061</span><span class="p">,</span> <span class="mf">0.31546483249754065</span><span class="p">,</span> <span class="mf">0.09602905292983566</span><span class="p">,</span> <span class="mf">0.4708363377901481</span><span class="p">,</span> <span class="mf">0.7606587079228375</span><span class="p">,</span> <span class="mf">0.5911818105719729</span><span class="p">,</span> <span class="mf">0.19326385842390115</span><span class="p">,</span> <span class="mf">0.3569708749172422</span><span class="p">,</span> <span class="mf">0.06579632322101503</span><span class="p">,</span> <span class="mf">0.46004952942452815</span><span class="p">,</span> <span class="mf">0.11000005199119756</span><span class="p">,</span> <span class="mf">0.7802220450958514</span><span class="p">,</span> <span class="mf">0.9844957645722522</span><span class="p">,</span> <span class="mf">0.38069637275321766</span><span class="p">,</span> <span class="mf">0.3387975697602441</span><span class="p">,</span> <span class="mf">0.3255874429958806</span><span class="p">,</span> <span class="mf">0.7306502495430353</span><span class="p">,</span> <span class="mf">0.815690771973527</span><span class="p">,</span> <span class="mf">0.7686951861780189</span><span class="p">,</span> <span class="mf">0.292695932732541</span><span class="p">,</span> <span class="mf">0.9765989723690504</span><span class="p">,</span> <span class="mf">0.5490912704525974</span><span class="p">,</span> <span class="mf">0.3737056760497047</span><span class="p">,</span> <span class="mf">0.32364875029619977</span><span class="p">,</span> <span class="mf">0.9531146682182229</span><span class="p">,</span> <span class="mf">0.8746040122154536</span><span class="p">,</span> <span class="mf">0.25742952003459707</span><span class="p">,</span> <span class="mf">0.7057662535379657</span><span class="p">,</span> <span class="mf">0.2551614160706245</span><span class="p">,</span> <span class="mf">0.9150765684493058</span><span class="p">,</span> <span class="mf">0.7244515224434058</span><span class="p">,</span> <span class="mf">0.5233202410366595</span><span class="p">,</span> <span class="mf">0.17639138956682998</span><span class="p">,</span> <span class="mf">0.2516063889187946</span><span class="p">,</span> <span class="mf">0.19254417798646706</span><span class="p">,</span> <span class="mf">0.6320315640610223</span><span class="p">,</span> <span class="mf">0.35385166196057805</span><span class="p">,</span> <span class="mf">0.11544327009564181</span><span class="p">,</span> <span class="mf">0.030240801268020756</span><span class="p">,</span> <span class="mf">0.5848237412619066</span><span class="p">,</span> <span class="mf">0.9772667456935146</span><span class="p">,</span> <span class="mf">0.5487955220209074</span><span class="p">,</span> <span class="mf">0.38684281884035454</span><span class="p">,</span> <span class="mf">0.45543813051957194</span><span class="p">,</span> <span class="mf">0.5819199971261986</span><span class="p">,</span> <span class="mf">0.124871093746875</span><span class="p">,</span> <span class="mf">0.3149922940983798</span><span class="p">,</span> <span class="mf">0.8838274557598422</span><span class="p">,</span> <span class="mf">0.6387070545009906</span><span class="p">,</span> <span class="mf">0.2341066565754999</span><span class="p">,</span> <span class="mf">0.2370868196635849</span><span class="p">,</span> <span class="mf">0.3825689872722846</span><span class="p">,</span> <span class="mf">0.45526046737403136</span><span class="p">,</span> <span class="mf">0.15911380778058426</span><span class="p">,</span> <span class="mf">0.09479991503726515</span><span class="p">,</span> <span class="mf">0.05006934680646735</span><span class="p">,</span> <span class="mf">0.6726924720799815</span><span class="p">],</span>
</span><a id="src/tools/matlab save test again.py-21" name="src/tools/matlab save test again.py-21"></a>                <span class="s1">'image_data'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.84861618</span><span class="p">,</span> <span class="mf">0.31306576</span><span class="p">,</span> <span class="mf">0.08220784</span><span class="p">,</span> <span class="mf">0.75662394</span><span class="p">,</span> <span class="mf">0.1566957</span> <span class="p">,</span><span class="mf">0.77636778</span><span class="p">,</span> <span class="mf">0.28224959</span><span class="p">,</span> <span class="mf">0.07358802</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-22" name="src/tools/matlab save test again.py-22"></a>                                        <span class="p">[</span><span class="mf">0.31546483</span><span class="p">,</span> <span class="mf">0.09602905</span><span class="p">,</span> <span class="mf">0.47083634</span><span class="p">,</span> <span class="mf">0.76065871</span><span class="p">,</span> <span class="mf">0.59118181</span><span class="p">,</span><span class="mf">0.19326386</span><span class="p">,</span> <span class="mf">0.35697087</span><span class="p">,</span> <span class="mf">0.06579632</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-23" name="src/tools/matlab save test again.py-23"></a>                                        <span class="p">[</span><span class="mf">0.46004953</span><span class="p">,</span> <span class="mf">0.11000005</span><span class="p">,</span> <span class="mf">0.78022205</span><span class="p">,</span> <span class="mf">0.98449576</span><span class="p">,</span> <span class="mf">0.38069637</span><span class="p">,</span><span class="mf">0.33879757</span><span class="p">,</span> <span class="mf">0.32558744</span><span class="p">,</span> <span class="mf">0.73065025</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-24" name="src/tools/matlab save test again.py-24"></a>                                        <span class="p">[</span><span class="mf">0.81569077</span><span class="p">,</span> <span class="mf">0.76869519</span><span class="p">,</span> <span class="mf">0.29269593</span><span class="p">,</span> <span class="mf">0.97659897</span><span class="p">,</span> <span class="mf">0.54909127</span><span class="p">,</span><span class="mf">0.37370568</span><span class="p">,</span> <span class="mf">0.32364875</span><span class="p">,</span> <span class="mf">0.95311467</span><span class="p">],</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/matlab save test again.py-25" name="src/tools/matlab save test again.py-25"></a>                                        <span class="p">[</span><span class="mf">0.87460401</span><span class="p">,</span> <span class="mf">0.25742952</span><span class="p">,</span> <span class="mf">0.70576625</span><span class="p">,</span> <span class="mf">0.25516142</span><span class="p">,</span> <span class="mf">0.91507657</span><span class="p">,</span><span class="mf">0.72445152</span><span class="p">,</span> <span class="mf">0.52332024</span><span class="p">,</span> <span class="mf">0.17639139</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-26" name="src/tools/matlab save test again.py-26"></a>                                        <span class="p">[</span><span class="mf">0.25160639</span><span class="p">,</span> <span class="mf">0.19254418</span><span class="p">,</span> <span class="mf">0.63203156</span><span class="p">,</span> <span class="mf">0.35385166</span><span class="p">,</span> <span class="mf">0.11544327</span><span class="p">,</span><span class="mf">0.0302408</span> <span class="p">,</span> <span class="mf">0.58482374</span><span class="p">,</span> <span class="mf">0.97726675</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-27" name="src/tools/matlab save test again.py-27"></a>                                        <span class="p">[</span><span class="mf">0.54879552</span><span class="p">,</span> <span class="mf">0.38684282</span><span class="p">,</span> <span class="mf">0.45543813</span><span class="p">,</span> <span class="mf">0.58192000</span><span class="p">,</span> <span class="mf">0.12487109</span><span class="p">,</span><span class="mf">0.31499229</span><span class="p">,</span> <span class="mf">0.88382746</span><span class="p">,</span> <span class="mf">0.63870705</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-28" name="src/tools/matlab save test again.py-28"></a>                                        <span class="p">[</span><span class="mf">0.23410666</span><span class="p">,</span> <span class="mf">0.23708682</span><span class="p">,</span> <span class="mf">0.38256899</span><span class="p">,</span> <span class="mf">0.45526047</span><span class="p">,</span> <span class="mf">0.15911381</span><span class="p">,</span><span class="mf">0.09479992</span><span class="p">,</span> <span class="mf">0.05006935</span><span class="p">,</span> <span class="mf">0.67269247</span><span class="p">]])}</span>
<a id="src/tools/matlab save test again.py-29" name="src/tools/matlab save test again.py-29"></a><span class="hll"><span class="n">ex_settings_1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'count'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="s1">'wait_time'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span><span class="s1">'point2'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'array'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))},</span> <span class="s1">'plot_style'</span><span class="p">:</span> <span class="s1">'2D'</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'tag'</span><span class="p">:</span> <span class="s1">'exampleexperiment_1'</span><span class="p">,</span> <span class="s1">'save'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><a id="src/tools/matlab save test again.py-30" name="src/tools/matlab save test again.py-30"></a>
<a id="src/tools/matlab save test again.py-31" name="src/tools/matlab save test again.py-31"></a><span class="hll"><span class="n">ex_data_2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'random_data'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8486161845846729</span><span class="p">,</span> <span class="mf">0.3130657602243422</span><span class="p">,</span> <span class="mf">0.08220784202620657</span><span class="p">,</span> <span class="mf">0.7566239357229991</span><span class="p">,</span> <span class="mf">0.1566956979052001</span><span class="p">,</span> <span class="mf">0.7763677820680961</span><span class="p">,</span> <span class="mf">0.2822495884326256</span><span class="p">,</span> <span class="mf">0.07358801896021061</span><span class="p">,</span> <span class="mf">0.31546483249754065</span><span class="p">,</span> <span class="mf">0.09602905292983566</span><span class="p">,</span> <span class="mf">0.4708363377901481</span><span class="p">,</span> <span class="mf">0.7606587079228375</span><span class="p">,</span> <span class="mf">0.5911818105719729</span><span class="p">,</span> <span class="mf">0.19326385842390115</span><span class="p">,</span> <span class="mf">0.3569708749172422</span><span class="p">,</span> <span class="mf">0.06579632322101503</span><span class="p">,</span> <span class="mf">0.46004952942452815</span><span class="p">,</span> <span class="mf">0.11000005199119756</span><span class="p">,</span> <span class="mf">0.7802220450958514</span><span class="p">,</span> <span class="mf">0.9844957645722522</span><span class="p">,</span> <span class="mf">0.38069637275321766</span><span class="p">,</span> <span class="mf">0.3387975697602441</span><span class="p">,</span> <span class="mf">0.3255874429958806</span><span class="p">,</span> <span class="mf">0.7306502495430353</span><span class="p">,</span> <span class="mf">0.815690771973527</span><span class="p">,</span> <span class="mf">0.7686951861780189</span><span class="p">,</span> <span class="mf">0.292695932732541</span><span class="p">,</span> <span class="mf">0.9765989723690504</span><span class="p">,</span> <span class="mf">0.5490912704525974</span><span class="p">,</span> <span class="mf">0.3737056760497047</span><span class="p">,</span> <span class="mf">0.32364875029619977</span><span class="p">,</span> <span class="mf">0.9531146682182229</span><span class="p">,</span> <span class="mf">0.8746040122154536</span><span class="p">,</span> <span class="mf">0.25742952003459707</span><span class="p">,</span> <span class="mf">0.7057662535379657</span><span class="p">,</span> <span class="mf">0.2551614160706245</span><span class="p">,</span> <span class="mf">0.9150765684493058</span><span class="p">,</span> <span class="mf">0.7244515224434058</span><span class="p">,</span> <span class="mf">0.5233202410366595</span><span class="p">,</span> <span class="mf">0.17639138956682998</span><span class="p">,</span> <span class="mf">0.2516063889187946</span><span class="p">,</span> <span class="mf">0.19254417798646706</span><span class="p">,</span> <span class="mf">0.6320315640610223</span><span class="p">,</span> <span class="mf">0.35385166196057805</span><span class="p">,</span> <span class="mf">0.11544327009564181</span><span class="p">,</span> <span class="mf">0.030240801268020756</span><span class="p">,</span> <span class="mf">0.5848237412619066</span><span class="p">,</span> <span class="mf">0.9772667456935146</span><span class="p">,</span> <span class="mf">0.5487955220209074</span><span class="p">,</span> <span class="mf">0.38684281884035454</span><span class="p">,</span> <span class="mf">0.45543813051957194</span><span class="p">,</span> <span class="mf">0.5819199971261986</span><span class="p">,</span> <span class="mf">0.124871093746875</span><span class="p">,</span> <span class="mf">0.3149922940983798</span><span class="p">,</span> <span class="mf">0.8838274557598422</span><span class="p">,</span> <span class="mf">0.6387070545009906</span><span class="p">,</span> <span class="mf">0.2341066565754999</span><span class="p">,</span> <span class="mf">0.2370868196635849</span><span class="p">,</span> <span class="mf">0.3825689872722846</span><span class="p">,</span> <span class="mf">0.45526046737403136</span><span class="p">,</span> <span class="mf">0.15911380778058426</span><span class="p">,</span> <span class="mf">0.09479991503726515</span><span class="p">,</span> <span class="mf">0.05006934680646735</span><span class="p">,</span> <span class="mf">0.6726924720799815</span><span class="p">],</span>
</span><a id="src/tools/matlab save test again.py-32" name="src/tools/matlab save test again.py-32"></a>                <span class="s1">'image_data'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.84861618</span><span class="p">,</span> <span class="mf">0.31306576</span><span class="p">,</span> <span class="mf">0.08220784</span><span class="p">,</span> <span class="mf">0.75662394</span><span class="p">,</span> <span class="mf">0.1566957</span> <span class="p">,</span><span class="mf">0.77636778</span><span class="p">,</span> <span class="mf">0.28224959</span><span class="p">,</span> <span class="mf">0.07358802</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-33" name="src/tools/matlab save test again.py-33"></a>                                        <span class="p">[</span><span class="mf">0.31546483</span><span class="p">,</span> <span class="mf">0.09602905</span><span class="p">,</span> <span class="mf">0.47083634</span><span class="p">,</span> <span class="mf">0.76065871</span><span class="p">,</span> <span class="mf">0.59118181</span><span class="p">,</span><span class="mf">0.19326386</span><span class="p">,</span> <span class="mf">0.35697087</span><span class="p">,</span> <span class="mf">0.06579632</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-34" name="src/tools/matlab save test again.py-34"></a>                                        <span class="p">[</span><span class="mf">0.46004953</span><span class="p">,</span> <span class="mf">0.11000005</span><span class="p">,</span> <span class="mf">0.78022205</span><span class="p">,</span> <span class="mf">0.98449576</span><span class="p">,</span> <span class="mf">0.38069637</span><span class="p">,</span><span class="mf">0.33879757</span><span class="p">,</span> <span class="mf">0.32558744</span><span class="p">,</span> <span class="mf">0.73065025</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-35" name="src/tools/matlab save test again.py-35"></a>                                        <span class="p">[</span><span class="mf">0.81569077</span><span class="p">,</span> <span class="mf">0.76869519</span><span class="p">,</span> <span class="mf">0.29269593</span><span class="p">,</span> <span class="mf">0.97659897</span><span class="p">,</span> <span class="mf">0.54909127</span><span class="p">,</span><span class="mf">0.37370568</span><span class="p">,</span> <span class="mf">0.32364875</span><span class="p">,</span> <span class="mf">0.95311467</span><span class="p">],</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/matlab save test again.py-36" name="src/tools/matlab save test again.py-36"></a>                                        <span class="p">[</span><span class="mf">0.87460401</span><span class="p">,</span> <span class="mf">0.25742952</span><span class="p">,</span> <span class="mf">0.70576625</span><span class="p">,</span> <span class="mf">0.25516142</span><span class="p">,</span> <span class="mf">0.91507657</span><span class="p">,</span><span class="mf">0.72445152</span><span class="p">,</span> <span class="mf">0.52332024</span><span class="p">,</span> <span class="mf">0.17639139</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-37" name="src/tools/matlab save test again.py-37"></a>                                        <span class="p">[</span><span class="mf">0.25160639</span><span class="p">,</span> <span class="mf">0.19254418</span><span class="p">,</span> <span class="mf">0.63203156</span><span class="p">,</span> <span class="mf">0.35385166</span><span class="p">,</span> <span class="mf">0.11544327</span><span class="p">,</span><span class="mf">0.0302408</span> <span class="p">,</span> <span class="mf">0.58482374</span><span class="p">,</span> <span class="mf">0.97726675</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-38" name="src/tools/matlab save test again.py-38"></a>                                        <span class="p">[</span><span class="mf">0.54879552</span><span class="p">,</span> <span class="mf">0.38684282</span><span class="p">,</span> <span class="mf">0.45543813</span><span class="p">,</span> <span class="mf">0.58192000</span><span class="p">,</span> <span class="mf">0.12487109</span><span class="p">,</span><span class="mf">0.31499229</span><span class="p">,</span> <span class="mf">0.88382746</span><span class="p">,</span> <span class="mf">0.63870705</span><span class="p">],</span>
<a id="src/tools/matlab save test again.py-39" name="src/tools/matlab save test again.py-39"></a>                                        <span class="p">[</span><span class="mf">0.23410666</span><span class="p">,</span> <span class="mf">0.23708682</span><span class="p">,</span> <span class="mf">0.38256899</span><span class="p">,</span> <span class="mf">0.45526047</span><span class="p">,</span> <span class="mf">0.15911381</span><span class="p">,</span><span class="mf">0.09479992</span><span class="p">,</span> <span class="mf">0.05006935</span><span class="p">,</span> <span class="mf">0.67269247</span><span class="p">]])}</span>
<a id="src/tools/matlab save test again.py-40" name="src/tools/matlab save test again.py-40"></a><span class="hll"><span class="n">ex_settings_2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'count'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="s1">'wait_time'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'point2'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'array'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))},</span>  <span class="s1">'plot_style'</span><span class="p">:</span> <span class="s1">'2D'</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'tag'</span><span class="p">:</span> <span class="s1">'exampleexperiment_2'</span><span class="p">,</span> <span class="s1">'save'</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><a id="src/tools/matlab save test again.py-41" name="src/tools/matlab save test again.py-41"></a>
<a id="src/tools/matlab save test again.py-42" name="src/tools/matlab save test again.py-42"></a><span class="hll"><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">ex_data_1</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">],</span><span class="n">ex_data_1</span><span class="p">[</span><span class="s1">'image_data'</span><span class="p">],</span><span class="n">ex_settings_1</span><span class="p">),(</span><span class="n">ex_data_2</span><span class="p">[</span><span class="s1">'random_data'</span><span class="p">],</span><span class="n">ex_data_2</span><span class="p">[</span><span class="s1">'image_data'</span><span class="p">],</span><span class="n">ex_settings_2</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'random_data'</span><span class="p">,</span> <span class="s1">'f8'</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,)),(</span><span class="s1">'image_data'</span><span class="p">,</span> <span class="s1">'f8'</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)),(</span><span class="s1">'experiment_settings'</span><span class="p">,</span><span class="nb">dict</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-43" name="src/tools/matlab save test again.py-43"></a><span class="hll"><span class="n">savemat</span><span class="p">(</span><span class="n">filelocation</span><span class="p">,</span> <span class="p">{</span><span class="s1">'ex_data'</span><span class="p">:</span><span class="n">arr</span><span class="p">})</span>
</span><a id="src/tools/matlab save test again.py-44" name="src/tools/matlab save test again.py-44"></a><span class="c1">#print('This arr saves as a 1x2 struct with columns for random_data, image_data, and experiment_settings. The data are arrays with numbers and the settings is a 1x1 struct housing the experiment parameter names and values.')</span>
<a id="src/tools/matlab save test again.py-45" name="src/tools/matlab save test again.py-45"></a><span class="sd">'''</span>
<a id="src/tools/matlab save test again.py-46" name="src/tools/matlab save test again.py-46"></a><span class="sd">Need to pay attention to data type and length to get a dtype matlab can interpret correctly</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/matlab save test again.py-54" name="src/tools/matlab save test again.py-54"></a>
<a id="src/tools/matlab save test again.py-55" name="src/tools/matlab save test again.py-55"></a><span class="c1">#want to see if we can get each experiment to be its on</span>
<a id="src/tools/matlab save test again.py-56" name="src/tools/matlab save test again.py-56"></a>
<a id="src/tools/matlab save test again.py-57" name="src/tools/matlab save test again.py-57"></a><span class="c1">#The function structure_data_for_matlab should automate the structing process. Here is first test</span>
<a id="src/tools/matlab save test again.py-58" name="src/tools/matlab save test again.py-58"></a><span class="hll"><span class="n">filename</span> <span class="o">=</span> <span class="s1">'test_auto_structure.mat'</span>
</span><a id="src/tools/matlab save test again.py-59" name="src/tools/matlab save test again.py-59"></a><span class="hll"><span class="n">filelocation</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'C:\Users\Duttlab\Experiments\AQuISS_default_save_location\data</span><span class="se">\\</span><span class="s1">'</span> <span class="o">+</span> <span class="n">filename</span>
</span><a id="src/tools/matlab save test again.py-60" name="src/tools/matlab save test again.py-60"></a>
<a id="src/tools/matlab save test again.py-61" name="src/tools/matlab save test again.py-61"></a><span class="c1">#structured_data = structure_data_for_matlab(data=[ex_data_1,ex_data_2],settings=[ex_settings_1,ex_settings_2],tag='example_experiment')</span>
<a id="src/tools/matlab save test again.py-62" name="src/tools/matlab save test again.py-62"></a><span class="c1">#savemat(filelocation,structured_data)</span>
<a id="src/tools/matlab save test again.py-63" name="src/tools/matlab save test again.py-63"></a><span class="c1">#It works the same as above!! One thing is the data and settings should be a list, but this should be actually really easy to do in say the experiment iterator just have a list and append new data set</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/matlab save test again.py-64" name="src/tools/matlab save test again.py-64"></a>
<a id="src/tools/matlab save test again.py-65" name="src/tools/matlab save test again.py-65"></a><span class="c1">#need to test infinite recursion and infinite demension structs (inductive proof of 1 and 2 levels)</span>
<a id="src/tools/matlab save test again.py-66" name="src/tools/matlab save test again.py-66"></a>
<a id="src/tools/matlab save test again.py-67" name="src/tools/matlab save test again.py-67"></a><span class="c1">#Trying to put a 1x2 struct in another 1x2 struct</span>
<a id="src/tools/matlab save test again.py-68" name="src/tools/matlab save test again.py-68"></a><span class="hll"><span class="n">filename</span> <span class="o">=</span> <span class="s1">'test_recursive_structs.mat'</span>
</span><a id="src/tools/matlab save test again.py-69" name="src/tools/matlab save test again.py-69"></a><span class="hll"><span class="n">filelocation</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'C:\Users\Duttlab\Experiments\AQuISS_default_save_location\data</span><span class="se">\\</span><span class="s1">'</span> <span class="o">+</span> <span class="n">filename</span>
</span><a id="src/tools/matlab save test again.py-70" name="src/tools/matlab save test again.py-70"></a>
<a id="src/tools/matlab save test again.py-71" name="src/tools/matlab save test again.py-71"></a>
<a id="src/tools/matlab save test again.py-72" name="src/tools/matlab save test again.py-72"></a><span class="hll"><span class="n">arr_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">'one'</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mf">0.6</span><span class="p">,</span><span class="s1">'two'</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mf">0.7</span><span class="p">,</span><span class="s1">'hi'</span><span class="p">,</span><span class="mi">6</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'x1'</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s1">'y1'</span><span class="p">,</span><span class="nb">object</span><span class="p">),(</span><span class="s1">'z1'</span><span class="p">,</span><span class="nb">int</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-73" name="src/tools/matlab save test again.py-73"></a><span class="hll"><span class="n">arr_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">0.7</span><span class="p">,</span><span class="s1">'three'</span><span class="p">),(</span><span class="mf">0.8</span><span class="p">,</span><span class="s1">'four'</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'x2'</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s1">'y2'</span><span class="p">,</span><span class="nb">object</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-74" name="src/tools/matlab save test again.py-74"></a><span class="hll"><span class="n">arr_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">0.9</span><span class="p">,</span><span class="s1">'five'</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="s1">'six'</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'x3'</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s1">'y3'</span><span class="p">,</span><span class="nb">object</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-75" name="src/tools/matlab save test again.py-75"></a><span class="hll"><span class="n">arr_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.1</span><span class="p">,</span><span class="s1">'seven'</span><span class="p">),(</span><span class="mf">1.2</span><span class="p">,</span><span class="s1">'eight'</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'x4'</span><span class="p">,</span><span class="nb">float</span><span class="p">),(</span><span class="s1">'y4'</span><span class="p">,</span><span class="nb">object</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-76" name="src/tools/matlab save test again.py-76"></a>
<a id="src/tools/matlab save test again.py-77" name="src/tools/matlab save test again.py-77"></a><span class="hll"><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">arr_2</span><span class="p">,</span><span class="n">arr_4</span><span class="p">),(</span><span class="n">arr_4</span><span class="p">,</span><span class="n">arr_1</span><span class="p">),(</span><span class="n">arr_2</span><span class="p">,</span><span class="n">arr_3</span><span class="p">),(</span><span class="n">arr_1</span><span class="p">,</span><span class="n">arr_3</span><span class="p">)],</span><span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'field1'</span><span class="p">,</span><span class="nb">object</span><span class="p">),(</span><span class="s1">'field2'</span><span class="p">,</span><span class="nb">object</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-78" name="src/tools/matlab save test again.py-78"></a><span class="hll"><span class="n">arr_extra_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">arr_2</span><span class="p">,</span><span class="n">arr_4</span><span class="p">),(</span><span class="n">arr_4</span><span class="p">,</span><span class="n">arr_1</span><span class="p">),(</span><span class="n">arr_2</span><span class="p">,</span><span class="n">arr_3</span><span class="p">),(</span><span class="n">arr_1</span><span class="p">,</span><span class="n">arr_3</span><span class="p">)],</span><span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'field1'</span><span class="p">,</span><span class="nb">object</span><span class="p">),(</span><span class="s1">'field2'</span><span class="p">,</span><span class="nb">object</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-79" name="src/tools/matlab save test again.py-79"></a><span class="hll"><span class="n">arr_extra_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">arr_2</span><span class="p">,</span><span class="n">arr_4</span><span class="p">),(</span><span class="n">arr_4</span><span class="p">,</span><span class="n">arr_1</span><span class="p">),(</span><span class="n">arr_2</span><span class="p">,</span><span class="n">arr_3</span><span class="p">),(</span><span class="n">arr_1</span><span class="p">,</span><span class="n">arr_3</span><span class="p">)],</span><span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'field1'</span><span class="p">,</span><span class="nb">object</span><span class="p">),(</span><span class="s1">'field2'</span><span class="p">,</span><span class="nb">object</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-80" name="src/tools/matlab save test again.py-80"></a><span class="hll"><span class="n">arr_extra_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">arr_2</span><span class="p">,</span><span class="n">arr_4</span><span class="p">),(</span><span class="n">arr_4</span><span class="p">,</span><span class="n">arr_1</span><span class="p">),(</span><span class="n">arr_2</span><span class="p">,</span><span class="n">arr_3</span><span class="p">),(</span><span class="n">arr_1</span><span class="p">,</span><span class="n">arr_3</span><span class="p">)],</span><span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'field1'</span><span class="p">,</span><span class="nb">object</span><span class="p">),(</span><span class="s1">'field2'</span><span class="p">,</span><span class="nb">object</span><span class="p">)])</span>
</span><a id="src/tools/matlab save test again.py-81" name="src/tools/matlab save test again.py-81"></a>
<a id="src/tools/matlab save test again.py-82" name="src/tools/matlab save test again.py-82"></a><span class="c1">#saving arr creates a 1x4 struct with 8 componets each being 1x2 structs</span>
<a id="src/tools/matlab save test again.py-83" name="src/tools/matlab save test again.py-83"></a><span class="hll"><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="p">,(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span><a id="src/tools/matlab save test again.py-84" name="src/tools/matlab save test again.py-84"></a><span class="c1">#savemat(filelocation,{'arr':arr})</span>
<a id="src/tools/matlab save test again.py-85" name="src/tools/matlab save test again.py-85"></a>
<a id="src/tools/matlab save test again.py-86" name="src/tools/matlab save test again.py-86"></a>
<a id="src/tools/matlab save test again.py-87" name="src/tools/matlab save test again.py-87"></a>
<a id="src/tools/matlab save test again.py-88" name="src/tools/matlab save test again.py-88"></a><span class="hll"><span class="n">filename</span> <span class="o">=</span> <span class="s1">'multi_iterator_data.mat'</span>
</span><a id="src/tools/matlab save test again.py-89" name="src/tools/matlab save test again.py-89"></a><span class="hll"><span class="n">filelocation</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'C:\Users\Duttlab\Experiments\AQuISS_default_save_location\data</span><span class="se">\\</span><span class="s1">'</span> <span class="o">+</span> <span class="n">filename</span>
</span><a id="src/tools/matlab save test again.py-90" name="src/tools/matlab save test again.py-90"></a><span class="sd">'''</span>
<a id="src/tools/matlab save test again.py-91" name="src/tools/matlab save test again.py-91"></a><span class="sd">structured_data_new, dtype_list = structure_data_for_matlab(data=[ex_data_1,ex_data_2],settings=[ex_settings_1,ex_settings_2],tag='example_experiment',return_array=True)</span>
<a id="src/tools/matlab save test again.py-92" name="src/tools/matlab save test again.py-92"></a><span class="sd">print(dtype_list)</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/matlab save test again.py-123" name="src/tools/matlab save test again.py-123"></a>
<a id="src/tools/matlab save test again.py-124" name="src/tools/matlab save test again.py-124"></a>
<a id="src/tools/matlab save test again.py-125" name="src/tools/matlab save test again.py-125"></a>
<a id="src/tools/matlab save test again.py-126" name="src/tools/matlab save test again.py-126"></a>
<a id="src/tools/matlab save test again.py-127" name="src/tools/matlab save test again.py-127"></a><span class="hll"><span class="n">experiment_aqs</span> <span class="o">=</span> <span class="p">{</span>
</span><a id="src/tools/matlab save test again.py-128" name="src/tools/matlab save test again.py-128"></a>    <span class="s2">"experiments"</span><span class="p">:</span> <span class="p">{</span>
<a id="src/tools/matlab save test again.py-129" name="src/tools/matlab save test again.py-129"></a>        <span class="s2">"ConfocalScan_Fast"</span><span class="p">:</span> <span class="p">{</span>
<a id="src/tools/matlab save test again.py-130" name="src/tools/matlab save test again.py-130"></a>            <span class="s2">"class"</span><span class="p">:</span> <span class="s2">"ConfocalScan_Fast"</span><span class="p">,</span>
<a id="src/tools/matlab save test again.py-131" name="src/tools/matlab save test again.py-131"></a>            <span class="s2">"filepath"</span><span class="p">:</span> <span class="sa">r</span><span class="s2">"D:</span><span class="se">\\</span><span class="s2">PyCharmProjects</span><span class="se">\\</span><span class="s2">pittqlabsys-dylan-working-repo</span><span class="se">\\</span><span class="s2">src</span><span class="se">\\</span><span class="s2">Model</span><span class="se">\\</span><span class="s2">experiments</span><span class="se">\\</span><span class="s2">confocal.py"</span><span class="p">,</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/matlab save test again.py-274" name="src/tools/matlab save test again.py-274"></a>            <span class="p">}</span>
<a id="src/tools/matlab save test again.py-275" name="src/tools/matlab save test again.py-275"></a>        <span class="p">}</span>
<a id="src/tools/matlab save test again.py-276" name="src/tools/matlab save test again.py-276"></a>    <span class="p">}</span>
<a id="src/tools/matlab save test again.py-277" name="src/tools/matlab save test again.py-277"></a><span class="p">}</span>
<a id="src/tools/matlab save test again.py-278" name="src/tools/matlab save test again.py-278"></a><span class="hll"><span class="n">filename</span> <span class="o">=</span> <span class="s1">'test_pyton_matlab_save_aqs.mat'</span>
</span><a id="src/tools/matlab save test again.py-279" name="src/tools/matlab save test again.py-279"></a><span class="hll"><span class="n">filelocation</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'C:\Users\Duttlab\Experiments\AQuISS_default_save_location\data</span><span class="se">\\</span><span class="s1">'</span> <span class="o">+</span> <span class="n">filename</span>
</span><a id="src/tools/matlab save test again.py-280" name="src/tools/matlab save test again.py-280"></a><span class="c1">#savemat(filelocation, experiment_aqs)</span>
<a id="src/tools/matlab save test again.py-281" name="src/tools/matlab save test again.py-281"></a>
<a id="src/tools/matlab save test again.py-282" name="src/tools/matlab save test again.py-282"></a><span class="hll"><span class="n">filename</span> <span class="o">=</span> <span class="s1">'another_test.mat'</span>
</span><a id="src/tools/matlab save test again.py-283" name="src/tools/matlab save test again.py-283"></a><span class="hll"><span class="n">filelocation</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'D:\Data\dylan_staples</span><span class="se">\\</span><span class="s1">'</span> <span class="o">+</span> <span class="n">filename</span>
</span><a id="src/tools/matlab save test again.py-284" name="src/tools/matlab save test again.py-284"></a>
<a id="src/tools/matlab save test again.py-285" name="src/tools/matlab save test again.py-285"></a><span class="hll"><span class="n">structured_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'ex_sweep_mat_2'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><a id="src/tools/matlab save test again.py-286" name="src/tools/matlab save test again.py-286"></a>       <span class="p">([</span><span class="mf">0.86321529</span><span class="p">,</span> <span class="mf">0.59724984</span><span class="p">,</span> <span class="mf">0.22583211</span><span class="p">],</span> <span class="s1">'x'</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'main'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'exampleexperiment'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="src/tools/matlab save test again.py-287" name="src/tools/matlab save test again.py-287"></a>       <span class="p">([</span><span class="mf">0.07275898</span><span class="p">,</span> <span class="mf">0.16412021</span><span class="p">,</span> <span class="mf">0.02875495</span><span class="p">],</span> <span class="s1">'x'</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'main'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'exampleexperiment'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="src/tools/matlab save test again.py-288" name="src/tools/matlab save test again.py-288"></a>       <span class="p">([</span><span class="mf">0.74131829</span><span class="p">,</span> <span class="mf">0.61229449</span><span class="p">,</span> <span class="mf">0.83500967</span><span class="p">],</span> <span class="s1">'x'</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'main'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'exampleexperiment'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="src/tools/matlab save test again.py-289" name="src/tools/matlab save test again.py-289"></a>       <span class="p">([</span><span class="mf">0.74131829</span><span class="p">,</span> <span class="mf">0.61229449</span><span class="p">,</span> <span class="mf">0.83500967</span><span class="p">],</span> <span class="s1">'x'</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'this is a counter'</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">'main'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'exampleexperiment'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/tools/matlab save test again.py-290" name="src/tools/matlab save test again.py-290"></a>        <span class="p">],</span>
<a id="src/tools/matlab save test again.py-291" name="src/tools/matlab save test again.py-291"></a>      <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">'random data'</span><span class="p">,</span> <span class="s1">'&lt;f8'</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">'python_scan_map_scan_parameter'</span><span class="p">,</span> <span class="s1">'O'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'python_scan_map_num_steps'</span><span class="p">,</span> <span class="s1">'&lt;i4'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'count'</span><span class="p">,</span> <span class="s1">'&lt;i4'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'O'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'wait_time'</span><span class="p">,</span> <span class="s1">'&lt;f8'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'point2_x'</span><span class="p">,</span> <span class="s1">'&lt;f8'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'point2_y'</span><span class="p">,</span> <span class="s1">'&lt;f8'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'plot_style'</span><span class="p">,</span> <span class="s1">'O'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'path'</span><span class="p">,</span> <span class="s1">'O'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'tag'</span><span class="p">,</span> <span class="s1">'O'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'save'</span><span class="p">,</span> <span class="s1">'&lt;i4'</span><span class="p">)])}</span>
<a id="src/tools/matlab save test again.py-292" name="src/tools/matlab save test again.py-292"></a>
<a id="src/tools/matlab save test again.py-293" name="src/tools/matlab save test again.py-293"></a>
<a id="src/tools/matlab save test again.py-294" name="src/tools/matlab save test again.py-294"></a><span class="hll"><span class="nb">print</span><span class="p">(</span><span class="n">structured_data</span><span class="p">)</span>
</span><a id="src/tools/matlab save test again.py-295" name="src/tools/matlab save test again.py-295"></a><span class="hll"><span class="n">savemat</span><span class="p">(</span><span class="n">filelocation</span><span class="p">,</span> <span class="n">structured_data</span><span class="p">)</span>
</span><a id="src/tools/matlab save test again.py-296" name="src/tools/matlab save test again.py-296"></a>
<a id="src/tools/matlab save test again.py-297" name="src/tools/matlab save test again.py-297"></a>
<a id="src/tools/matlab save test again.py-298" name="src/tools/matlab save test again.py-298"></a>
<a id="src/tools/matlab save test again.py-299" name="src/tools/matlab save test again.py-299"></a>
<a id="src/tools/matlab save test again.py-300" name="src/tools/matlab save test again.py-300"></a><span class="hll"><span class="n">it_3_data</span> <span class="o">=</span> <span class="p">{</span>
</span><a id="src/tools/matlab save test again.py-301" name="src/tools/matlab save test again.py-301"></a>
<a id="src/tools/matlab save test again.py-302" name="src/tools/matlab save test again.py-302"></a>
<a id="src/tools/matlab save test again.py-303" name="src/tools/matlab save test again.py-303"></a><span class="p">}</span>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/View/windows_and_widgets/main_window.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/View/windows_and_widgets/main_window.py-419" name="src/View/windows_and_widgets/main_window.py-419"></a>        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/main_window.py-420" name="src/View/windows_and_widgets/main_window.py-420"></a>            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_point</span><span class="p">():</span>
<a id="src/View/windows_and_widgets/main_window.py-421" name="src/View/windows_and_widgets/main_window.py-421"></a>               <span class="c1"># item_x = item.child(1)</span>
<a id="src/View/windows_and_widgets/main_window.py-422" name="src/View/windows_and_widgets/main_window.py-422"></a>                <span class="n">item_x</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/main_window.py-423" name="src/View/windows_and_widgets/main_window.py-423"></a><span class="hll">                <span class="k">if</span> <span class="n">mouse_point</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/View/windows_and_widgets/main_window.py-424" name="src/View/windows_and_widgets/main_window.py-424"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">tree_experiments</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">item_x</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/main_window.py-425" name="src/View/windows_and_widgets/main_window.py-425"></a><span class="hll">                    <span class="n">item_x</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mouse_point</span><span class="o">.</span><span class="n">x</span><span class="p">())</span>
</span><a id="src/View/windows_and_widgets/main_window.py-426" name="src/View/windows_and_widgets/main_window.py-426"></a><span class="hll">                    <span class="n">item_x</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'</span><span class="si">{:0.3f}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mouse_point</span><span class="o">.</span><span class="n">x</span><span class="p">())))</span>
</span><a id="src/View/windows_and_widgets/main_window.py-427" name="src/View/windows_and_widgets/main_window.py-427"></a>               <span class="c1"># item_y = item.child(0)</span>
<a id="src/View/windows_and_widgets/main_window.py-428" name="src/View/windows_and_widgets/main_window.py-428"></a>                <span class="n">item_y</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/main_window.py-429" name="src/View/windows_and_widgets/main_window.py-429"></a><span class="hll">                <span class="k">if</span> <span class="n">mouse_point</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/View/windows_and_widgets/main_window.py-430" name="src/View/windows_and_widgets/main_window.py-430"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">tree_experiments</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">item_y</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/main_window.py-431" name="src/View/windows_and_widgets/main_window.py-431"></a><span class="hll">                    <span class="n">item_y</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mouse_point</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
</span><a id="src/View/windows_and_widgets/main_window.py-432" name="src/View/windows_and_widgets/main_window.py-432"></a><span class="hll">                    <span class="n">item_y</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'</span><span class="si">{:0.3f}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mouse_point</span><span class="o">.</span><span class="n">y</span><span class="p">())))</span>
</span><a id="src/View/windows_and_widgets/main_window.py-433" name="src/View/windows_and_widgets/main_window.py-433"></a>
<a id="src/View/windows_and_widgets/main_window.py-434" name="src/View/windows_and_widgets/main_window.py-434"></a>                <span class="c1"># focus back on item</span>
<a id="src/View/windows_and_widgets/main_window.py-435" name="src/View/windows_and_widgets/main_window.py-435"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tree_experiments</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/main_window.py-436" name="src/View/windows_and_widgets/main_window.py-436"></a>            <span class="k">else</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/View/windows_and_widgets/main_window.py-436" name="src/View/windows_and_widgets/main_window.py-436"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/main_window.py-437" name="src/View/windows_and_widgets/main_window.py-437"></a>                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/main_window.py-438" name="src/View/windows_and_widgets/main_window.py-438"></a>                    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">is_point</span><span class="p">():</span>
<a id="src/View/windows_and_widgets/main_window.py-439" name="src/View/windows_and_widgets/main_window.py-439"></a>                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<a id="src/View/windows_and_widgets/main_window.py-440" name="src/View/windows_and_widgets/main_window.py-440"></a><span class="hll">                            <span class="k">if</span> <span class="n">mouse_point</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/View/windows_and_widgets/main_window.py-441" name="src/View/windows_and_widgets/main_window.py-441"></a><span class="hll">                                <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mouse_point</span><span class="o">.</span><span class="n">x</span><span class="p">()))</span>
</span><a id="src/View/windows_and_widgets/main_window.py-442" name="src/View/windows_and_widgets/main_window.py-442"></a>                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
<a id="src/View/windows_and_widgets/main_window.py-443" name="src/View/windows_and_widgets/main_window.py-443"></a><span class="hll">                            <span class="k">if</span> <span class="n">mouse_point</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/View/windows_and_widgets/main_window.py-444" name="src/View/windows_and_widgets/main_window.py-444"></a><span class="hll">                                <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mouse_point</span><span class="o">.</span><span class="n">y</span><span class="p">()))</span>
</span><a id="src/View/windows_and_widgets/main_window.py-445" name="src/View/windows_and_widgets/main_window.py-445"></a>
<a id="src/View/windows_and_widgets/main_window.py-446" name="src/View/windows_and_widgets/main_window.py-446"></a>    <span class="k">def</span> <span class="nf">get_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/View/windows_and_widgets/main_window.py-447" name="src/View/windows_and_widgets/main_window.py-447"></a><span class="w">        </span><span class="sd">"""</span>
<a id="src/View/windows_and_widgets/main_window.py-448" name="src/View/windows_and_widgets/main_window.py-448"></a><span class="sd">        Returns: the current time as a formated string</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/View/windows_and_widgets/main_window.py-466" name="src/View/windows_and_widgets/main_window.py-466"></a>    <span class="k">def</span> <span class="nf">create_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="src/View/windows_and_widgets/main_window.py-467" name="src/View/windows_and_widgets/main_window.py-467"></a>
<a id="src/View/windows_and_widgets/main_window.py-468" name="src/View/windows_and_widgets/main_window.py-468"></a>        <span class="k">try</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/main_window.py-469" name="src/View/windows_and_widgets/main_window.py-469"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout_14</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyqtgraphwidget_1</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/main_window.py-470" name="src/View/windows_and_widgets/main_window.py-470"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">pyqtgraphwidget_1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><a id="src/View/windows_and_widgets/main_window.py-471" name="src/View/windows_and_widgets/main_window.py-471"></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/main_window.py-472" name="src/View/windows_and_widgets/main_window.py-472"></a>            <span class="k">pass</span>
<a id="src/View/windows_and_widgets/main_window.py-473" name="src/View/windows_and_widgets/main_window.py-473"></a>        <span class="k">try</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/main_window.py-474" name="src/View/windows_and_widgets/main_window.py-474"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizontalLayout_15</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyqtgraphwidget_2</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/main_window.py-475" name="src/View/windows_and_widgets/main_window.py-475"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">pyqtgraphwidget_2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><a id="src/View/windows_and_widgets/main_window.py-476" name="src/View/windows_and_widgets/main_window.py-476"></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/main_window.py-477" name="src/View/windows_and_widgets/main_window.py-477"></a>            <span class="k">pass</span>
<a id="src/View/windows_and_widgets/main_window.py-478" name="src/View/windows_and_widgets/main_window.py-478"></a>
<a id="src/View/windows_and_widgets/main_window.py-479" name="src/View/windows_and_widgets/main_window.py-479"></a>        <span class="c1">#adds 2 graphics layout widgets. _1 is top layout and _2 is bottom layout</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/View/windows_and_widgets/main_window.py-654" name="src/View/windows_and_widgets/main_window.py-654"></a>            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/main_window.py-655" name="src/View/windows_and_widgets/main_window.py-655"></a>                <span class="n">experiment</span><span class="p">,</span> <span class="n">path_to_experiment</span><span class="p">,</span> <span class="n">experiment_item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_experiment</span><span class="p">()</span>
<a id="src/View/windows_and_widgets/main_window.py-656" name="src/View/windows_and_widgets/main_window.py-656"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_experiment_from_item</span><span class="p">(</span><span class="n">experiment_item</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/main_window.py-657" name="src/View/windows_and_widgets/main_window.py-657"></a>                <span class="n">experiment</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<a id="src/View/windows_and_widgets/main_window.py-658" name="src/View/windows_and_widgets/main_window.py-658"></a><span class="hll">                <span class="n">experiment</span><span class="o">.</span><span class="n">plot_validate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">pyqtgraphwidget_1</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyqtgraphwidget_2</span><span class="o">.</span><span class="n">graph</span><span class="p">])</span>
</span><a id="src/View/windows_and_widgets/main_window.py-659" name="src/View/windows_and_widgets/main_window.py-659"></a>                <span class="c1">#the following 2 lines dont seem to do what I want ie they dont change the viewbox so that mouse position tracking updates for the new plots</span>
<a id="src/View/windows_and_widgets/main_window.py-660" name="src/View/windows_and_widgets/main_window.py-660"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">pyqtgraphwidget_1</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><a id="src/View/windows_and_widgets/main_window.py-661" name="src/View/windows_and_widgets/main_window.py-661"></a><span class="hll">                <span class="bp">self</span><span class="o">.</span><span class="n">pyqtgraphwidget_2</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><a id="src/View/windows_and_widgets/main_window.py-662" name="src/View/windows_and_widgets/main_window.py-662"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="s1">'validate button presss triggered'</span><span class="p">)</span>
</span><a id="src/View/windows_and_widgets/main_window.py-663" name="src/View/windows_and_widgets/main_window.py-663"></a>
<a id="src/View/windows_and_widgets/main_window.py-664" name="src/View/windows_and_widgets/main_window.py-664"></a>        <span class="k">def</span> <span class="nf">store_experiment_data</span><span class="p">():</span>
<a id="src/View/windows_and_widgets/main_window.py-665" name="src/View/windows_and_widgets/main_window.py-665"></a><span class="w">            </span><span class="sd">"""</span>
<a id="src/View/windows_and_widgets/main_window.py-666" name="src/View/windows_and_widgets/main_window.py-666"></a><span class="sd">            updates the internal self.data_sets with selected experiment and updates tree self.fill_dataset_tree</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/View/windows_and_widgets/main_window.py-681" name="src/View/windows_and_widgets/main_window.py-681"></a><span class="sd">            """</span>
<a id="src/View/windows_and_widgets/main_window.py-682" name="src/View/windows_and_widgets/main_window.py-682"></a>            <span class="n">indecies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataset</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
<a id="src/View/windows_and_widgets/main_window.py-683" name="src/View/windows_and_widgets/main_window.py-683"></a>            <span class="k">try</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/main_window.py-684" name="src/View/windows_and_widgets/main_window.py-684"></a>                <span class="n">model</span> <span class="o">=</span> <span class="n">indecies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
<a id="src/View/windows_and_widgets/main_window.py-685" name="src/View/windows_and_widgets/main_window.py-685"></a><span class="hll">            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><a id="src/View/windows_and_widgets/main_window.py-686" name="src/View/windows_and_widgets/main_window.py-686"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'No experiment selected.'</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/main_window.py-687" name="src/View/windows_and_widgets/main_window.py-687"></a>            <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()</span><span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indecies</span><span class="p">]))</span>
<a id="src/View/windows_and_widgets/main_window.py-688" name="src/View/windows_and_widgets/main_window.py-688"></a>
<a id="src/View/windows_and_widgets/main_window.py-689" name="src/View/windows_and_widgets/main_window.py-689"></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
</pre></div></td></tr></tbody></table></div>

            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/View/windows_and_widgets/main_window.py-695" name="src/View/windows_and_widgets/main_window.py-695"></a>                <span class="n">experiment</span><span class="o">.</span><span class="n">save_data</span><span class="p">()</span>
<a id="src/View/windows_and_widgets/main_window.py-696" name="src/View/windows_and_widgets/main_window.py-696"></a>                <span class="n">experiment</span><span class="o">.</span><span class="n">save_image_to_disk</span><span class="p">()</span>
<a id="src/View/windows_and_widgets/main_window.py-697" name="src/View/windows_and_widgets/main_window.py-697"></a>                <span class="n">experiment</span><span class="o">.</span><span class="n">save_aqs</span><span class="p">()</span>
<a id="src/View/windows_and_widgets/main_window.py-698" name="src/View/windows_and_widgets/main_window.py-698"></a>                <span class="n">experiment</span><span class="o">.</span><span class="n">save_log</span><span class="p">()</span>
<a id="src/View/windows_and_widgets/main_window.py-699" name="src/View/windows_and_widgets/main_window.py-699"></a><span class="hll">                <span class="n">experiment</span><span class="o">.</span><span class="n">save_data_to_matlab</span><span class="p">()</span>
</span><a id="src/View/windows_and_widgets/main_window.py-700" name="src/View/windows_and_widgets/main_window.py-700"></a>
<a id="src/View/windows_and_widgets/main_window.py-701" name="src/View/windows_and_widgets/main_window.py-701"></a>        <span class="k">def</span> <span class="nf">delete_data</span><span class="p">():</span>
<a id="src/View/windows_and_widgets/main_window.py-702" name="src/View/windows_and_widgets/main_window.py-702"></a><span class="w">            </span><span class="sd">"""</span>
<a id="src/View/windows_and_widgets/main_window.py-703" name="src/View/windows_and_widgets/main_window.py-703"></a><span class="sd">            deletes the data from the dataset</span>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/View/windows_and_widgets/widgets.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/View/windows_and_widgets/widgets.py-483" name="src/View/windows_and_widgets/widgets.py-483"></a>            <span class="c1">#only if the item is a PlotItem or ImageItem will it have a viewbox (and coordinates) that your cursor hovers over</span>
<a id="src/View/windows_and_widgets/widgets.py-484" name="src/View/windows_and_widgets/widgets.py-484"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">viewbox</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">vb</span>
<a id="src/View/windows_and_widgets/widgets.py-485" name="src/View/windows_and_widgets/widgets.py-485"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_movement</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">SignalProxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connected_graph</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseMoved</span><span class="p">,</span> <span class="n">rateLimit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mouseMoved</span><span class="p">)</span>
<a id="src/View/windows_and_widgets/widgets.py-486" name="src/View/windows_and_widgets/widgets.py-486"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/View/windows_and_widgets/widgets.py-487" name="src/View/windows_and_widgets/widgets.py-487"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">viewbox</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/View/windows_and_widgets/widgets.py-488" name="src/View/windows_and_widgets/widgets.py-488"></a>
<a id="src/View/windows_and_widgets/widgets.py-489" name="src/View/windows_and_widgets/widgets.py-489"></a>    <span class="k">def</span> <span class="nf">mouseMoved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
<a id="src/View/windows_and_widgets/widgets.py-490" name="src/View/windows_and_widgets/widgets.py-490"></a><span class="w">        </span><span class="sd">'''</span>
<a id="src/View/windows_and_widgets/widgets.py-491" name="src/View/windows_and_widgets/widgets.py-491"></a><span class="sd">        Funtion gets the cursor coordinate and displays them in a label above graph</span>
</pre></div></td></tr></tbody></table></div>

            </div>
        </div>
    
</body></html>